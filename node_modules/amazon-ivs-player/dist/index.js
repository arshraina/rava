/*! For license information please see index.js.LICENSE.txt */
!function(){var e={223:function(e){self,e.exports=function(){"use strict";var e={228:function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,c,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,a),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];d.fn.apply(d.context,u)}else{var f,h=d.length;for(c=0;c<h;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),l){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,r);break;case 4:d[c].fn.call(d[c].context,t,r,i);break;default:if(!u)for(f=1,u=new Array(l-1);f<l;f++)u[f-1]=arguments[f];d[c].fn.apply(d[c].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],d=s.length;u<d;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},815:function(e,t){var n,r,i=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});function o(e){return 60*e*60}function a(e,t){var n={};return Object.assign(n,e),t&&Object.assign(n,t),n}Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceConfigPropertyHolder=t.DeviceConfigManager=t.DeviceConfigEnv=void 0,function(e){e.BETA="beta",e.PROD="prod",e.CUSTOM="custom"}(r||(t.DeviceConfigEnv=r={}));var s=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t}(Error),u="data",c=o(1),d=o(2),l="base64",f=function(){function e(e,t){var n,i,o,a,s,l,f,h;if(!t.fileKey)throw new Error("options.fileKey cannot be empty");var p=null!==(n=t.clock)&&void 0!==n?n:new E,g=p.getMillis();switch(this.context=e,this.fileKey=t.fileKey,this.env=t.standardEnv,t.standardEnv){case r.BETA:this.fetchServer="beta.ivs-device-config-beta.live-video.net";break;case r.PROD:this.fetchServer="prod.ivs-device-config.live-video.net";break;case r.CUSTOM:if(!t.customServer)throw new Error("Custom env requires options.customServer");this.fetchServer=t.customServer;break;default:throw new Error("Invalid value for standardEnv: ".concat(t.standardEnv))}this.trace=null!==(i=t.trace)&&void 0!==i?i:new m(t.enableConsoleLog),this.fetch=null!==(o=t.fetch)&&void 0!==o?o:new v(e),this.storage=new y("amazon_ivs_device_config_v1_"+t.fileKey,e.localStorage),this.state=new b(this.storage,"state"),this.refresh={refreshIntervalSeconds:null!==(a=t.refresh.refreshIntervalSeconds)&&void 0!==a?a:c,retryCount:null!==(s=t.refresh.retryCount)&&void 0!==s?s:3,retryIntervalSeconds:null!==(l=t.refresh.retryIntervalSeconds)&&void 0!==l?l:10,maxCacheAgeSeconds:null!==(f=t.refresh.maxCacheAgeSeconds)&&void 0!==f?f:259200,stopRefreshAfterSeconds:null!==(h=t.refresh.stopRefreshAfterSeconds)&&void 0!==h?h:d,canRefreshNow:t.refresh.canRefreshNow},this.emitMetrics=t.emitMetrics,this.analyticsProperties=t.analyticsProperties,this.enableConsoleLog=t.enableConsoleLog,this.clock=p,this.isInitialRefreshDone=!1;var S=0,T=this.state.getState();T&&T.fetchServer===this.fetchServer&&T.lastFetchWhenMs&&(S=T.lastFetchWhenMs);var _,C=p.getMillis(),w=(C-S)/1e3;if(w<=this.refresh.maxCacheAgeSeconds){var k=this.storage.getJson(u);k&&k.fetchServer===this.fetchServer&&this.setData(k.json)}this.lastUseMs=C,w>=this.refresh.refreshIntervalSeconds||0==S?_=0:(_=Math.round(this.refresh.refreshIntervalSeconds-w),this.isInitialRefreshDone=!0),_<5&&(_=5),this.trace.onTrace("Will start refresh in "+_+" seconds"),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*_);var I=p.getMillis();this.initialLoadTime=I-g}return e.getInstance=function(t,n){try{if(!(t.fetch&&t.setTimeout&&t.clearTimeout&&t.localStorage))return void console.log("Context needs to provide fetch, setTimeout, clearTimeout, localStorage")}catch(e){return void console.error("Error checking for context properties "+e)}if(this.gInstance){if(this.gInstance.fileKey!=n.fileKey)throw new Error("Existing instance has file key ".concat(this.gInstance.fileKey,", now asking for ").concat(n.fileKey));return this.gInstance}return this.gInstance=new e(t,n),this.gInstance},e.prototype.getConfigurationHolder=function(e){var t,n=this.clock.getMillis();this.lastUseMs=n;var r=null!==(t=e.analytics)&&void 0!==t?t:new g(this.enableConsoleLog),i=0,o=this.state.getState();return o&&o.fetchServer===this.fetchServer&&o.lastFetchWhenMs&&(i=o.lastFetchWhenMs),(n-i)/1e3<=this.refresh.maxCacheAgeSeconds?new h(r,this.analyticsProperties,this.properties,i,this.clock):new h(r,void 0,void 0,0,this.clock)},e.prototype.getFetchUrl=function(){var e="https://".concat(this.fetchServer,"/").concat(this.fileKey,".json"),t=new URL(e);return t.searchParams.set("version","1.0"),t},e.clearInstance=function(){var e;null===(e=this.gInstance)||void 0===e||e.clearInstanceImpl(),this.gInstance=void 0},e.prototype.clearInstanceImpl=function(){this.context.clearTimeout(this.fetchTask),this.fetchTask=void 0,this.context.clearTimeout(this.retryTask),this.retryTask=void 0},e.prototype.startRefresh=function(){var e=this;this.trace.onTrace("Starting refresh request"),this.fetchTask=void 0,this.retryTask&&(this.context.clearTimeout(this.retryTask),this.retryTask=void 0),this.fetchTask=this.context.setTimeout(this.startRefresh.bind(this),1e3*this.refresh.refreshIntervalSeconds);var t=this.clock.getMillis();if((t-this.lastUseMs)/1e3>this.refresh.stopRefreshAfterSeconds)this.trace.onTrace("Will not refresh due to refresh timeout");else if(!this.isInitialRefreshDone||this.refresh.canRefreshNow()){this.isInitialRefreshDone=!0;var n={};this.fetchData().then((function(r){e.processResponse(r,n,t),e.emitMetricsImpl(n)})).catch((function(t){e.exceptionMetrics(n,t),e.emitMetricsImpl(n),e.trace.onTrace("Fetch error: "+t),e.refresh.retryCount>0&&e.scheduleRetry(1)}))}else this.trace.onTrace("Will not refresh due to callback having returned false")},e.prototype.fetchData=function(){var e=this.getFetchUrl(),t=new Headers,n=this.state.getState();return n.fetchServer===this.fetchServer&&(n.lastFetchWhenFullMs&&this.clock.getMillis()-n.lastFetchWhenFullMs>1e3*o(24)?this.trace.onTrace("Forcing full refresh"):this.properties&&n.lastFetchEtagHeader&&t.set("If-None-Match",n.lastFetchEtagHeader)),this.fetch.fetchUrl(e,t)},e.prototype.processResponse=function(e,t,n){var r={fetchServer:this.fetchServer,lastFetchWhenMs:this.clock.getMillis()},i=e.headers.get("etag");if(i&&(r.lastFetchEtagHeader=i),e.status<300&&e.json)if(this.setData(e.json)){this.trace.onTrace("Successfully parsed fetched data"),this.storage.setJson(u,{fetchServer:this.fetchServer,json:e.json});var o=this.clock.getMillis();r.lastFetchWhenFullMs=o,this.state.setState(r),t.success_new_data_count=1,t.fetch_duration_average=Math.max(0,o-n)}else t.fail_invalid_data_count=1;else{if(304!==e.status){var a="Unexpected http fetch status: "+e.status;throw this.trace.onTrace(a),new s(a)}this.trace.onTrace("Server said no change in data"),o=this.clock.getMillis(),r.lastFetchWhenMs=o,this.state.setState(r),t.success_no_change_count=1,t.fetch_duration_average=Math.max(0,o-n)}},e.prototype.scheduleRetry=function(e){var t=this;this.retryTask&&this.context.clearTimeout(this.retryTask);var n=e*this.refresh.retryIntervalSeconds;this.retryTask=this.context.setTimeout((function(){t.retryTask=void 0,t.fetchRetry(e)}),1e3*n)},e.prototype.fetchRetry=function(e){var t=this;this.trace.onTrace("Starting retry request ".concat(e,"..."));var n={},r=this.clock.getMillis();this.fetchData().then((function(e){t.processResponse(e,n,r),t.emitMetricsImpl(n)})).catch((function(r){t.exceptionMetrics(n,r),t.emitMetricsImpl(n),t.trace.onTrace("Fetch error: "+r),t.refresh.retryCount>e&&t.scheduleRetry(e+1)}))},e.prototype.setData=function(e){if(!e)return!1;if("1.0"!==e.version)return this.trace.onTrace("Data version is not 1.0, not applying"),!1;var t=e.properties;if(!t||!Array.isArray(t))return this.trace.onTrace("Data properties is not an array, not applying"),!1;for(var n=new Map,r=0,i=t;r<i.length;r++){var o=i[r];if(o.name&&o.type&&this.isValidValueType(o.type)){if(o.value_string&&"string"!=typeof o.value_string){this.trace.onTrace("Invalid type of value.value_string "+typeof o.value_string);continue}if(o.value_number&&"number"!=typeof o.value_number){this.trace.onTrace("Invalid type of value.value_number "+typeof o.value_number);continue}if(o.value_boolean&&"boolean"!=typeof o.value_boolean){this.trace.onTrace("Invalid type of value.value_boolean "+typeof o.value_boolean);continue}if(o.value_json&&"string"!=typeof o.value_json){this.trace.onTrace("Invalid type of value.value_json "+typeof o.value_json);continue}if(o.value_analytics&&"string"!=typeof o.value_analytics){this.trace.onTrace("Invalid type of item.value_analytics "+typeof o.value_analytics);continue}var a=new S(o.name,this.parseValueType(o.type),o.value_string,o.value_number,o.value_boolean,o.value_json,o.value_analytics,o.encoding);n.set(a.name,a)}}return 0!=n.size&&(this.properties=n,!0)},e.prototype.isValidValueType=function(e){return"string"===e||"number"===e||"boolean"===e||"json"==e},e.prototype.parseValueType=function(e){switch(e){case"string":return p.STRING;case"number":return p.NUMBER;case"boolean":return p.BOOLEAN;case"json":return p.JSON;default:throw new Error("Unsupported value type ".concat(e))}},e.prototype.emitMetricsImpl=function(e){var t,n,r,i,o,s,u={initial_load_time:this.initialLoadTime,fetch_attempt_count:1,fetch_duration_average:null!==(t=e.fetch_duration_average)&&void 0!==t?t:0,success_no_change_count:null!==(n=e.success_no_change_count)&&void 0!==n?n:0,success_new_data_count:null!==(r=e.success_new_data_count)&&void 0!==r?r:0,fail_exception_count:null!==(i=e.fail_exception_count)&&void 0!==i?i:0,fail_http_error_count:null!==(o=e.fail_http_error_count)&&void 0!==o?o:0,fail_invalid_data_count:null!==(s=e.fail_invalid_data_count)&&void 0!==s?s:0};this.emitMetrics(a(u,this.analyticsProperties))},e.prototype.exceptionMetrics=function(e,t){var n;t instanceof s||(null===(n=null==t?void 0:t.message)||void 0===n?void 0:n.startsWith("http error"))?e.fail_http_error_count=1:e.fail_exception_count=1},e}();t.DeviceConfigManager=f;var h=function(){function e(e,t,n,r,i){this.analytics=e,this.analyticsProperties=t,this.properties=n,this.dataFetchedWhenMs=r,this.clock=i}return e.prototype.getSize=function(){return this.properties?this.properties.size:-1},e.prototype.getStringValue=function(e){var t,n;if(this.properties){var r=this.properties.get(e);if(r){if(r.type===p.STRING){var i=null!==(t=r.valueString)&&void 0!==t?t:"";return this.analytics.onValue(a({key_name:r.name,value:null!==(n=r.valueAnalytics)&&void 0!==n?n:i,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),i}this.analytics.onError(a({key_name:r.name,message:"Type is not string"},this.analyticsProperties))}}else this.analytics.onTrace(a({key_name:e,message:"Configuration is not available"},this.analyticsProperties))},e.prototype.getNumberValue=function(e){var t,n;if(this.properties){var r=this.properties.get(e);if(r){if(r.type===p.NUMBER){var i=null!==(t=r.valueNumber)&&void 0!==t?t:0;return this.analytics.onValue(a({key_name:r.name,value:null!==(n=r.valueAnalytics)&&void 0!==n?n:i.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),i}this.analytics.onError(a({key_name:r.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(a({key_name:e,message:"Configuration is not available"},this.analyticsProperties))},e.prototype.getBooleanValue=function(e){var t,n;if(this.properties){var r=this.properties.get(e);if(r){if(r.type===p.BOOLEAN){var i=null!==(t=r.valueBoolean)&&void 0!==t&&t;return this.analytics.onValue(a({key_name:r.name,value:null!==(n=r.valueAnalytics)&&void 0!==n?n:i.toString(),fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),i}this.analytics.onError(a({key_name:r.name,message:"Type is not number"},this.analyticsProperties))}}else this.analytics.onTrace(a({key_name:e,message:"Configuration is not available"},this.analyticsProperties))},e.prototype.getJsonValue=function(e){var t,n;if(this.properties){var r=this.properties.get(e);if(r){if(r.type===p.JSON){var i=r.valueJson;if(!i)return this.analytics.onValue(a({key_name:r.name,value:null!==(t=r.valueAnalytics)&&void 0!==t?t:"",fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),null;try{var o=JSON.parse(i);return this.analytics.onValue(a({key_name:r.name,value:null!==(n=r.valueAnalytics)&&void 0!==n?n:o,fetched_seconds_ago:this.getFetchedSecondsAgo()},this.analyticsProperties)),o}catch(e){return void this.analytics.onError(a({key_name:r.name,message:"JSON parse error"},this.analyticsProperties))}}this.analytics.onError(a({key_name:r.name,message:"Type is not JSON"},this.analyticsProperties))}}else this.analytics.onTrace(a({key_name:e,message:"Configuration is not available"},this.analyticsProperties))},e.prototype.getFetchedSecondsAgo=function(){if(this.dataFetchedWhenMs)return(this.clock.getMillis()-this.dataFetchedWhenMs)/1e3},e}();t.DeviceConfigPropertyHolder=h;var p,v=function(){function e(e){this.context=e}return e.prototype.fetchUrl=function(e,t){var n=this,r={headers:t,cache:"no-store"},i=null;if("undefined"!=typeof AbortController){var o=new AbortController;i=this.context.setTimeout((function(){return o.abort()}),15e3),r.signal=o.signal}return new Promise((function(t,o){n.context.fetch(e,r).then((function(e){if(e.status>=400)o(new s("http error ".concat(e.status,", ").concat(e.statusText)));else{var n={status:e.status,headers:e.headers};e.json().then((function(e){n.json=e,t(n)})).catch((function(){t(n)}))}})).catch((function(e){o(e)})).finally((function(){i&&n.context.clearTimeout(i)}))}))},e}(),m=function(){function e(e){this.enableConsoleLog=e}return e.prototype.onTrace=function(e){this.enableConsoleLog&&console.log("DeviceConfig trace: "+e)},e}(),g=function(){function e(e){this.enableConsoleLog=e}return e.prototype.onValue=function(e){this.enableConsoleLog&&console.log("DeviceConfig analytics value:  ".concat(e))},e.prototype.onError=function(e){this.enableConsoleLog&&console.error("DeviceConfig analytics error: ".concat(e))},e.prototype.onTrace=function(e){this.enableConsoleLog&&console.log("DeviceConfig analytics trace: ".concat(e))},e}(),y=function(){function e(e,t){this.prefix=e,this.storage=t}return e.prototype.getJson=function(e){var t=this.prefix+"_"+e;try{var n=this.storage.getItem(t);if(n)return JSON.parse(n)}catch(e){console.error("Error getting local storage key ".concat(t)+e)}return null},e.prototype.setJson=function(e,t){var n=this.prefix+"_"+e;try{this.storage.setItem(n,JSON.stringify(t))}catch(e){console.error("Error setting local storage key ".concat(n,": ")+e)}},e}(),E=function(){function e(){}return e.prototype.getMillis=function(){return Date.now()},e}();!function(e){e[e.STRING=0]="STRING",e[e.NUMBER=1]="NUMBER",e[e.BOOLEAN=2]="BOOLEAN",e[e.JSON=3]="JSON"}(p||(p={}));var S=function(e,t,n,r,i,o,a,s){switch(this.name=e,this.type=t,this.valueString=n,this.valueNumber=r,this.valueBoolean=i,this.valueJson=o,this.valueAnalytics=a,this.type){case p.STRING:s===l&&n&&(this.valueString=atob(n));break;case p.JSON:s===l&&o&&(this.valueJson=atob(o))}},b=function(){function e(e,t){var n;this.storage=e,this.key=t,this.state=null!==(n=e.getJson(t))&&void 0!==n?n:{}}return e.prototype.getState=function(){return this.state},e.prototype.setState=function(e){Object.assign(this.state,e),this.storage.setJson(this.key,this.state)},e}()},456:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(903),t)},903:function(e,t,n){var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEmitter=void 0;var i=n(228),o=function(){function e(e){var t=e.propagateErrors;this.emitter=new i.EventEmitter,this.propagateErrors=null!=t&&t}return e.prototype.on=function(e,t){t.call=this.wrapCall(e,t),this.emitter.on(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];(t=this.emitter).emit.apply(t,r([e],n,!1))},e.prototype.removeAllListeners=function(){this.emitter.removeAllListeners()},e.prototype.wrapCall=function(e,t){var n=this;return function(r){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];if(n.propagateErrors)t.apply(r,i);else try{t.apply(r,i)}catch(n){var a="Error in callback for ".concat(e),s=t.name;return s&&(a+=" for function ".concat(s)),void console.error(a,n)}}},e}();t.TypedEmitter=o},987:function(e,t,n){var r,i=this&&this.__extends||(r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},r(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&o(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createFsm=t.FsmWildcardState=t.RejectedTransitionError=t.InvalidStateTransitionError=void 0;var u=s(n(293)),c=function(e){function t(t,n){var r=e.call(this,"Invalid transition from '".concat(n,"' via event '").concat(t,"'"))||this;return r.name="InvalidStateTransitionError",r}return i(t,e),t}(Error);t.InvalidStateTransitionError=c;var d=function(e){function t(t,n,r){var i=e.call(this,"Transition from '".concat(n,"' via event '").concat(t,"' was rejected for: ").concat(r))||this;return i.name="RejectedTransitionError",i}return i(t,e),t}(Error);t.RejectedTransitionError=d,t.FsmWildcardState="*",t.createFsm=function(e){var n,r=e.transitions,i=e.callbacks,o=e.initialState,a=function(e){var n,i=null===(n=r[e])||void 0===n?void 0:n.from;return!!i&&("string"==typeof i?i===t.FsmWildcardState:i.includes(o))};return{canTransition:a,transition:function(e,t){var s,l,f,h,p,v;if(!a(e))return u.err(new c(String(o),String(e)));var m=r[e];return void 0===m.shouldTransition||m.shouldTransition(o)?(null===(l=null===(s=null==i?void 0:i[o])||void 0===s?void 0:s.onExiting)||void 0===l||l.call(s),null===(f=null==i?void 0:i.onStateExiting)||void 0===f||f.call(i,o),n=o,o=m.to,null===(p=null===(h=null==i?void 0:i[o])||void 0===h?void 0:h.onChanged)||void 0===p||p.call(h,n,t),null===(v=null==i?void 0:i.onStateChanged)||void 0===v||v.call(i,n,o,t),u.ok(o)):u.err(new d(String(o),String(e),"shouldTransition returned false"))},previousState:function(){return n},currentState:function(){return o}}}},156:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="0.4.9",i(n(815),t),i(n(456),t),i(n(987),t),i(n(293),t)},293:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.getErr=t.getOk_or=t.getOk=t.isNotOk=t.isOk=t.err=t.ok=void 0,t.ok=function(e){return{ok:!0,value:e}},t.err=function(e){return{ok:!1,error:e}},t.isOk=function(e){return!0===e.ok},t.isNotOk=function(e){return!(0,t.isOk)(e)},t.getOk=function(e){return!0===e.ok?e.value:void 0},t.getOk_or=function(e,t){return!0===e.ok?e.value:t},t.getErr=function(e){return!0===e.ok?void 0:e.error}}},t={};return function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}(156)}()},580:function(e,t,n){"use strict";n.d(t,{mC:function(){return a},cp:function(){return f}});var r,i=require("bowser"),o=n(309),a=function(e){return e.CHROME="chrome",e.EDGE="msEdgeChromium",e.FIREFOX="firefox",e.OPERA="opera",e.SAFARI="safari",e}({}),s=/^(\d+)\.(\d+)\.(\d+)[+|-]?(.*)?$/,u=/^(\d+)\.(\d+)[+|-]?(.*)?$/,c=/^(\d+)$/,d=((r={})[a.CHROME]=!1,r[a.EDGE]=!1,r[a.FIREFOX]=!1,r[a.OPERA]=!1,r[a.SAFARI]=!1,r.chromecast=!1,r.domain="",r.electron=!1,r.family="",r.host="",r.major=-1,r.minor=-1,r.msEdgeLegacy=!1,r.msIE=!1,r.name="",r.osName="",r.osVersion="",r.patch=-1,r.url="",r.userAgent="",r.mobile=!1,r.supportsDataChannels=!1,r.supportsWebTransport=!1,r.supportsMSEInWorkers=!1,r),l=null;function f(){var e;if(l)return l;if("undefined"==typeof window||"undefined"==typeof navigator)return l=d;var t,n,r=i.getParser(navigator.userAgent),f=(t=String(r.getBrowserVersion()),n=s.exec(t)||u.exec(t)||c.exec(t)||[],{major:parseInt(n[1],10)||0,minor:parseInt(n[2],10)||0,patch:parseInt(n[3],10)||0}),h=r.getEngine();return(e={})[a.CHROME]=!!r.some([a.CHROME]),e[a.FIREFOX]=!!r.some([a.FIREFOX]),e[a.EDGE]=!!r.some(["microsoft edge"])&&"Blink"===h.name,e[a.OPERA]=!!r.some([a.OPERA]),e[a.SAFARI]=!!r.some([a.SAFARI]),e.chromecast=navigator.userAgent.toLowerCase().indexOf("crkey")>-1,e.domain=window.location.host.split(".").slice(-2).join("."),e.electron=!!r.some(["electron"]),e.family=r.getBrowserName().toLowerCase(),e.host=window.location.host,e.major=f.major,e.minor=f.minor,e.msEdgeLegacy=!!r.some(["microsoft edge"])&&"Blink"!==h.name,e.msIE=!!r.some(["internet explorer"]),e.name=navigator.appVersion,e.osName=r.getOSName(),e.osVersion=String(r.getOSVersion()),e.patch=f.patch,e.url=window.location.href,e.userAgent=navigator.userAgent,e.mobile=!(!r.some(["mobile"])&&!r.some(["tablet"])),e.supportsDataChannels="RTCPeerConnection"in window,e.supportsWebTransport="WebTransport"in window,e.supportsMSEInWorkers=o.Z.isSupportedInWorker(),l=e}},530:function(e,t,n){"use strict";n.d(t,{YJ:function(){return s},aP:function(){return i},bz:function(){return o},dq:function(){return a}});var r=n(580);function i(){return"undefined"!=typeof MediaSource}function o(){var e='video/mp4; codecs="hvc1.1.40000000.L60.80.0.0.0.0.0"';return i()?MediaSource.isTypeSupported(e):""!==document.createElement("video").canPlayType(e)}function a(){var e='video/mp4; codecs="av01.0.05M.08"';return i()?MediaSource.isTypeSupported(e):""!==document.createElement("video").canPlayType(e)}function s(){var e=(0,r.cp)();return"Windows"===e.osName&&(e.chrome||e.firefox||e.msEdgeChromium)&&i()?"mediaCapabilities"in navigator?navigator.mediaCapabilities.decodingInfo({type:"media-source",video:{contentType:'video/mp4;codecs="vp09.00.41.08"',width:1920,height:1080,bitrate:8e6,framerate:60}}).then((function(e){return e.supported&&e.smooth})):Promise.resolve(MediaSource.isTypeSupported('video/mp4;codecs="vp09.00.10.08"')):Promise.resolve(!1)}},554:function(e,t,n){"use strict";n.d(t,{g:function(){return r}});var r=function(e){return e.UNKNOWN="Unspecified",e.FILE="File",e.SEGMENT="Segment",e.SOURCE="Source",e.DECODER="Decode",e.RENDERER="Render",e.MASTER_PLAYLIST="MasterPlaylist",e.MEDIA_PLAYLIST="MediaPlaylist",e.DRM="DRM",e}({})},911:function(e,t,n){"use strict";n.d(t,{B:function(){return r},y:function(){return i}});var r=function(e){return e.GENERIC="Error",e.NOT_SUPPORTED="ErrorNotSupported",e.NO_SOURCE="ErrorNoSource",e.INVALID_DATA="ErrorInvalidData",e.INVALID_STATE="ErrorInvalidState",e.INVALID_PARAMETER="ErrorInvalidParameter",e.TIMEOUT="ErrorTimeout",e.NETWORK="ErrorNetwork",e.NETWORK_IO="ErrorNetworkIO",e.AUTHORIZATION="ErrorAuthorization",e.NOT_AVAILABLE="ErrorNotAvailable",e}({}),i=function(e){return e[e.GEOBLOCKED=1]="GEOBLOCKED",e[e.UNSUPPORTED_DEVICE=2]="UNSUPPORTED_DEVICE",e[e.ANONYMIZER_BLOCKED=3]="ANONYMIZER_BLOCKED",e[e.CELLULAR_NETWORK_PROHIBITED=4]="CELLULAR_NETWORK_PROHIBITED",e[e.UNAUTHORIZATION_ENTITLEMENTS=5]="UNAUTHORIZATION_ENTITLEMENTS",e[e.VOD_RESTRICTED=6]="VOD_RESTRICTED",e}({})},695:function(e,t,n){"use strict";n.d(t,{P:function(){return r}});var r=function(e){return e.CAPTURE_ENABLED="CaptureEnabled",e.CAPTURE_BUNDLE="CaptureBundle",e.CAPTURE_ANALYTICS="CaptureAnalytics",e.FMP4_SEGMENT="FMP4Segment",e}({})},0:function(e,t,n){"use strict";n.d(t,{C:function(){return r},_:function(){return i}});var r=function(e){return e.ID3="MetaID3",e.CAPTION="MetaCaption",e}({}),i=function(e){return e.METADATA_ID="metadata.live-video.net",e.INBAND_METADATA_ID="inband.metadata.live-video.net",e}({})},184:function(e,t,n){"use strict";n.d(t,{a:function(){return r}});var r=function(e){return e.INITIALIZED="PlayerInitialized",e.QUALITY_CHANGED="PlayerQualityChanged",e.DURATION_CHANGED="PlayerDurationChanged",e.VOLUME_CHANGED="PlayerVolumeChanged",e.MUTED_CHANGED="PlayerMutedChanged",e.PLAYBACK_RATE_CHANGED="PlayerPlaybackRateChanged",e.REBUFFERING="PlayerRebuffering",e.AUDIO_BLOCKED="PlayerAudioBlocked",e.PLAYBACK_BLOCKED="PlayerPlaybackBlocked",e.ERROR="PlayerError",e.RECOVERABLE_ERROR="PlayerRecoverableError",e.ANALYTICS_EVENT="PlayerAnalyticsEvent",e.TIME_UPDATE="PlayerTimeUpdate",e.SYNC_TIME_UPDATE="PlayerSyncTimeUpdate",e.BUFFER_UPDATE="PlayerBufferUpdate",e.SEEK_COMPLETED="PlayerSeekCompleted",e.SESSION_DATA="PlayerSessionData",e.STATE_CHANGED="PlayerStateChanged",e.WORKER_ERROR="PlayerWorkerError",e.METADATA="PlayerMetadata",e.TEXT_CUE="PlayerTextCue",e.TEXT_METADATA_CUE="PlayerTextMetadataCue",e.AD_CUE="PlayerAdCue",e.STREAM_SOURCE_CUE="PlayerStreamSourceCue",e.NETWORK_UNAVAILABLE="PlayerNetworkUnavailable",e.SEGMENT_DISCONTINUITY="PlayerSegmentDiscontinuity",e.SEGMENT_METADATA="PlayerSegmentMetadata",e}({})},355:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var r=function(e){return e.AVAILABLE="RemotePlayerAvailable",e.UNAVAILABLE="RemotePlayerUnavailable",e.SESSION_STARTED="RemotePlayerSessionStarted",e.SESSION_ENDED="RemotePlayerSessionEnded",e}({})},376:function(e,t,n){"use strict";n.d(t,{p:function(){return r}});var r=function(e){return e.IDLE="Idle",e.READY="Ready",e.BUFFERING="Buffering",e.PLAYING="Playing",e.ENDED="Ended",e}({})},120:function(e,t,n){"use strict";n.d(t,{KJ:function(){return Sn},vt:function(){return yn},Zx:function(){return vn},HF:function(){return En},i$:function(){return gn},TH:function(){return mn}});var r=n(580),i=require("@babel/runtime/helpers/extends"),o=n.n(i),a=n(184),s=null,u=null;function c(e){if(!e||!e.arg||!e.arg.name)return e;var t=e.type,n=e.arg,r=t===a.a.ANALYTICS_EVENT,i="video-play"===n.name||"minute-watched"===n.name||"video_error"===n.name||n.name.includes("gpu_");if(!r||!i)return e;if(!s&&!u)try{var o=document.createElement("canvas"),c=o.getContext("webgl")||o.getContext("experimental-webgl");if(c&&"getExtension"in c){var d=c.getExtension("WEBGL_debug_renderer_info");d&&"getParameter"in c&&(s=c.getParameter(d.UNMASKED_RENDERER_WEBGL),u=c.getParameter(d.UNMASKED_VENDOR_WEBGL))}}catch(e){}return e.arg.properties.gl_renderer=s,e.arg.properties.gl_vendor=u,e}var d=function(){function e(){var t=this;this.batteryManager=void 0,this.processor=this.processor.bind(this),e.isSupported()&&window.navigator.getBattery().then((function(e){t.batteryManager=e}))}return e.isSupported=function(){var e;return void 0!==(null==(e=window)||null==(e=e.navigator)?void 0:e.getBattery)},e.prototype.processor=function(e){var t=e.type===a.a.ANALYTICS_EVENT,n=e.arg&&"minute-watched"===e.arg.name;return t&&n&&this.batteryManager&&(e.arg.properties.battery_percent=this.batteryManager.level),e},e}(),l=require("@babel/runtime/helpers/asyncToGenerator"),f=n.n(l),h=require("@babel/runtime/regenerator"),p=n.n(h),v=n(139);function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g={enabled:!1,levels:{debug:!0,info:!0,warn:!0,error:!0}},y=function(e){var t=o()({},g),n=function(e){if(t.enabled&&t.levels[e]){for(var n=(new Date).toTimeString().split(" ")[0],r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];console[e].apply(console,[n+" - [VideoTransformer]"].concat(i))}};return{debug:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,[v.$.DEBUG].concat(t))},log:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,[v.$.INFO].concat(t))},info:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,[v.$.INFO].concat(t))},warn:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,[v.$.WARN].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,[v.$.ERROR].concat(t))},setConfig:function(e){var n={debug:!1,info:!1,warn:!1,error:!1},r=function(e,t){for(var r,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(r=i()).done;){var o=r.value;n[o]=t}};switch(e.level){case v.$.DEBUG:r([v.$.DEBUG,v.$.INFO,v.$.WARN,v.$.ERROR],!0);break;case v.$.INFO:r([v.$.INFO,v.$.WARN,v.$.ERROR],!0);break;case v.$.WARN:r([v.$.WARN,v.$.ERROR],!0);break;case v.$.ERROR:r([v.$.ERROR],!0)}t.enabled=e.enabled,t.levels=o()({},n)}}}();y.setConfig({enabled:!0,level:v.$.WARN});var E=function(e){return e.gpu_pending="Awaiting WebGPU adapter",e.gpu_unavailable="WebGPU unavailable",e.gpu_adapter_unavailable="WebGPU adapter unavailable",e.gpu_adapterinfo_undefined="WebGPU adapter.info undefined",e.gpu_error="WebGPU error",e}({}),S=n(530),b=n(290),T={keySystem:"org.w3.clearkey",uuid:"1077efec-c0b2-4d02-ace3-3c1e52e2fb4b"},_={keySystem:"com.apple.fps.2_0",certUrl:"https://fairplay.twitch.keyos.com/api/v4/getCertificate?certHash=a17fd33d3843df9b17679ccf50a419b2",licenseUrl:"https://fairplay.twitch.keyos.com/api/v4/getLicense",uuid:"94CE86FB-07FF-4F43-ADB8-93D2FA968CA2"},C={keySystem:"com.microsoft.playready",licenseUrl:"https://playready.twitch.keyos.com/api/v4/getLicense",uuid:"9a04f079-9840-4286-ab92-e65be0885f95"},w={keySystem:"com.widevine.alpha",licenseUrl:"https://widevine.twitch.keyos.com/api/v4/getLicense",uuid:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"},k={CLEARKEY:T,FAIRPLAY:_,PLAYREADY:C,WIDEVINE:w},I={"com.widevine.alpha":w,"com.microsoft.playready":C,"com.apple.fps.2_0":_,"org.w3.clearkey":T},P=b.a1,A=b.Pt,D={value:A,message:"Your browser does not support any DRM Content Decryption Modules"},L={value:A,message:"There was an issue while updating DRM License"},M={value:b.Ec,message:"Error while requesting DRM license"},R={value:b.Ri,message:"DRM license not available"},x={NO_CDM_SUPPORT:D,SESSION_UPDATE:L,LICENSE_REQUEST:M,LICENSE_REQUEST_AUTHORIZATION:{value:b.$1,message:"DRM license not authorized for this browser version"},LICENSE_REQUEST_NOT_AVAILABLE:R,LICENSE_SERVER:{value:b.xA,message:"DRM license server error"},KEY_SESSION_CREATION:{value:A,message:"Error creating key session"},KEY_SESSION_INTERNAL:{value:A,message:"Encryption key not usable because of internal error in CDM"},NO_PSSH_FOUND:{value:A,message:"Unable to find valid CDM support on media"},AUTH_XML_REQUEST:{value:P,message:"Request for AuthXML failed"},CERT_REQUEST:{value:P,message:"Request for DRM certificate failed"}};function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function N(e){return window.WebKitMediaKeys&&"function"==typeof window.WebKitMediaKeys.isTypeSupported&&window.WebKitMediaKeys.isTypeSupported(k.FAIRPLAY.keySystem)?k.FAIRPLAY.uuid:"function"==typeof navigator.requestMediaKeySystemAccess?e.safari?"":e.msIE||e.msEdgeLegacy?k.PLAYREADY.uuid:k.WIDEVINE.uuid:""}function U(e,t){if((e=F(e))===(t=F(t)))return!0;if(e.byteLength!==t.byteLength)return!1;for(var n=new DataView(e),r=new DataView(t),i=0;i<n.byteLength;i++)if(n.getUint8(i)!==r.getUint8(i))return!1;return!0}function F(e){return e instanceof Uint8Array||e instanceof Uint16Array?e.buffer:e}function V(e){return t=function(e){if(null===e)return[];for(var t=new DataView(e.buffer||e),n=[],r=0;!(r>=t.buffer.byteLength);){var i=r+t.getUint32(r);if(r+=4,t.getUint32(r)===W("pssh")){r+=4;var o=t.getUint8(r);if(0===o||1===o){r++,r+=3;for(var a="",s=0;s<4;s++)a+=K(t.getUint8(r+s));r+=4,a+="-";for(var u=0;u<2;u++)a+=K(t.getUint8(r+u));r+=2,a+="-";for(var c=0;c<2;c++)a+=K(t.getUint8(r+c));r+=2,a+="-";for(var d=0;d<2;d++)a+=K(t.getUint8(r+d));r+=2,a+="-";for(var l=0;l<6;l++)a+=K(t.getUint8(r+l));r+=6,a=a.toLowerCase(),r+=4,n.push(a),r=i}else r=i}else r=i}return n}(e),n=[],t.forEach((function(e){Object.keys(k).forEach((function(t){var r=k[t];r.uuid.toLowerCase()===e.toLowerCase()&&n.push(r)}))})),n;var t,n}function B(e,t){return new Promise((function(n,r){var i=new XMLHttpRequest;for(var o in i.open(t.method,e,!0),t.headers)Object.prototype.hasOwnProperty.call(t.headers,o)&&i.setRequestHeader(o,t.headers[o]);i.responseType=t.responseType,i.onload=function(){200===i.status&&n(i.response)},i.onloadend=function(){r(i.status)},i.send(t.body)}))}function G(e){var t=H(j(JSON.parse(String.fromCharCode.apply(null,e)).sinf[0]),"schi");return function(e){for(var t,n="",r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(t=r()).done;)n+=K(t.value);return n}(H(t,"tenc").subarray(8,24))}function H(e,t){for(var n=new DataView(e.buffer,e.byteOffset,e.byteLength),r=W(t),i=0;i<e.byteLength;){var o=n.getUint32(i);if(n.getUint32(i+4)===r)return e.subarray(i+8,i+o);i+=o}return new Uint8Array(e)}function W(e){return(e.charCodeAt(0)<<24)+(e.charCodeAt(1)<<16)+(e.charCodeAt(2)<<8)+e.charCodeAt(3)}function K(e){var t=e.toString(16);return 1===t.length?"0"+t:t}function j(e){for(var t=atob(e),n=t.length,r=new Uint8Array(n),i=0;i<n;i++)r[i]=t.charCodeAt(i);return r}function z(e){return decodeURIComponent(e.replace(/\+/g," "))}var q=n(0),Q=n(355),Y=n(376);function Z(e){var t=e.querySelector("Challenge"),n=null==t?void 0:t.textContent;return n?atob(n):""}function J(e){var t=e.querySelectorAll("HttpHeader");return Array.from(t).reduce((function(e,t){var n,r,i=null==(n=t.querySelector("name"))?void 0:n.textContent,o=null==(r=t.querySelector("value"))?void 0:r.textContent;return i&&o&&(e[i]=o),e}),{})}function X(e){var t=String.fromCharCode.apply(null,new Uint16Array(e)),n=(new DOMParser).parseFromString(t,"application/xml");return{headers:J(n),body:Z(n)}}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ee=[{initDataTypes:["cenc"],audioCapabilities:[{contentType:'audio/mp4;codecs="mp4a.40.2"'}],videoCapabilities:[{robustness:"SW_SECURE_CRYPTO",contentType:'video/mp4;codecs="avc1.42E01E"'}]}],te=function(){function e(e){var t=this;this.video=void 0,this.listener=void 0,this.cdmSupport=void 0,this.selectedCDM=void 0,this.mediaKeys=void 0,this.pendingSessions=void 0,this.sessions=void 0,this.authXml=void 0,this.video=e.video,this.listener=e.listener,this.cdmSupport=null,this.selectedCDM=null,this.mediaKeys=void 0,this.pendingSessions=[],this.reset(),this.video.addEventListener("encrypted",(function(e){return t.handleEncrypted(e)})),this.video.addEventListener("webkitneedkey",(function(e){return t.handleWebKitEncrypted(e)}))}var t=e.prototype;return t.configure=function(e){var t=this;if(!this.authXml){var n=new URL(e),r=n.pathname.split("/"),i=r[r.length-1].split(".")[0],o=function(e){var t=new URL(e).searchParams,n={};return t.forEach((function(e,t){n[z(t)]=e?z(e):""})),n}(e),a=o.token,s=o.sig,u="https://"+n.host+"/api/authxml/"+i+"?token="+encodeURIComponent(a)+"&sig="+s;this.authXml=B(u,{method:"GET",responseType:"text"}).catch((function(e){t.handleError(Object.assign({code:e},x.AUTH_XML_REQUEST))}))}},t.reset=function(){this.authXml=null,this.sessions=[]},t.isProtected=function(){return null!==this.authXml},t.handleError=function(e){this.listener.onSinkError({value:e.value||b.Pt,code:e.code||0,message:e.message||""})},t.hasSession=function(e){if(!e)return!1;for(var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return $(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.sessions);!(t=n()).done;){var r=t.value;if(r.initData&&U(r.initData,e))return!0}return!1},t.createKeySystemSupportChain=function(){if(null===this.cdmSupport||0===this.cdmSupport.length)return Promise.reject(x.NO_PSSH_FOUND);var e=Promise.reject();return this.cdmSupport.forEach((function(t){e=e.catch((function(){return navigator.requestMediaKeySystemAccess(t.keySystem,ee)}))})),e=e.catch((function(){return Promise.reject(x.NO_CDM_SUPPORT)}))},t.handleEncrypted=function(){var e=f()(p().mark((function e(t){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.hasSession(t.initData)){e.next=2;break}return e.abrupt("return");case 2:if(this.sessions.push(t),"sinf"!==t.initDataType){e.next=6;break}return this.handleWebKitEncrypted(t),e.abrupt("return");case 6:if(null===this.cdmSupport&&(this.cdmSupport=V(t.initData)),void 0!==this.mediaKeys){e.next=24;break}return this.mediaKeys=null,e.prev=9,e.next=12,this.createKeySystemSupportChain();case 12:return n=e.sent,this.selectedCDM=I[n.keySystem],e.next=16,n.createMediaKeys();case 16:return r=e.sent,e.next=19,this.setMediaKeys(r);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),this.handleError(e.t0);case 24:this.addSession(t);case 25:case"end":return e.stop()}}),e,this,[[9,21]])})));return function(t){return e.apply(this,arguments)}}(),t.setMediaKeys=function(e){var t=this;return this.mediaKeys=e,this.pendingSessions.forEach((function(e){return t.createSessionRequest(e).catch((function(){t.handleError(x.KEY_SESSION_CREATION)}))})),this.pendingSessions=[],this.video.setMediaKeys(this.mediaKeys)},t.addSession=function(e){var t=this;this.mediaKeys?this.createSessionRequest(e).catch((function(){t.handleError(x.KEY_SESSION_CREATION)})):this.pendingSessions.push(e)},t.createSessionRequest=function(e){var t,n=this,r=e.initDataType,i=e.initData,o=null==(t=this.mediaKeys)?void 0:t.createSession();return o?(o.addEventListener("message",(function(e){return n.handleMessage(e)})),o.addEventListener("keystatuseschange",(function(e){return n.handleKeyStatusesChange(e,i)})),o.generateRequest(r,i)):Promise.reject()},t.handleKeyStatusesChange=function(e,t){var n=this,r=e.target,i=!1;r.keyStatuses.forEach((function(e){switch(e){case"expired":i=!0;break;case"internal-error":n.handleError(x.KEY_SESSION_INTERNAL)}})),i&&r.close().then((function(){return n.removeSession(t)}))},t.removeSession=function(e){for(var t=0;t<this.sessions.length;t++)if(this.sessions[t].initData===e)return void this.sessions.splice(t,1)},t.handleMessage=function(){var e=f()(p().mark((function e(t){var n,r,i=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.target,e.next=3,this.generateLicense(t.message);case 3:(r=e.sent)&&n.update(r).catch((function(){i.handleError(x.SESSION_UPDATE)}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.generateLicense=function(){var e=f()(p().mark((function e(t){var n,r,i,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.selectedCDM!==k.CLEARKEY){e.next=5;break}return n=JSON.parse((new TextDecoder).decode(t)),r=n.kids.map((function(e){return{kty:"oct",alg:"A128KW",kid:e,k:e}})),i=(new TextEncoder).encode(JSON.stringify({keys:r})),e.abrupt("return",Promise.resolve(i));case 5:if(!this.authXml){e.next=10;break}return e.next=8,this.authXml;case 8:return o=e.sent,e.abrupt("return",this.requestLicense(t,o));case 10:this.handleError(x.AUTH_XML_REQUEST);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.requestLicense=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={method:"POST",responseType:"arraybuffer",body:t,headers:{customdata:n,"Content-Type":"application/octet-stream"}},this.selectedCDM===k.PLAYREADY&&(o=X(t),i.body=o.body,i.headers=Object.assign(i.headers,o.headers)),e.abrupt("return",B((null==(r=this.selectedCDM)?void 0:r.licenseUrl)||"",i).catch((function(e){var t;switch(e){case 0:t=x.LICENSE_REQUEST;break;case 404:t=x.LICENSE_REQUEST_NOT_AVAILABLE;break;case 403:t=x.LICENSE_REQUEST_AUTHORIZATION;break;default:t=x.LICENSE_SERVER}a.handleError(Object.assign({code:e},t))})));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.handleWebKitEncrypted=function(){var e=f()(p().mark((function e(t){var n,r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.selectedCDM=k.FAIRPLAY,e.prev=1,e.next=4,B(k.FAIRPLAY.certUrl||"",{method:"GET",responseType:"arraybuffer",headers:{Pragma:"Cache-Control: no-cache","Cache-Control":"max-age=0"}});case 4:n=e.sent,this.setupWebKitMediaKeys(t,n).catch((function(e){return r.handleError(e)})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.handleError(Object.assign({code:e.t0},x.CERT_REQUEST));case 11:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),t.setupWebKitMediaKeys=function(e,t){var n=this;if(!e.initData)return Promise.reject("Missing initData on MediaEncryptedEvent");this.video.webkitKeys||this.video.webkitSetMediaKeys(new window.WebKitMediaKeys(k.FAIRPLAY.keySystem));var r=G(e.initData),i=this.video.webkitKeys.createSession("video/mp4",e.initData);return i.contentId=r,new Promise((function(e,o){if(n.video.webkitKeys||o("Issue setting fairplay media keys"),!i)return o("Could not create key session");i.addEventListener("webkitkeymessage",(function(e){var i=e.target;"certificate"===String.fromCharCode.apply(null,e.message)?i.update(new Uint8Array(t)):n.getWebkitLicense(e.message,r).then((function(e){var t=e.trim();"<ckc>"===t.substr(0,5)&&"</ckc>"===t.substr(-6)&&(t=t.slice(5,-6)),i.update(j(t))})).catch(o)})),i.addEventListener("webkitkeyadded",e),i.addEventListener("webkitkeyerror",o)}))},t.getWebkitLicense=function(e,t){return this.authXml?this.authXml.then((function(n){var r;return B(k.FAIRPLAY.licenseUrl||"",{method:"POST",body:"spc="+(r=e,btoa(String.fromCharCode.apply(null,new Uint16Array(r)))+"&assetId=")+t,responseType:"text",headers:{"Content-Type":"application/x-www-form-urlencoded",customdata:n}}).catch((function(e){return Promise.reject(Object.assign({code:e},x.LICENSE_REQUEST))}))})):Promise.reject(x.AUTH_XML_REQUEST)},e}(),ne=require("@babel/runtime/helpers/inheritsLoose"),re=n.n(ne),ie=function(){function e(){}var t=e.prototype;return t.addTrack=function(e){},t.bufferDuration=function(){return 0},t.buffered=function(){return{start:0,end:0}},t.getBufferedRanges=function(e){return[]},t.captureGesture=function(){},t.configure=function(e){},t.delete=function(){},t.endOfStream=function(){},t.enqueue=function(e){},t.getCurrentTime=function(){return 0},t.getPlaybackRate=function(){return 0},t.getVolume=function(){return 0},t.invoke=function(e){this[e.name].call(this,e.arg)},t.isMuted=function(){return!1},t.onSourceDurationChanged=function(e){},t.pause=function(){},t.play=function(){},t.reinit=function(){},t.remove=function(e){},t.seekTo=function(e){},t.setMuted=function(e){},t.setPlaybackRate=function(e){},t.setTimestampOffset=function(e){},t.setVolume=function(e){},t.changeSrc=function(e){},t.changeSrcObj=function(e){},t.onSegmentDiscontinuity=function(){},e}(),oe="pc-chromecast-sender",ae=function(e){function t(n){var r;return(r=e.call(this)||this).remotePlayer=void 0,r.remotePlayerController=void 0,r.listener=void 0,r.seekTime=void 0,r.currentDuration=void 0,r.listener=n,r.currentDuration=0,t.prepareCastContext().then((function(){r.remotePlayer=new cast.framework.RemotePlayer,r.remotePlayerController=new cast.framework.RemotePlayerController(r.remotePlayer)})).catch((function(){r.listener.onSessionError()})),r}re()(t,e),t.canCast=function(){return(0,r.cp)().chrome},t.stopLookingForRemotePlaybackDevices=function(e){window.cast&&window.cast.framework&&cast.framework.CastContext.getInstance().removeEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,e)},t.lookForRemotePlaybackDevices=function(){var e=f()(p().mark((function e(n){var r,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.prepareCastContext();case 3:return r=e.sent,i=function(e){switch(e.castState){case cast.framework.CastState.NO_DEVICES_AVAILABLE:break;case cast.framework.CastState.NOT_CONNECTED:n.onRemoteDevice(!0);break;case cast.framework.CastState.CONNECTED:var t=r.getCurrentSession();t&&t.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&n.onRemoteReconnect()}},r.addEventListener(cast.framework.CastContextEventType.CAST_STATE_CHANGED,i),r.setOptions({receiverApplicationId:"B3DCF968",autoJoinPolicy:chrome.cast.AutoJoinPolicy.TAB_AND_ORIGIN_SCOPED}),e.abrupt("return",i);case 10:e.prev=10,e.t0=e.catch(0),n.onRemoteDevice(!1);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),t.prepareCastContext=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.cast||!window.cast.framework){e.next=2;break}return e.abrupt("return",Promise.resolve(cast.framework.CastContext.getInstance()));case 2:return e.abrupt("return",new Promise((function(e,t){if(n.g.__onGCastApiAvailable=function(n){n?e(cast.framework.CastContext.getInstance()):t()},!document.getElementById(oe)){var r=document.createElement("script");r.id=oe,r.onerror=function(){document.body.removeChild(r),n.g.__onGCastApiAvailable=function(){},t()},r.async=!0,r.src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1",document.body.appendChild(r)}})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();var i=t.prototype;return i.configure=function(){var e=f()(p().mark((function e(n){var r,i,o,a,s,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.path,e.prev=1,e.next=4,t.prepareCastContext();case 4:if(o=e.sent,a=o.getCurrentSession()){e.next=13;break}return e.next=9,o.requestSession();case 9:a=o.getCurrentSession(),this.setupRemotePlayerListeners(a),e.next=14;break;case 13:a.getSessionState()===cast.framework.SessionState.SESSION_RESUMED&&this.setupRemotePlayerListeners(a);case 14:return(s=new chrome.cast.media.MediaInfo(r,"")).streamType=chrome.cast.media.StreamType.BUFFERED,u=new chrome.cast.media.GenericMediaMetadata,s.metadata=u,s.customData={analytics:{chromecast_sender:"player-core",platform:"web"}},this.remotePlayerController.stop(),c=new chrome.cast.media.LoadRequest(s),this.seekTime>0&&(c.currentTime=this.seekTime,this.seekTime=0),this.currentDuration=0,e.next=25,null==(i=a)?void 0:i.loadMedia(c);case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(1),e.abrupt("return",this.handleError(e.t0));case 30:case"end":return e.stop()}}),e,this,[[1,27]])})));return function(t){return e.apply(this,arguments)}}(),i.stopMedia=function(){var e=f()(p().mark((function e(n){var r,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===n&&(n=!0),e.next=3,t.prepareCastContext();case 3:r=e.sent,(i=r.getCurrentSession())&&i.getSessionState()!==cast.framework.SessionState.SESSION_RESUMED&&i.endSession(n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),i.invoke=function(e){this[e.name].call(this,e.arg)},i.play=function(){this.remotePlayer&&this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},i.pause=function(){this.remotePlayer&&!this.remotePlayer.isPaused&&this.remotePlayerController.playOrPause()},i.seekTo=function(e){this.remotePlayer&&(this.remotePlayer.playerState!==chrome.cast.media.PlayerState.IDLE?(this.remotePlayer.currentTime=e,this.remotePlayerController.seek()):this.seekTime=e)},i.getCurrentTime=function(){return this.remotePlayer?this.remotePlayer.currentTime:0},i.delete=function(){this.remotePlayer&&this.stopMedia()},i.setMuted=function(e){this.remotePlayer&&e!==this.remotePlayer.isMuted&&this.remotePlayerController.muteOrUnmute()},i.isMuted=function(){return!!this.remotePlayer&&this.remotePlayer.isMuted},i.setVolume=function(e){this.remotePlayer&&(this.remotePlayer.volumeLevel=e,this.remotePlayerController.setVolumeLevel())},i.getVolume=function(){return this.remotePlayer?this.remotePlayer.volumeLevel:0},i.getDevice=function(){var e=f()(p().mark((function e(){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.prepareCastContext();case 2:return n=e.sent,r=n.getCurrentSession(),e.abrupt("return",(null==r?void 0:r.getCastDevice().friendlyName)||"");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i.setupRemotePlayerListeners=function(e){var t=this,n=function(){var n=f()(p().mark((function n(){var r,i;return p().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(r=e.getMediaSession())&&(i=r.media,0===t.currentDuration&&null===i.duration&&(t.currentDuration=1/0,t.listener.onSinkDurationChanged(t.currentDuration)),t.listener.onSinkTimeUpdate());case 2:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),r=function(){switch(t.remotePlayer.playerState){case chrome.cast.media.PlayerState.BUFFERING:t.listener.onSinkIdle();break;case chrome.cast.media.PlayerState.PLAYING:t.listener.onSinkPlaying(!1);break;case chrome.cast.media.PlayerState.IDLE:var n=e.getMediaSession();n&&n.idleReason===chrome.cast.media.IdleReason.FINISHED&&t.listener.onSinkEnded()}},i=function(){t.listener.onSinkVolumeChanged(t.remotePlayer.volumeLevel,!0)},o=function(){t.listener.onSinkMutedChanged(t.remotePlayer.isMuted)},a=function(){0!==t.remotePlayer.duration&&(t.currentDuration=t.remotePlayer.duration,t.listener.onSinkDurationChanged(t.currentDuration))},s=function(){t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,n),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,r),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,i),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),t.remotePlayerController.removeEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,a),t.listener.onSessionStop()};e.addEventListener(cast.framework.SessionEventType.MEDIA_SESSION,(function(){t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.CURRENT_TIME_CHANGED,n),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.PLAYER_STATE_CHANGED,r),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.VOLUME_LEVEL_CHANGED,i),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.IS_MUTED_CHANGED,o),t.remotePlayerController.addEventListener(cast.framework.RemotePlayerEventType.DURATION_CHANGED,a),t.listener.onSessionStarted(e.getCastDevice().friendlyName)}));var u=e.getSessionObj();u.addUpdateListener((function(){u.status===chrome.cast.SessionStatus.STOPPED&&s()})),u.addMediaListener(s)},i.handleError=function(e){if(chrome.cast)switch(e){case chrome.cast.ErrorCode.SESSION_ERROR:this.listener.onSessionError();break;case chrome.cast.ErrorCode.RECEIVER_UNAVAILABLE:this.listener.onRemoteDevice(!1);break;case chrome.cast.ErrorCode.LOAD_MEDIA_FAILED:this.listener.onLoadMediaError();break;case chrome.cast.ErrorCode.CANCEL:this.listener.onUserCancel();break;default:this.listener.onSinkError({value:1,code:0,message:"Error requesting chromecast session"})}else this.listener.onSinkError({value:1,code:0,message:"Error loading chromecast SDK"})},t}(ie),se=function(e){function t(t){var n;return(n=e.call(this)||this).video=void 0,n.video=t,n}re()(t,e);var n=t.prototype;return n.seekTo=function(e){this.video.currentTime=e},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getPlaybackRate=function(){return this.video.playbackRate},t}(ie),ue=n(623),ce=function(){function e(e,t){this.muted=void 0,this.video=void 0,this.listener=void 0,this.unsubscribes=[],this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1,this.expectedRateChange=void 0,this.video=e,this.listener=t,this.muted=e.muted,this.unsubscribes.push((0,ue.B1)(e,"volumechange",this.volumeChange.bind(this))),this.unsubscribes.push((0,ue.B1)(e,"ratechange",this.rateChange.bind(this)))}var t=e.prototype;return t.volumeChange=function(){var e=!this.expectingVolumeChanged;this.expectingMutedChanged=!1,this.expectingVolumeChanged=!1;var t=this.video.muted;this.muted!==t?(this.muted=t,this.listener.onSinkMutedChanged(t)):this.listener.onSinkVolumeChanged(this.video.volume,e)},t.rateChange=function(){this.video.playbackRate!==this.expectedRateChange&&this.listener.onSinkPlaybackRateChanged(this.video.playbackRate)},t.unsubscribe=function(){this.unsubscribes.forEach((function(e){return e()}))},t.onConfigure=function(){this.expectingVolumeChanged&&(this.listener.onSinkVolumeChanged(this.video.volume,!1),this.expectingVolumeChanged=!1),this.expectingMutedChanged&&(this.muted=this.video.muted,this.listener.onSinkMutedChanged(this.video.muted),this.expectingMutedChanged=!1),this.expectedRateChange=void 0},t.trackRPC=function(e){var t=e.name,n=e.arg;"setVolume"===t&&this.video.volume!==n?this.expectingVolumeChanged=!0:"setMuted"===t&&this.video.muted!==n?this.expectingMutedChanged=!0:"setPlaybackRate"===t&&this.video.playbackRate!==n&&(this.expectedRateChange=n)},e}(),de=require("promise-polyfill"),le=n.n(de),fe=("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n.g?n.g:void 0).Promise||le(),he=function(e){function t(t,n){var r;return(r=e.call(this)||this).paused=!0,r.listener=void 0,r.video=void 0,r.unsubscribers=void 0,r.lastVolumeChangeEvent=void 0,r.video=t,r.listener=n,r.paused=!0,r.unsubscribers=[],r.addListener("volumechange",r.recordMuteChange.bind(r)),r.recordMuteChange(),r}re()(t,e);var n=t.prototype;return n.pause=function(){this.paused=!0,this.video.pause()},n.setPlaybackRate=function(e){this.video.playbackRate=e},n.delete=function(){this.unsubscribers.forEach((function(e){return e()}))},n.addListener=function(e,t,n){void 0===n&&(n=this.video),this.unsubscribers.push((0,ue.B1)(n,e,t))},n.recordMuteChange=function(){this.lastVolumeChangeEvent={time:this.video.currentTime,muted:this.video.muted}},n.checkStopped=function(e){return!this.video.paused||this.video.ended||this.video.error||this.paused||this.listener.onSinkStop(e||this.unmuteAutopause()),!1},n.unmuteAutopause=function(){var e=this.lastVolumeChangeEvent;return!this.video.muted&&!e.muted&&this.video.currentTime===e.time},t}(ie),pe=n(789),ve=function(e){function t(t,n){var r;return(r=e.call(this,t,n)||this).onSinkIdle=void 0,r.intervalId=void 0,r.idle=void 0,r.lastPlayhead=void 0,r.lastBufferEnd=void 0,r.idleTimeout=void 0,r.playAttempt=!1,r.seeking=!1,r.audioBufferList=void 0,r.awaitingAutoplayCompletion=!1,r.intervalId=0,r.idle=!0,r.lastPlayhead=0,r.lastBufferEnd=0,r.idleTimeout=-1,r.audioBufferList=[],r.bindEvents(),r}re()(t,e);var n=t.prototype;return n.bindEvents=function(){var e=this;this.addListener("play",(function(){return e.onVideoPlay()})),this.addListener("pause",(function(){return e.onVideoPause()})),this.addListener("timeupdate",(function(){return e.onVideoTimeUpdate()})),this.addListener("ended",(function(){return e.onVideoEnded()})),this.addListener("error",(function(){return e.onVideoError()})),this.addListener("playing",(function(){return e.onVideoPlaying()})),this.addListener("seeking",(function(){return e.onVideoSeeking()}))},n.delete=function(){e.prototype.delete.call(this),this.audioBufferList=[],clearInterval(this.intervalId)},n.play=function(){this.paused=!1;for(var e=this.video.buffered,t=0,n=0;n<e.length;n++){var r=e.start(n);if(this.video.currentTime<=r){t=r;break}}this.video.currentTime<t&&(console.warn("Moving to buffered region",t,this.video.currentTime),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.playInternal()},n.endOfStream=function(){this.idle=!1,clearTimeout(this.idleTimeout),this.idleTimeout=-1},n.seekTo=function(e){this.video.seekable.length&&e!==this.video.currentTime&&(this.seeking=!0,this.video.currentTime=e)},n.addSourceBuffer=function(e,t){(t.indexOf("mp4a")>-1||t.indexOf("opus")>-1)&&(this.audioBufferList=[e])},n.clearSourceBuffers=function(){this.audioBufferList=[]},n.onIdle=function(){var e;this.listener.onSinkIdle(),null==(e=this.onSinkIdle)||e.call(this)},n.onVideoPlay=function(){var e=this;this.playAttempt?(this.lastPlayhead=this.video.currentTime,clearInterval(this.intervalId),this.intervalId=self.setInterval((function(){return e.heartbeat()}),pe.HJ)):(this.pause(),this.listener.play()),this.playAttempt=!1},n.onVideoPause=function(){this.awaitingAutoplayCompletion||(this.checkStopped(!1),clearInterval(this.intervalId))},n.onVideoTimeUpdate=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.listener.onSinkTimeUpdate();var e=(0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de);this.checkBufferUpdate(e),this.updateIdle(e)},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){this.video.paused||this.listener.onSinkPlaying(this.paused)},n.onVideoSeeking=function(){this.seeking?this.seeking=!1:this.listener.seekTo(this.video.currentTime)},n.onVideoError=function(){var e,t,n=null!=(e=null==this||null==(t=this.video)?void 0:t.error)?e:{},r=n.code,i=void 0===r?-1:r,o=n.message,a=void 0===o?"":o;this.listener.onSinkError({value:i,code:i,message:a})},n.heartbeat=function(){var e=(0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de);if(this.video.paused)clearInterval(this.intervalId);else if(this.video.currentTime===this.lastPlayhead){var t=(0,ue.tX)(this.video.buffered,this.video.currentTime,pe.de);t!==this.video.currentTime&&(this.audioBufferList.map((function(e){(0,ue.gd)("Audio Buffer",e.buffered)})),(0,ue.gd)("<video> Buffer",this.video.buffered),console.warn("jumping "+(t-this.video.currentTime)+"s gap, current position "+this.video.currentTime+", new position "+t),this.listener.onSinkGapJump(t-this.video.currentTime),this.seekTo(t)),this.updateIdle(e,t===this.video.currentTime)}else this.checkBufferUpdate(e),this.lastPlayhead=this.video.currentTime},n.checkBufferUpdate=function(e){var t=e.end;t!==this.lastBufferEnd&&(this.lastBufferEnd=t,this.listener.onSinkBufferUpdate())},n.updateIdle=function(e,t){var n=this,r=e.end,i=void 0===r?0:r;void 0===t&&(t=!1);var o=this.video,a=o.buffered,s=o.currentTime;if(o.paused)this.idle=!0;else{var u=[i].concat(this.audioBufferList.map((function(e){return(0,ue.vG)(e.buffered,s,pe.de).end}))),c=Math.max.apply(null,u);Number.isFinite(c)||(c=0);var d=a.length,l=d>0?a.end(d-1):i,f=c-s<pe.de||t&&i>l;f&&!this.idle&&(console.warn("playhead",s,"max buffer",c,"max played",l),clearTimeout(this.idleTimeout),this.idleTimeout=self.setTimeout((function(){return n.onBufferingTimeout()}),pe.Pp),this.onIdle()),this.idle=f}},n.onBufferingTimeout=function(){clearTimeout(this.idleTimeout),this.idleTimeout=-1,this.listener.onSinkError({value:b.yY,code:b.yY,message:"Buffering timeout"})},n.playInternal=function(){var e=this;this.playAttempt=!0,this.awaitingAutoplayCompletion=!0,fe.resolve(this.video.play()).then((function(){e.awaitingAutoplayCompletion=!1})).catch((function(){e.playAttempt=!1,e.checkStopped(!0)}))},t}(he),me=function(e){function t(t,n){var r;return(r=e.call(this)||this).listener=t,r.video=n,r.playbackMonitor=void 0,r.controlsObserver=void 0,r.playbackMonitor=new ve(n,t),r.observeControlsChange(),r}re()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.srcObj;this.video.srcObject||(this.video.srcObject=t)},n.invoke=function(e){this[e.name].call(this,e.arg)},n.play=function(){this.playbackMonitor.play()},n.pause=function(){this.playbackMonitor.pause()},n.seekTo=function(e){this.playbackMonitor.seekTo(e)},n.endOfStream=function(){this.playbackMonitor.endOfStream()},n.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},n.getVolume=function(){return this.video.volume},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},n.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.buffered=function(){return(0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de)},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},n.changeSrcObj=function(e){var t=this.video,n=t.playbackRate;t.srcObject=e,t.playbackRate=n},n.delete=function(){var e;this.playbackMonitor.delete(),this.video.srcObject=null,(0,ue.v8)(this.video),null==(e=this.controlsObserver)||e.disconnect()},n.observeControlsChange=function(){var e=this.listener,t=this.video;try{(this.controlsObserver=new MutationObserver((function(){e.onSinkControlsChanged(t.controls)}))).observe(t,{attributeFilter:["controls"]}),e.onSinkControlsChanged(t.controls)}catch(e){}},t}(ie),ge=n(309),ye=function(){function e(e,t,n){void 0===n&&(n=new ve(t,e)),this.listener=e,this.video=t,this.playbackMonitor=n,this.controlsObserver=void 0,this.mseSink=void 0,this.awaitSink=void 0,this.observeControlsChange(),this.awaitSink=void 0,(0,ue.B1)(t,"error",this.onVideoError.bind(this))}var t=e.prototype;return t.invoke=function(e){var t=this.awaitSink,n=this.mseSink;t&&n?["enqueue","addTrack","setTimestampOffset"].includes(e.name)?this.invokeAsync(e):this.invokeSync(e):t?this.invokeAsync(e):n&&this.invokeSync(e)},t.initSink=function(){var e=this,t=this.awaitSink;if(!this.mseSink&&!t){var n=ge.Z.create(this.onMediaSourceEnded.bind(this),this.onMediaSourceError.bind(this));this.awaitSink=new fe((function(t,r){n.sink.then((function(n){e.handleCreateSuccess(n),t()})).catch((function(t){e.handleCreateError(t),r()}))})),this.changeSrc(URL.createObjectURL(n.ms))}},t.configure=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected;this.initSink(),this.awaitSink||!this.isContentProtectionChanging(e)&&!this.isChangingToFromAudioOnly(e)||this.queueNewSink(),this.invoke({name:"addTrack",arg:o()({},Ee,{trackID:t,codec:n,group:r,isProtected:i})})},t.queueNewSink=function(){var e=this;this.awaitSink=new fe((function(t,n){e.deferUntilIdle().then((function(){var t=ge.Z.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink})).then((function(n){e.destroyMSESink(),e.handleCreateSuccess(n),e.play(),t()})).catch((function(t){e.handleCreateError(t),n()}))}))},t.addTrack=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected,o=this.mseSink;try{var a=null==o?void 0:o.addTrack(t,n,r,i);a&&this.playbackMonitor.addSourceBuffer(a,n)}catch(e){this.handleCreateError(e)}},t.enqueue=function(e){var t,n=e.trackID,r=e.buffer;null==(t=this.mseSink)||t.append(n,r)},t.endOfStream=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.endOfStream()}))},t.setTimestampOffset=function(e){var t,n=e.trackID,r=e.offset;null==(t=this.mseSink)||t.setTimestampOffset(n,r)},t.onSourceDurationChanged=function(e){var t=this.mseSink,n=this.video;if(t){var r=t.duration,i=function(e,t,n){var r=e;return e===1/0||e===pe.Sf?n?r=1/0:n||(r=pe.Sf):e!==t&&(r=e),r}(e,r,n.controls);i!==r&&t.setDuration(i)}},t.play=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.play()}))},t.pause=function(){var e,t=this;null==(e=this.mseSink)||e.scheduleUpdate().then((function(){return t.playbackMonitor.pause()}))},t.remove=function(e){var t,n=e.start,r=e.end;null==(t=this.mseSink)||t.remove(n,r)},t.seekTo=function(e){var t=this.mseSink,n=this.playbackMonitor,r=this.video,i=(0,ue.vG)(r.buffered,r.currentTime,pe.de),o=i.start,a=i.end;e>=o&&e<a?null==t||t.scheduleUpdate().then((function(){return n.seekTo(e)})):n.seekTo(e)},t.setVolume=function(e){this.video.volume!==e&&(this.video.volume=e)},t.getVolume=function(){return this.video.volume},t.isMuted=function(){return this.video.muted},t.setMuted=function(e){this.video.muted!==e&&(this.video.muted=e)},t.setPlaybackRate=function(e){this.playbackMonitor.setPlaybackRate(e)},t.getPlaybackRate=function(){return this.video.playbackRate},t.getCurrentTime=function(){return this.video.currentTime},t.buffered=function(){return(0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de)},t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.mseSink)?void 0:n.getBufferedRanges(e))?t:[]},t.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},t.captureGesture=function(){this.playbackMonitor.play(),this.playbackMonitor.pause()},t.changeSrc=function(e){(0,ue.GX)(this.video,e)},t.changeSrcObj=function(e){},t.delete=function(){var e;this.playbackMonitor.delete(),null==(e=this.controlsObserver)||e.disconnect(),this.destroyMSESink(),(0,ue.v8)(this.video)},t.invokeSync=function(e){this[e.name].call(this,e.arg)},t.invokeAsync=function(e){var t,n=this;null==(t=this.awaitSink)||t.then((function(){return n.invokeSync(e)})).catch((function(){}))},t.onMediaSourceEnded=function(){this.video.load(),this.listener.onSinkReset()},t.destroyMSESink=function(){var e=this,t=function(){e.mseSink&&e.mseSink.destroy(),e.awaitSink=void 0,e.mseSink=void 0};this.mseSink?t():this.awaitSink&&this.awaitSink.then((function(){return t()})),this.playbackMonitor&&this.playbackMonitor.clearSourceBuffers()},t.isContentProtectionChanging=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isDrmProtected())&&t)!==e.isProtected},t.isChangingToFromAudioOnly=function(e){var t,n;return(null!=(t=null==(n=this.mseSink)?void 0:n.isAudioOnly())&&t)!==("audio_only"===e.group)},t.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new fe((function(r){t&&!e.video.paused?n.onSinkIdle=function(){n.onSinkIdle=void 0,r()}:r()}))},t.handleCreateSuccess=function(e){this.mseSink=e,this.awaitSink=void 0,this.onSourceDurationChanged(pe.Sf),this.mseSink.setLiveSeekableRange(0,pe.Sf)},t.handleCreateError=function(e){this.listener.onSinkError({value:b.Pt,code:b.Pt,message:e.toString()})},t.onMediaSourceError=function(e,t,n,r){var i={value:e,code:t,message:n};r?this.listener.onSinkError(i):this.listener.onSinkRecoverableError(i)},t.onVideoError=function(){this.destroyMSESink()},t.observeControlsChange=function(){var e=this,t=this.video;try{(this.controlsObserver=new MutationObserver((function(){e.invoke({name:"onSourceDurationChanged",arg:t.duration})}))).observe(t,{attributeFilter:["controls"]})}catch(e){}},t.onSegmentDiscontinuity=function(){},e}(),Ee={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},Se=require("events"),be=function(){function e(){this.emitter=void 0,this.emitter=new Se.EventEmitter}var t=e.prototype;return t.on=function(e,t){this.emitter.on(String(e),t)},t.removeListener=function(e,t){this.emitter.removeListener(String(e),t)},t.emit=function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.emitter).emit.apply(t,[String(e)].concat(r))},t.removeAllListeners=function(){this.emitter.removeAllListeners()},e}(),Te=function(e){return e.Pending="pending",e.Ready="ready",e.Configuring="configuring",e.Active="active",e.Error="error",e}({}),_e=function(e){return e.Heartbeat="heartbeat",e.Configure="configure",e.Set_Log_Config="setLogConfig",e.Debug="debug",e.Destroy="destroy",e}({}),Ce=function(e){return e.State_Changed="stateChanged",e.Manifest_Load_Analytics="manifestLoadAnalytics",e.Available_Segments="availableSegments",e}({});function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ke={enabled:!1,levels:{debug:!0,log:!0,info:!0,warn:!0,error:!0}},Ie=new be,Pe=function(e){var t=e.name,n=function(e){if(ke.enabled&&ke.levels[e]){for(var n=(new Date).toTimeString().split(" ")[0],r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];console[e].apply(console,[n+" - ("+t+")"].concat(i))}};return{debug:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["debug"].concat(t))},log:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["log"].concat(t))},info:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["info"].concat(t))},warn:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["warn"].concat(t))},error:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.apply(void 0,["error"].concat(t))}}},Ae=Pe({name:"sw-host-config"});function De(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Le(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Me,Re=Pe({name:"sw-host"}),xe=function(){return Me},Oe=function(e){return e[e.Pending=0]="Pending",e[e.Installing=1]="Installing",e[e.Ready=2]="Ready",e[e.Error=3]="Error",e}(Oe||{}),Ne=function(e){var t,n=function(){return{isMSESupported:(0,S.aP)()}};if(((t=e)?t.url||(Ae.error("Service worker config must specify a url"),0):(Ae.error("Service worker config is required"),0))&&function(e,t){return!(!t.forceActivate&&e.isMSESupported)}(n(),e)){var r,i,a=new be,s=!0,u=Oe.Pending,c=[],d=[],l=[],h=Te.Pending,v=!1,m=function(){var t=f()(p().mark((function t(){var n,r;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,E(Oe.Installing),navigator.serviceWorker.addEventListener("message",T),t.prev=3,t.next=6,g(e.url);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),Re.error("[registerAndActivate] Failed to unregister service worker instances: "+t.t0);case 11:return n=void 0!==e.scope?{scope:e.scope}:void 0,t.next=14,navigator.serviceWorker.register(e.url,n);case 14:return(r=t.sent).installing?Re.log("Service worker installing"):r.waiting?Re.log("Service worker installed"):r.active&&Re.log("Service worker active"),t.next=18,y(r);case 18:E(Oe.Ready),t.next=25;break;case 21:t.prev=21,t.t1=t.catch(0),Re.error("Registration failed with "+t.t1),E(Oe.Error);case 25:case"end":return t.stop()}}),t,null,[[0,21],[3,8]])})));return function(){return t.apply(this,arguments)}}(),g=function(){var e=f()(p().mark((function e(t){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new RegExp(t),e.next=3,navigator.serviceWorker.getRegistrations().then(function(){var e=f()(p().mark((function e(t){var r,i,o;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Re.debug("[unregisterOtherWorkerInstances] registrations",t),r=De(t);case 2:if((i=r()).done){e.next=16;break}if(null===(o=i.value).active||!n.test(o.active.scriptURL)){e.next=14;break}return Re.debug("[unregisterOtherWorkerInstances] unregistering:",o),e.prev=6,e.next=9,o.unregister();case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),Re.error("[unregisterOtherWorkerInstances] Failed to unregister service worker: "+e.t0);case 14:e.next=2;break;case 16:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(t){return e.apply(this,arguments)}}());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){null!==t.installing||null!==t.waiting?(t.installing||t.waiting).addEventListener("statechange",(function(t){var r=t.target;Re.debug("sw registration, statechange",r.state),"activated"===r.state?(Re.log("Service worker activated"),e()):"redundant"===r.state&&n()})):e()})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(e){if(Re.log("[changeHostState] host state changed from "+u+" to "+e),(u=e)===Oe.Ready){var t=c.slice();c=[];for(var n,r=De(t);!(n=r()).done;)(0,n.value)();var i=d.slice();d=[];for(var o,a=De(i);!(o=a()).done;){var s=o.value;_(s)}}else if(u===Oe.Error){var f=l.slice();l=[];for(var h,p=De(f);!(h=p()).done;)(0,h.value)()}},b=function(e){u===Oe.Error?e():l.push(e)},T=function(e){var t=e.data;switch(t.type){case Ce.State_Changed:var n=t.state;h===Te.Configuring&&(v=!1),n===Te.Ready&&h!==Te.Pending&&Re.warn("[handleMessage] worker was restarted by the browser"),h=n;break;case Ce.Manifest_Load_Analytics:Re.debug("Manifest_Load_Analytics",t)}a.emit(t.type,t)},_=function(){var e=f()(p().mark((function e(t){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Re.log("[sendMessage] sending message: ",t),e.abrupt("return",null==(n=navigator.serviceWorker.controller)?void 0:n.postMessage(t));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h!==Te.Pending){e.next=4;break}return Re.log("[sendMessageWhenReady] worker is not ready, queueing message",t),d.push(t),e.abrupt("return");case 4:_(t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),w=function(){i&&clearTimeout(i),i=setTimeout((function(){k()}),1e4)},k=function(){s&&h!==Te.Pending&&(_({type:_e.Heartbeat}),w())},I=function(e,t){a.on(Ce.State_Changed,(function n(r){r.type===Ce.State_Changed&&r.state===e&&(a.removeListener(Ce.State_Changed,n),t(r))}))},P=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u!==Oe.Ready){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e,t){var n;n=function(){Re.log("[ensureHostReady] host state changed to ready"),e()},u===Oe.Ready?n():c.push(n),b((function(){Re.log("[ensureHostReady] host state changed to error"),t()}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h===Te.Pending){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e,t){I(Te.Ready,(function(t){Re.log("[ensureWorkerReady] worker state changed to ready",t),e()}))})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:return e.next=4,A();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v=!0,r=M(null!=t?t:{}),e.next=4,D();case 4:_({type:_e.Configure,config:r});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(e){return o()({},r,e)},R=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v||h!==Te.Active){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,D();case 4:return e.abrupt("return",new Promise((function(e,t){I(Te.Active,(function(t){Re.log("[ensureConfigured] worker state changed to active",t),e()}))})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),x=function(e){C({type:_e.Set_Log_Config,config:e})};return function(){var t,i,a,s,u,c,d,l,f,h,p,v,m,g,y,E,S,b,T,C,k=n().isMSESupported?{cacheMultivariant:!1,transformTargetDuration:!1,lowLatencyMode:{enabled:!1,useLocalSegment:!1,convertPrefetchSegment:!1,preloadPrefetchSegments:!1},driftDetection:{enabled:!1,maxPlaylistPosition:0,triggerDetectionThreshold:0,minDurationBetweenCorrections:0},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}}:{cacheMultivariant:!0,transformTargetDuration:!1,lowLatencyMode:{enabled:!0,useLocalSegment:!0,convertPrefetchSegment:!0,preloadPrefetchSegments:!1},driftDetection:{enabled:!0,maxPlaylistPosition:3,triggerDetectionThreshold:10,minDurationBetweenCorrections:60},debug:{addMultivariantDelay:void 0,addFirstVariantDelay:void 0}};r={cacheMultivariant:null!=(t=e.cacheMultivariant)?t:k.cacheMultivariant,transformTargetDuration:null!=(i=e.transformTargetDuration)?i:k.transformTargetDuration,lowLatencyMode:{enabled:null!=(a=null==(s=e.lowLatencyMode)?void 0:s.enabled)?a:k.lowLatencyMode.enabled,useLocalSegment:null!=(u=null==(c=e.lowLatencyMode)?void 0:c.useLocalSegment)?u:k.lowLatencyMode.useLocalSegment,convertPrefetchSegment:null!=(d=null==(l=e.lowLatencyMode)?void 0:l.convertPrefetchSegment)?d:k.lowLatencyMode.convertPrefetchSegment,preloadPrefetchSegments:null!=(f=null==(h=e.lowLatencyMode)?void 0:h.preloadPrefetchSegments)?f:k.lowLatencyMode.preloadPrefetchSegments},driftDetection:{enabled:null!=(p=null==(v=e.driftDetection)?void 0:v.enabled)?p:k.driftDetection.enabled,maxPlaylistPosition:null!=(m=null==(g=e.driftDetection)?void 0:g.maxPlaylistPosition)?m:k.driftDetection.maxPlaylistPosition,triggerDetectionThreshold:null!=(y=null==(E=e.driftDetection)?void 0:E.triggerDetectionThreshold)?y:k.driftDetection.triggerDetectionThreshold,minDurationBetweenCorrections:null!=(S=null==(b=e.driftDetection)?void 0:b.minDurationBetweenCorrections)?S:k.driftDetection.minDurationBetweenCorrections},debug:{addMultivariantDelay:null==(T=e.debug)?void 0:T.addMultivariantDelay,addFirstVariantDelay:null==(C=e.debug)?void 0:C.addFirstVariantDelay}},Re.info("[init] instantiating with config",r),void 0!==e.debug&&(e.debug.api={delayNextMediaManifest:function(e){!function(e){if("delayNextMediaManifest"===e.api){var t=e.delayInMs;Re.log("[handleDebugApiMessage] delaying next manifest by "+t+"ms")}_(o()({type:_e.Debug},e))}({api:"delayNextMediaManifest",delayInMs:e})}}),Ie.on("logConfigUpdated",x),w()}(),{registerAndActivate:m,addListener:function(e,t){a.on(e,t)},removeListener:function(e,t){a.removeListener(e,t)},sendMessage:_,ensureReady:D,configure:L,ensureConfigured:R,getConfig:function(){return r},getDriftDetectionConfig:function(){var e;return null==(e=r)?void 0:e.driftDetection},setLogConfig:x,destroy:function(){Re.log("[destroy] destroying"),s=!1,i&&clearTimeout(i),a.removeAllListeners(),Ie.removeListener("logConfigUpdated",x),navigator.serviceWorker.removeEventListener("message",T),_({type:_e.Destroy})},debugPassthroughAnalytics:function(t){var n;null==(n=e.debug)||null==n.onPassthroughAnalytics||n.onPassthroughAnalytics(t)}}}},Ue=n(796),Fe=n(898),Ve=n.n(Fe),Be=function(){function e(){this.serverOffsetVal=e.SERVER_OFFSET_DEFAULT,this.liveLatencyVal=0,this.lastTranscodeReceive=-1}var t=e.prototype;return t.tryGenerateServerOffset=function(t){return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT?(console.warn("[generateServerOffset] the server offset has already been generated, skipping"),!1):(this.serverOffsetVal=function(e,t){return new Date(1e3*t).getTime()-e}(Date.now(),t),!0)},t.tryUpdateLatency=function(t){return this.serverOffsetVal!==e.SERVER_OFFSET_DEFAULT&&(t<this.lastTranscodeReceive?(console.warn("[updateLatency] received latency values too old, ignoring. previous: "+this.lastTranscodeReceive+" current: "+t),!1):(this.liveLatencyVal=function(e,t,n){return(e+t-n)/1e3}(Date.now(),this.serverOffsetVal,t),this.lastTranscodeReceive=t,!0))},Ve()(e,[{key:"serverOffset",get:function(){return this.serverOffsetVal}},{key:"liveLatency",get:function(){return this.liveLatencyVal}}])}();Be.SERVER_OFFSET_DEFAULT=-1;var Ge=function(e){var t=parseFloat(e);if(!isNaN(t))return t},He=function(e){return e.Live_Latency_Load="liveLatencyLoad",e.Live_Latency_Stats="liveLatencyStats",e}({}),We=function(e){return e.Trigger_Drift_Correction="triggerDriftCorrection",e}({}),Ke=function(e){return e.ID3="org.id3",e.APPLE_HLS="com.apple.quicktime.HLS",e}(Ke||{}),je=function(e){return e.PRIV="PRIV",e.TXXX="TXXX",e.TDEN="TDEN",e.STREAM_LEVEL_SERVER_TIME="X-SERVER-TIME",e}(je||{}),ze=Pe({name:"sink"}),qe=function(e){function t(t,n){var r;(r=e.call(this,n,t)||this).intervalId=void 0,r.bufferingTimeoutId=void 0,r.attemptingToPlay=void 0,r.hasPlayedSrc=void 0,r.hasReloadedOnDecodeError=void 0,r.unsubscribersForTrackEvents=void 0,r.latencyStatistics=void 0,r.processedInitialCues=void 0,r.serviceWorker=void 0,r.serviceWorkerHandler=void 0,r.positionTracker=void 0,r.driftDetector=void 0,r.driftDetectorHandler=void 0,r.analytics=void 0,r.analyticsHandler=void 0,r.intervalId=-1,r.bufferingTimeoutId=-1,r.attemptingToPlay=!1,r.hasPlayedSrc=!1,r.hasReloadedOnDecodeError=!1,r.unsubscribersForTrackEvents=[],r.latencyStatistics=new Be,r.processedInitialCues=!1,r.addListener("waiting",(function(){return r.onVideoWaiting()}),r.video),r.addListener("timeupdate",(function(){return r.onVideoTimeUpdate()}),r.video),r.addListener("durationchange",(function(){return r.onVideoDurationChange()}),r.video),r.addListener("error",(function(){return r.onVideoError()}),r.video),r.addListener("play",(function(){return r.onVideoPlay()}),r.video),r.addListener("pause",(function(){return r.onVideoPause()}),r.video),r.addListener("ended",(function(){return r.onVideoEnded()}),r.video),r.addListener("playing",(function(){return r.onVideoPlaying()}),r.video);var i,a,s,u,c,d,l,f,h,p,v,m,g,y,E=(0,Ue.sQ)(document).visibilityChange;if(r.addListener(E,(function(){return r.onVisibilityChange()}),document),r.serviceWorker=xe(),r.serviceWorkerHandler=function(e){return r.onServiceWorkerMessage(e)},r.addServiceWorkerListeners(),void 0!==r.serviceWorker){var S;r.positionTracker=(v=[],m=-1,g=function(){return 0===v.length||void 0===p?(m=-1,!1):-1!==(m=y(p))},y=function(e){var t=new RegExp("^"+e);if(v){var n=v.findIndex((function(e){return t.test(e.pdt)}));if(-1===n)for(var r=new Date(e+"Z"),i=0;i<v.length;i++){var o=v[i],a=new Date(o.pdt);if(a.getTime()<=r.getTime()&&a.getTime()+1e3*o.duration>r.getTime()){n=i;break}}if(-1!==n)return n}return console.warn("Couldn't find segment for PDT "+e),-1},{processAvailableSegments:function(e){return v=e,g()},processTDEN:function(e){return p=e,g()},getCurrentPosition:function(){return m}});var b=null==(S=r.serviceWorker)?void 0:S.getDriftDetectionConfig();void 0!==b&&b.enabled&&(r.driftDetector=(i={maxPlaylistPosition:b.maxPlaylistPosition,triggerDetectionThreshold:b.triggerDetectionThreshold,minDurationBetweenCorrections:b.minDurationBetweenCorrections},c=new be,d=0,l=0,f=function(){if(void 0!==a&&void 0!==s)if(a<=i.maxPlaylistPosition)l=0;else if((l+=1)>i.triggerDetectionThreshold){console.debug("[handleDriftDetection] above detection threshold");var e=Date.now();(void 0===u||e-u>i.minDurationBetweenCorrections)&&(console.debug("[handleDriftDetection] within min duration, triggering rebuffer-to-live"),h(e,a,s))}},h=function(e,t,n){d+=1,u=e,l=0;var r={type:We.Trigger_Drift_Correction,playlistPosition:t,playhead:n,rebufferCount:d};c.emit(We.Trigger_Drift_Correction,r)},{addListener:function(e,t){c.on(e,t)},removeListener:function(e,t){c.removeListener(e,t)},processPlaylistPosition:function(e){a=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==s&&t===s||(s=t,f())}}),r.driftDetectorHandler=function(e){return r.onDriftDetectorEvent(e)},r.addDriftDetectorListeners()),r.analytics=function(){var e,t,n,r,i=new be,a={},s={duration:0},u={min:0,avg:0,max:0,last:0},c={first:void 0,last:void 0},d={count:0},l=function(){if((n=He.Live_Latency_Load)===He.Live_Latency_Load&&void 0===a[n]&&void 0!==e&&void 0!==t){var n,r=a[He.Live_Latency_Load]||0;a[He.Live_Latency_Load]=r+1,i.emit(He.Live_Latency_Load,{type:He.Live_Latency_Load,serverOffset:e,manifestLoadAnalytics:t})}},f=function(){var e=a[He.Live_Latency_Stats]||0;a[He.Live_Latency_Stats]=e+1,i.emit(He.Live_Latency_Stats,{type:He.Live_Latency_Stats,playlistPosition:o()({},u),liveLatencyTiming:o()({},c),driftCorrection:o()({},d)})};return{addListener:function(e,t){i.on(e,t)},removeListener:function(e,t){i.removeListener(e,t)},processServerOffset:function(t){e={serverTime:1e3*t.serverTime,clientTime:t.clientTime,serverOffset:t.serverOffset},l()},processManifestLoadAnalytics:function(e){t=e,l()},processSinkState:function(e){"playing"===n&&"pause"===e&&f(),n=e},processTimeUpdate:function(e){var t=Math.floor(e);void 0!==r&&t===r||(s.duration+=1,r=t,s.duration%10==0&&f())},processPlaylistPosition:function(e){e<u.min&&(u.min=e),e>u.max&&(u.max=e),0===u.avg?u.avg=e:u.avg=(u.avg*s.duration+e)/(s.duration+1),u.last=e},processLiveLatencyUpdate:function(e){void 0===c.first&&(c.first=o()({},e)),c.last=o()({},e)},processDriftCorrectionStart:function(){d.count+=1}}}(),r.analyticsHandler=function(e){return r.onAnalyticsEvent(e)},r.addAnalyticsListeners()}return r}re()(t,e);var n=t.prototype;return n.invoke=function(e){this[e.name].call(this,e.arg)},n.configure=function(e){var t=e.path;this.handleTrackEvents(),this.hasReloadedOnDecodeError=!1,this.hasPlayedSrc=!1,this.video.src=t},n.play=function(){var e=this,t=this.video.buffered;if(t.length>0){var n=t.start(t.length-1),r=t.end(t.length-1);this.video.duration===1/0&&(r<this.video.currentTime||this.video.currentTime<n)&&(this.listener.onSinkGapJump(n-this.video.currentTime),console.warn("Moving to buffered region"),this.video.currentTime=n)}this.paused=!1,this.attemptingToPlay=!0,(void 0===e.serviceWorker||e.hasPlayedSrc?Promise.resolve(e.video.play()):e.serviceWorker.ensureConfigured().catch((function(e){ze.warn("sw, ensureConfigured failed",e)})).then((function(){return Promise.resolve(e.video.play())}))).then((function(){e.attemptingToPlay=!1,e.hasPlayedSrc=!0})).catch((function(){e.attemptingToPlay=!1,e.checkStopped(!0)}))},n.pause=function(){e.prototype.pause.call(this),clearTimeout(this.intervalId)},n.seekTo=function(e){this.video.currentTime=e},n.setVolume=function(e){this.video.volume=e},n.getVolume=function(){return this.video.volume},n.buffered=function(){return(0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de)},n.decodedFrames=function(){return(0,ue.xB)(this.video)},n.droppedFrames=function(){return(0,ue.ld)(this.video)},n.delete=function(){e.prototype.delete.call(this),this.removeTrackListeners(),this.removeServiceWorkerListeners(),this.removeDriftDetectorListeners(),this.removeAnalyticsListeners(),this.video.src="",this.video.load()},n.isMuted=function(){return this.video.muted},n.setMuted=function(e){this.video.muted=e},n.getPlaybackRate=function(){return this.video.playbackRate},n.getCurrentTime=function(){return this.video.currentTime},n.bufferDuration=function(){var e=this.buffered(),t=e.start;return e.end-Math.max(t,this.video.currentTime)},n.captureGesture=function(){Promise.resolve(this.video.play()).catch((function(){})),this.video.pause()},n.addServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.addListener(Ce.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.addListener(Ce.Available_Segments,this.serviceWorkerHandler))},n.onServiceWorkerMessage=function(e){switch(e.type){case Ce.Manifest_Load_Analytics:var t;null==(t=this.analytics)||t.processManifestLoadAnalytics(e.data);break;case Ce.Available_Segments:var n;null==(n=this.positionTracker)||n.processAvailableSegments(e.segments)}},n.removeServiceWorkerListeners=function(){void 0!==this.serviceWorker&&(this.serviceWorker.removeListener(Ce.Manifest_Load_Analytics,this.serviceWorkerHandler),this.serviceWorker.removeListener(Ce.Available_Segments,this.serviceWorkerHandler))},n.addDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.addListener(We.Trigger_Drift_Correction,this.driftDetectorHandler)},n.onDriftDetectorEvent=function(e){var t;e.type===We.Trigger_Drift_Correction&&(ze.debug("triggering drift correction",e),null==(t=this.analytics)||t.processDriftCorrectionStart(),this.resumeAtLive())},n.resumeAtLive=function(){this.pause(),this.configure({path:this.video.src}),this.play()},n.removeDriftDetectorListeners=function(){var e;null==(e=this.driftDetector)||e.removeListener(We.Trigger_Drift_Correction,this.driftDetectorHandler)},n.addAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.addListener(He.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.addListener(He.Live_Latency_Stats,this.analyticsHandler)},n.onAnalyticsEvent=function(e){var t;switch(null==(t=this.serviceWorker)||t.debugPassthroughAnalytics(e),e.type){case He.Live_Latency_Load:ze.debug("analytics event, Live Latency Load",e.serverOffset,e.manifestLoadAnalytics);break;case He.Live_Latency_Stats:ze.debug("analytics event, Live Latency Stats",e.playlistPosition,e.liveLatencyTiming,e.driftCorrection)}},n.removeAnalyticsListeners=function(){var e,t;null==(e=this.analytics)||e.removeListener(He.Live_Latency_Load,this.analyticsHandler),null==(t=this.analytics)||t.removeListener(He.Live_Latency_Stats,this.analyticsHandler)},n.addTrackListener=function(e,t,n){this.unsubscribersForTrackEvents.push((0,ue.B1)(n,e,t))},n.removeTrackListeners=function(){this.unsubscribersForTrackEvents.forEach((function(e){return e()}))},n.checkTracksStatus=function(){for(var e=this.video.textTracks,t=0;t<e.length;t++){var n=e[t];"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden")}},n.handleTDENDataReceived=function(e){if(void 0!==this.positionTracker&&this.positionTracker.processTDEN(e)){var t,n,r=this.positionTracker.getCurrentPosition();null==(t=this.analytics)||t.processPlaylistPosition(r),null==(n=this.driftDetector)||n.processPlaylistPosition(r)}},n.handleTXXXSegmentDataReceived=function(e){var t,n=function(e){var t=(0,Ue.N8)(e);if("transc_r"in t)return{transc_r:parseInt(t.transc_r)}}(e);void 0!==n&&(n.transc_r>0&&this.listener.onPassthroughSinkPropertyChanged("transcodeReceiveInSecs",n.transc_r/1e3),this.latencyStatistics.tryUpdateLatency(n.transc_r)&&(this.listener.onPassthroughSinkPropertyChanged("liveLatency",this.latencyStatistics.liveLatency),null==(t=this.analytics)||t.processLiveLatencyUpdate({transc_r:n.transc_r,latency:this.latencyStatistics.liveLatency})))},n.handleInitialCues=function(e){for(var t,n,r=0;r<e.length;++r){var i=e[r];i.type===Ke.APPLE_HLS&&i.value.key===je.STREAM_LEVEL_SERVER_TIME&&(t=Ge(i.value.data))}this.processedInitialCues=!0,void 0!==t&&this.latencyStatistics.tryGenerateServerOffset(t)&&(null==(n=this.analytics)||n.processServerOffset({serverTime:t,clientTime:Date.now(),serverOffset:this.latencyStatistics.serverOffset}))},n.shouldPropagateCue=function(e){var t=e.type,n=e.value;return!(t!==Ke.ID3||!n||!(n.key===je.TXXX&&"segmentmetadata"!==n.info||n.key===je.PRIV&&n.info===q._.METADATA_ID||n.key===je.PRIV&&n.info===q._.INBAND_METADATA_ID))},n.handleCueChange=function(e){var t=this,n=new Set;this.addTrackListener("cuechange",(function(){var r;!t.processedInitialCues&&e.cues&&t.handleInitialCues(e.cues);var i=null!=(r=e.activeCues)?r:[];if(i.length>0){for(var o=new Set,a=0;a<i.length;++a){var s=i[a];if(!n.has(s)){var u=s.value;if(t.listener.onPassthroughSinkDataCue(s),u.key===je.TXXX&&"segmentmetadata"===u.info&&t.handleTXXXSegmentDataReceived(u.data),u.key===je.TDEN&&t.handleTDENDataReceived(u.data),t.shouldPropagateCue(s)){var c=u.key===je.PRIV?new TextDecoder("utf-8").decode(u.data):u.data||"",d=u.info||"";t.listener.onPassthroughSinkMetadata(s.startTime,s.endTime,c,d,d)}}o.add(s)}n=o}}),e)},n.handleTrackEvents=function(){var e=this;this.removeTrackListeners(),void 0===window.DataCue&&void 0===window.WebKitDataCue||(this.addTrackListener("change",(function(){e.checkTracksStatus()}),this.video.textTracks),this.addTrackListener("addtrack",(function(t){var n=t.track;"metadata"===n.kind&&"disabled"===n.mode&&(n.mode="hidden",e.handleCueChange(n))}),this.video.textTracks))},n.onVideoWaiting=function(){var e=this;if((0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de).end-this.video.currentTime<pe.de){this.listener.onSinkIdle(),clearTimeout(this.bufferingTimeoutId),this.bufferingTimeoutId=self.setTimeout((function(){e.listener.onSinkError({value:b.yY,code:b.yY,message:"Buffering timeout"})}),pe.Pp);var t=(0,ue.B1)(this.video,"timeupdate",(function(){t(),clearTimeout(e.bufferingTimeoutId)}))}var n=(0,ue.B1)(this.video,"timeupdate",(function(){4===e.video.readyState&&(n(),e.onVideoPlaying())}))},n.onVideoTimeUpdate=function(){var e,t;this.listener.onSinkTimeUpdate(),null==(e=this.analytics)||e.processTimeUpdate(this.getCurrentTime()),null==(t=this.driftDetector)||t.processTimeUpdate(this.getCurrentTime())},n.onVideoDurationChange=function(){this.listener.onSinkDurationChanged(this.video.duration)},n.onVideoError=function(){var e=this.video.error,t=e.code,n=e.message,r=void 0===n?"":n,i=-1!==this.video.src.indexOf(".m3u8");if(t===b.Pt&&!this.hasPlayedSrc&&i)return clearTimeout(this.bufferingTimeoutId),void this.listener.onSinkError({value:b.$_,code:b.$_,message:r});t!==b.ok||this.hasReloadedOnDecodeError?this.listener.onSinkError({value:t,code:t,message:r}):this.hasReloadedOnDecodeError||(this.hasReloadedOnDecodeError=!0,console.warn("Reload video element on MEDIA_ERR_DECODE 3"),this.video.load())},n.onVideoPlay=function(){var e=this,t=this.video.currentTime;clearTimeout(this.intervalId),this.intervalId=self.setTimeout((function(){return e.heartbeat(t)}),pe.HJ)},n.onVideoPause=function(){var e;clearTimeout(this.intervalId),this.attemptingToPlay||(null==(e=this.analytics)||e.processSinkState("pause"),this.checkStopped(!1))},n.onVideoEnded=function(){this.listener.onSinkEnded()},n.onVideoPlaying=function(){var e;null==(e=this.analytics)||e.processSinkState("playing"),this.listener.onSinkPlaying(this.paused),this.trackBufferUpdate((0,ue.vG)(this.video.buffered,this.video.currentTime,pe.de).end)},n.onVisibilityChange=function(){var e=(0,Ue.sQ)(document).hidden;document[e]&&(this.hasReloadedOnDecodeError=!1)},n.heartbeat=function(e){var t=this,n=this.video.currentTime;if(n===e){if((0,ue.V3)(this.video,pe.de))return void this.listener.onSinkIdle();var r=(0,ue.tX)(this.video.buffered,n,pe.de);r!==n&&(console.warn("jumping "+(r-n)+"s gap"),this.listener.onSinkGapJump(r-this.video.currentTime),this.video.currentTime=r,n=this.video.currentTime)}this.intervalId=self.setTimeout((function(){return t.heartbeat(n)}),pe.HJ)},n.trackBufferUpdate=function(e){var t=this,n=this.buffered().end;n!==e&&this.listener.onSinkBufferUpdate();var r=(0,ue.B1)(this.video,"timeupdate",(function(){r(),t.trackBufferUpdate(n)}))},t}(he),Qe=function(e){function t(){return e.apply(this,arguments)||this}return re()(t,e),t.prototype.onIdle=function(){this.onSinkIdle?this.onSinkIdle():this.listener.onSinkIdle()},t}(ve),Ye=function(e){function t(t,n,r){var i;return(i=e.call(this,t,n,new Qe(n,t))||this).listener=t,i.video=n,i.adjustments=r,i}re()(t,e);var n=t.prototype;return n.configure=function(e){var t=e.trackID,n=e.codec,r=e.group,i=e.isProtected;if(this.initSink(),this.isContentProtectionChanging(e)&&this.queueNewSink(),this.isNewSinkNeeded(e)){this.queueNewSink();var a=this.getTrack(pe.kD.audio);a&&this.invoke({name:"addTrack",arg:a})}this.invoke({name:"addTrack",arg:o()({},Ze,{trackID:t,codec:n,group:r,isProtected:i})})},n.queueNewSink=function(){var e=this;this.awaitSink=new Promise((function(t,n){e.deferUntilIdle().then((function(){var t=ge.Z.create(e.onMediaSourceEnded.bind(e),e.onMediaSourceError.bind(e));return e.changeSrc(URL.createObjectURL(t.ms)),t.sink})).then((function(n){e.invokeAsync({name:"play",arg:void 0}),e.destroyMSESink(),e.handleCreateSuccess(n),t()})).catch((function(t){e.handleCreateError(t),n()}))}))},n.deferUntilIdle=function(){var e=this,t=this.mseSink,n=this.playbackMonitor;return new Promise((function(r){t&&!e.video.paused?(n.onSinkIdle=function(){},e.video.addEventListener("waiting",(function(){n.onSinkIdle=void 0,r()}),{once:!0})):r()}))},n.onSegmentDiscontinuity=function(){var e=this.adjustments,t=this.awaitSink,n=this.mseSink;e.rebuildMediaSinkOnDiscontinuity&&n&&!t&&this.queueNewSink()},n.isSinkVideoSourceQualityChangeRequired=function(e,t){return!!this.adjustments.rebuildMediaSinkOnSourceQualityChange&&"chunked"===e!=("chunked"===t)},n.isNewSinkNeeded=function(e){var t=this.adjustments,n=this.mseSink,r=this.awaitSink;if(e.trackID!==pe.kD.video)return!1;if(!t.rebuildMediaSinkOnSourceQualityChange)return!1;if(!n||r)return!1;var i=this.getTrack(pe.kD.video),o=this.getTrack(pe.kD.audio);return!(!i||!o)&&this.isSinkVideoSourceQualityChangeRequired(i.group,e.group)},n.getTrack=function(e){var t,n=this.mseSink;return null!=(t=null==n?void 0:n.bufferProperties.find((function(t){return t.trackID===e})))?t:null},t}(ye),Ze={trackID:0,codec:'codecs="magic"',mode:"mse",isProtected:!1,path:"",group:"",srcObj:null},Je=function(){function e(e,t,n,r){this.listener=e,this.adjustments=n,this.video=void 0,this.drmManager=void 0,this.codecs=void 0,this.sink=void 0,this.observer=void 0,this.remoteDevicesListener=void 0,this.video=r,this.listener=e,this.drmManager=new te({video:this.video,listener:e}),this.codecs=Object.create(null),this.sink=new se(this.video),t&&(this.remoteDevicesListener=ae.lookForRemotePlaybackDevices(this.listener)),this.observer=new ce(this.video,e)}var t=e.prototype;return t.videoElement=function(){return this.video},t.delete=function(){var e;this.reset(),null==(e=this.remoteDevicesListener)||e.then((function(e){e&&ae.stopLookingForRemotePlaybackDevices(e)}))},t.configure=function(e){var t=e.mode,n=e.codec,r=e.trackID;this.sink instanceof se&&(this.sink=this.getSink(t)),n?this.codecs[r]=n:e.codec=this.codecs[r],this.sink.configure(e);var i=e.path,o=e.isProtected;i&&o&&this.drmManager.configure(i),this.observer.onConfigure()},t.applyRPC=function(e){this.observer.trackRPC(e),this.sink.invoke(e)},t.getCurrentSink=function(){return this.sink},t.reset=function(){this.sink.delete(),this.drmManager.reset(),this.sink=new se(this.video),this.listener.onSinkTimeUpdate(),this.listener.onSinkBufferUpdate()},t.isProtected=function(){return this.drmManager.isProtected()},t.captureGesture=function(){this.video.played.length||this.sink.captureGesture()},t.destroy=function(){this.observer.unsubscribe(),this.delete()},t.isLowLatencyCapable=function(){return this.sink instanceof ye},t.onSegmentDiscontinuity=function(){this.sink.onSegmentDiscontinuity()},t.getSink=function(e){switch(e){case"chromecast":return new ae(this.listener);case"mse-worker":return new me(this.listener,this.video);case"passthrough":return new qe(this.listener,this.video);case"webview":return new Ye(this.listener,this.video,this.adjustments);default:return new ye(this.listener,this.video)}},e}(),Xe=1111,$e=[{CLASS:"timestamp",attributes:new Set(["X-SERVER-TIME"])},{CLASS:"twitch-session",attributes:new Set(["X-TV-TWITCH-SESSIONID"])},{CLASS:"twitch-stitched-ad",attributes:new Set(["X-TV-TWITCH-AD-URL","X-TV-TWITCH-AD-LINE-ITEM-ID","X-TV-TWITCH-AD-AD-FORMAT","X-TV-TWITCH-AD-DSA-VERSION","X-TV-TWITCH-AD-CLICK-BEACON-ID","X-TV-TWITCH-AD-POD-LENGTH","X-TV-TWITCH-AD-POD-POSITION","X-TV-TWITCH-AD-ROLL-TYPE","X-TV-TWITCH-AD-RADS-TOKEN","X-TV-TWITCH-AD-AD-SESSION-ID","X-TV-TWITCH-AD-ADVERTISER-ID","X-TV-TWITCH-AD-CREATIVE-ID","X-TV-TWITCH-AD-ORDER-ID","X-TV-TWITCH-AD-CLICK-TRACKING-URL","X-TV-TWITCH-AD-DSA-SS-CONTEXT","X-TV-TWITCH-AD-DSA-SS-LOCATION","X-TV-TWITCH-AD-POD-FILLED-DURATION","X-TV-TWITCH-AD-AF-ICR-AD-ID","X-TV-TWITCH-AD-AF-ICR-CREATIVE-ID","X-TV-TWITCH-AD-AF-ICR-MEDIA-DURATION","X-TV-TWITCH-AD-LOUDNESS"])},{CLASS:"twitch-stream-source",attributes:new Set(["X-TV-TWITCH-STREAM-SOURCE"])},{CLASS:"twitch-trigger",attributes:new Set(["X-TV-TWITCH-TRIGGER-URL"])},{CLASS:"twitch-ad-quartile",attributes:new Set(["X-TV-TWITCH-AD-QUARTILE"])}],et=function(e){return e[e.STATE_CHANGED=0]="STATE_CHANGED",e[e.CONFIGURE=1]="CONFIGURE",e[e.RESET=2]="RESET",e[e.ADD_CUE=3]="ADD_CUE",e[e.GET_DECODE_INFO=4]="GET_DECODE_INFO",e[e.MEDIA_SINK_RPC=5]="MEDIA_SINK_RPC",e[e.GET_EXPERIMENTS=6]="GET_EXPERIMENTS",e[e.LOG_MESSAGE=7]="LOG_MESSAGE",e[e.DATA_CHANNEL_CREATE=8]="DATA_CHANNEL_CREATE",e[e.DATA_CHANNEL_CLOSE=9]="DATA_CHANNEL_CLOSE",e[e.DATA_CHANNEL_SEND=10]="DATA_CHANNEL_SEND",e[e.RTC_SET_REMOTE_DESCRIPTION=11]="RTC_SET_REMOTE_DESCRIPTION",e[e.PROPERTY_CHANGED=12]="PROPERTY_CHANGED",e[e.SYNC_TIME_CHANGED=13]="SYNC_TIME_CHANGED",e[e.BUFFERED_RANGES=14]="BUFFERED_RANGES",e[e.DESTROY=15]="DESTROY",e}({}),tt={rebuildMediaSinkOnSourceQualityChange:!1,rebuildMediaSinkOnDiscontinuity:!1,abrTranscodesOnly:!1},nt=require("lodash/mergeWith"),rt=n.n(nt),it=function(e){return e.AVC="avc1",e.HEVC="hvc1",e.AV1="av01",e}({}),ot=n(223),at=function(){function e(e){this.emitAnalytics=void 0,this.emitAnalytics=e}var t=e.prototype;return t.onValue=function(e){this.emit("ivs_devconf_value",e)},t.onError=function(e){this.emit("ivs_devconf_error",e)},t.onTrace=function(e){this.emit("ivs_devconf_trace",e)},t.emit=function(e,t){this.emitAnalytics(e,t)},e}(),st=function(e){return e.HEVC="b8b7cac6-956d-4819-8d35-9ae57aa5f0ce",e.AV1="d16629fa-a0bf-4a2a-b490-c1f92af05009",e.GPU="8b0cb43a-720b-4775-9f98-21da360d60b1",e.GPUStaff="59d57100-3c9c-4f13-aeff-9b1c1b6b4c66",e.DeviceConfigTest="a5c3a8f0-d293-4597-af87-f0352c58d1b3",e.SafariMSEInWorkers="4f4511c5-588d-4a39-8ca1-4b95149a00d2",e.EdgeMSEInWorkers="2caeb3ea-ae9e-4a3c-b675-de3eb85c6ddb",e.OperaMSEInWorkers="c704aec0-73be-4ce5-9872-2ce674c5ccb2",e.PassthroughDaterangeTags="46d7d385-62a6-4aff-bb08-ca35fbadd8e6",e.DroppedFrameFilter="171673d5-bd3f-438c-b9da-70ca99609b25",e}({}),ut=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return rt().apply(void 0,[{},e].concat(n,[function(e,t){Array.isArray(t)&&[].concat(t)}]))},ct=function(){function e(e,t){var n;void 0===e&&(e={}),this.onConfigChanged=t,this.mainConfig=void 0,this.experimentHandler=void 0,this.defaultConfig={media:{abr:{},codecConfigs:[]},logLevel:"",features:{gpu:{flags:{enable_render_surface:!1,add_canvas_to_surface:!1,allow_canvas_visible:!1,init_transformer:!1,run_transformer:!1},render:{},module:{},configured:!1},mseInWorkers:{enable:!0,supportedBrowsers:(n={},n[r.mC.CHROME]=!0,n[r.mC.EDGE]=!1,n[r.mC.FIREFOX]=!1,n[r.mC.SAFARI]=!1,n[r.mC.OPERA]=!1,n)}},experiments:{}},this.deviceConfigManager=void 0,this.deviceConfigAnalyticsHandler=void 0,this.resetMainConfig(),this.setupExperimentHandlers(),this.mainConfig=ut(this.mainConfig,function(e){var t,n=rt()({},e),r=Object.entries(null!=(t=n.experiments)?t:{});n.experiments={};for(var i=0,o=r;i<o.length;i++){var a=o[i],s=(a[0],a[1]);null!=s&&s.id&&(n.experiments[s.id]=s)}return n}(e));for(var i=0,o=Object.values(null!=(a=this.mainConfig.experiments)?a:[]);i<o.length;i++){var a,s=o[i];s&&this.setExperiment(s.id,s.assignment)}}var t=e.prototype;return t.initDeviceConfigManager=function(e){var t;this.shouldEnableDeviceConfigManager()&&(this.deviceConfigManager||(this.deviceConfigManager=ot.DeviceConfigManager.getInstance(window,{fileKey:"player-web-v1",standardEnv:ot.DeviceConfigEnv.PROD,refresh:{canRefreshNow:e.canRefreshNow},emitMetrics:e.emitMetrics,analyticsProperties:{client_sdk:"player-web",env:"prod"},enableConsoleLog:"localhost"==window.location.hostname||(null==(t=window.location.hostname)?void 0:t.startsWith("localhost."))}),this.deviceConfigManager&&(this.deviceConfigAnalyticsHandler=new at(e.emitAnalytics))))},t.shouldEnableDeviceConfigManager=function(){var e;return"treatment"===(null==(e=this.mainConfig.experiments[st.DeviceConfigTest])?void 0:e.assignment)},t.setupExperimentHandlers=function(){var e=this,t=this.handleExperiment((function(){return e.mainConfig.media.codecConfigs}),lt,(function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)})),n=this.handleExperiment((function(){return e.mainConfig.media.codecConfigs}),ft,(function(t){var n=e.mainConfig.media.codecConfigs;e.mainConfig.media.codecConfigs=null==n?void 0:n.concat(t)})),i=this.handleExperiment((function(){return e.mainConfig.features.gpu}),(function(e,t){if(e.configured)return e;var n=dt(t),r=ut(e,n);return r.configured=!0,r}),(function(t){e.mainConfig.features.gpu=t})),a=function(e,t,n){if("treatment"===n){var r=o()({},t);return r.supportedBrowsers[e]=!0,r}return t},s=function(t){return e.handleExperiment((function(){return e.mainConfig.features.mseInWorkers}),a.bind(e,t),(function(t){e.mainConfig.features.mseInWorkers=t}))},u=this.handleExperiment((function(){var t;return null!=(t=e.mainConfig.features.passthroughDaterangeTags)&&t}),(function(e,t){return"treatment"===t}),(function(t){e.mainConfig.features.passthroughDaterangeTags=t})),c=this.handleExperiment((function(){return e.mainConfig.media.abr.droppedFrameFilterThresholdCoefficient}),(function(e,t){var n=t.split("_"),r=n[0],i=n[1];if("treatment"===r){var o=parseInt(i);if(!Number.isNaN(o))return o}}),(function(t){e.mainConfig.media.abr.droppedFrameFilterThresholdCoefficient=t}));this.experimentHandler=new Map([[st.HEVC,t],[st.AV1,n],[st.GPU,i],[st.GPUStaff,i],[st.SafariMSEInWorkers,s(r.mC.SAFARI)],[st.EdgeMSEInWorkers,s(r.mC.EDGE)],[st.OperaMSEInWorkers,s(r.mC.OPERA)],[st.PassthroughDaterangeTags,u],[st.DroppedFrameFilter,c]])},t.getDeviceConfigPropertyHolder=function(){if(this.deviceConfigManager&&this.deviceConfigAnalyticsHandler)return this.deviceConfigManager.getConfigurationHolder({analytics:this.deviceConfigAnalyticsHandler})},t.getConfigSnapshot=function(){return o()({},this.mainConfig)},t.setExperiment=function(e,t){var n;e&&t&&(this.mainConfig.experiments[e]={id:e,assignment:t,version:0},null==(n=this.experimentHandler.get(e))||n(t))},t.delete=function(){this.resetMainConfig()},t.resetMainConfig=function(){this.mainConfig=o()({},this.defaultConfig)},t.handleExperiment=function(e,t,n){var r=this;return function(i){var o=e(),a=t(o,i);a!==o&&(n(a),r.onConfigChanged())}},e}(),dt=function(e){var t={};if(!e)return t;var n=e.split("_config_"),r=(n[0],n[1]);if(!r)return t;try{t=JSON.parse(atob(r))}catch(t){console.warn("[ConfigManager]: Invalid assignment config provided",e,t)}return t};function lt(e,t){switch(t){case"control":case"holdback":return[{codecString:it.HEVC,setting:{disableUse:!0}}];case"forceOn":return[{codecString:it.HEVC,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}function ft(e,t){switch(t){case"control":case"holdback":return[{codecString:it.AV1,setting:{disableUse:!0}}];case"forceOn":return[{codecString:it.AV1,setting:{skipPlatformSupportChecks:!0}}];case"treatment":return[];default:return e}}var ht=require("@babel/runtime/helpers/wrapNativeSuper"),pt=function(e){function t(t,n,r,i){var o;return(o=e.call(this,r)||this).source=t,o.code=n,o.message=r,o.fatal=i,o}return re()(t,e),t}(n.n(ht)()(Error)),vt=function(e){return e[e.WebGPUNotAvailable=-1e3]="WebGPUNotAvailable",e[e.WebGPUAdapterNotAvailable=-1001]="WebGPUAdapterNotAvailable",e[e.WebGPUDeviceNotAvailable=-1002]="WebGPUDeviceNotAvailable",e[e.WebGPUAdapterInfoUndefined=-1003]="WebGPUAdapterInfoUndefined",e[e.ShaderCompilationFailed=-1100]="ShaderCompilationFailed",e[e.PipelineCreationFailed=-1101]="PipelineCreationFailed",e[e.SamplerCreationFailed=-1102]="SamplerCreationFailed",e[e.StreamCreationFailed=-1103]="StreamCreationFailed",e[e.ModelInitFailed=-1104]="ModelInitFailed",e[e.OutOfMemory=-1200]="OutOfMemory",e[e.InvalidBuffer=-1201]="InvalidBuffer",e[e.InvalidBufferSize=-1202]="InvalidBufferSize",e[e.BufferCopyFailed=-1203]="BufferCopyFailed",e[e.DeviceLost=-1300]="DeviceLost",e[e.DeviceLostTooManyRetries=-1301]="DeviceLostTooManyRetries",e[e.CanvasCreationFailed=-1400]="CanvasCreationFailed",e[e.InferenceFailed=-1500]="InferenceFailed",e[e.FetchFailed=-1600]="FetchFailed",e[e.Render=-1700]="Render",e[e.Init=-1800]="Init",e[e.FrameCaptureFailed=-1900]="FrameCaptureFailed",e[e.Performance=-2e3]="Performance",e[e.PerformanceLowRenderFramerate=-2001]="PerformanceLowRenderFramerate",e[e.PerformanceLowCaptureFramerate=-2002]="PerformanceLowCaptureFramerate",e[e.PerformanceTooManyOverbudgetFrames=-2010]="PerformanceTooManyOverbudgetFrames",e[e.PerformanceTooManySkippedFrames=-2011]="PerformanceTooManySkippedFrames",e[e.PerformanceTooManyDroppedSourceFrames=-2012]="PerformanceTooManyDroppedSourceFrames",e[e.PerformanceTooManyMissedFrames=-2013]="PerformanceTooManyMissedFrames",e[e.ResourceClosed=-9998]="ResourceClosed",e[e.BadParameters=-9999]="BadParameters",e}({}),mt=function(){function e(){this.frameStats=void 0,this.resetStats()}var t=e.prototype;return t.init=function(){var e=this;return new WritableStream({write:function(t){t&&Promise.resolve().then((function(){e.onFrameRecord(t)})).catch((function(e){y.error(e)}))}})},t.stats=function(){return o()({},this.frameStats)},t.resetStats=function(){this.frameStats={received:0,overBudget:0,skipped:0,failed:0,transformed:0,rendered:0,transformTime:0,renderTime:0,receiveDelay:0,endToEnd:0}},t.onFrameRecord=function(e){var t={receive:e.timings.received-e.timings.captured,transform:e.timings.transformEnd-e.timings.transformStart,render:e.timings.renderEnd-e.timings.renderStart,endToEnd:e.timings.renderEnd-e.timings.captured};this.frameStats.received++,this.frameStats.receiveDelay+=t.receive,e.skipped&&(this.frameStats.skipped++,y.warn("[FrameRecordSink]: Frame "+e.number+" was skipped. Frame receive delay: "+t.receive+", Initial budget: "+e.budget+"ms, Min budget: "+e.minBudget+"ms",t,e)),e.transformed&&(this.frameStats.transformed++,this.frameStats.transformTime+=t.transform),e.rendered&&(this.frameStats.rendered++,this.frameStats.renderTime+=t.render),e.failed&&(this.frameStats.failed++,y.warn("[FrameRecordSink]: Frame "+e.number+" failed to to transform or render. See error log for details.",t,e)),t.endToEnd>=e.budget&&(this.frameStats.overBudget++,y.warn("[FrameRecordSink]: Frame "+e.number+" was overbudget. End to end time: "+t.endToEnd+"ms Budget: "+e.budget+"ms",t,e)),this.frameStats.endToEnd+=t.endToEnd},e}(),gt=function(){function e(e,t,n,r){this.inputFrameStream=e,this.sink=t,this.onError=n,this.config=r,this.pipeline=void 0,this.transformer=void 0,this.frameRecordSink=void 0,this.frameRecordSink=new mt}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(t){var n,r=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.transformer=t,e.prev=1,n=this.frameRecordSink.init(),this.pipeline=this.createPipeline(),this.pipeline.readable.pipeTo(n).catch((function(e){r.onError(new pt("VideoFramePipeline",vt.PipelineCreationFailed,"Failed to pipe to frameRecordStream: "+(null==e?void 0:e.message),!0))})),this.inputFrameStream.pipeThrough(this.pipeline),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(1),e.abrupt("return",new pt("VideoFramePipeline",vt.PipelineCreationFailed,"Failed to init pipeline: "+(null==e.t0?void 0:e.t0.message),!0));case 11:return e.abrupt("return",void 0);case 12:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),t.stats=function(){return this.frameRecordSink.stats()},t.resetStats=function(){this.frameRecordSink.resetStats()},t.createPipeline=function(){var e,t=this,n=new TransformStream({transform:(e=f()(p().mark((function e(n,r){var i,o,a,s,u,c,d,l,h,v,m;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.frame,o=n.record,a=performance.now(),s=void 0,u=[],c=Math.min(a-o.timings.captured,0),o.timings.received=a,d=1e3/t.config.minimumFramerate-(t.config.includeReceiveDelay?c:0),o.budget=d,o.minBudget=0,l=function(){var e=f()(p().mark((function e(){var n,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render(i,o,s);case 2:n=e.sent,(a=n.renderError)&&u.push(a),i.close(),o.failed=!!u.length,r.enqueue(o),u.forEach((function(e){return t.handleErrorInternal(e)}));case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),!(d<=0)){e.next=16;break}return o.skipped=!0,e.next=15,l();case 15:return e.abrupt("return");case 16:return e.next=18,t.frameToTexture(i,o,d);case 18:return h=e.sent,v=h.transformError,m=h.texture,s=m,v&&u.push(v),e.next=25,l();case 25:case"end":return e.stop()}}),e)}))),function(t,n){return e.apply(this,arguments)})});return n},t.frameToTexture=function(){var e=f()(p().mark((function e(t,n,r){var i,o,a,s,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=performance.now(),o=void 0,n.timings.transformStart=i,e.next=5,this.transformer.transform(t,r);case 5:return a=e.sent,s=a.texture,(u=a.error)?(y.warn("[VideoFramePipeline]: Failed to transform frame "+n.number),o=u):s&&(n.transformed=!0),n.timings.transformEnd=performance.now(),e.abrupt("return",{transformError:o,texture:s});case 11:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.render=function(){var e=f()(p().mark((function e(t,n,r){var i,o,a,s,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=performance.now(),n.timings.renderStart=i,o=void 0,e.prev=3,u=null!=(a=null==r?void 0:r.width)?a:t.displayWidth,c=null!=(s=null==r?void 0:r.height)?s:t.displayHeight,this.sink.setDimensions(u,c),e.next=9,this.sink.render(null!=r?r:t);case 9:(o=e.sent)||(n.rendered=!0),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(3),y.warn("[VideoFramePipeline]: Failed to render frame "+n.number),o=e.t0;case 17:return n.timings.renderEnd=performance.now(),e.abrupt("return",{renderError:o});case 19:case"end":return e.stop()}}),e,this,[[3,13]])})));return function(t,n,r){return e.apply(this,arguments)}}(),t.handleErrorInternal=function(e){y.warn("[VideoFramePipeline]: Error transforming frame",e),this.onError(e)},e}(),yt=function(){function e(e,t){this.config=e,this.onError=t,this.active=!1,this.frameStream=void 0,this.frameWriter=void 0,this.stopCapture=void 0,this.captureStats=void 0,this.resetStats()}var t=e.prototype;return t.init=function(){try{this.frameStream=new TransformStream({},{highWaterMark:this.config.maxQueueSize}),this.frameWriter=this.frameStream.writable.getWriter()}catch(e){return new pt("VideoFrameCaptureStream",vt.StreamCreationFailed,e.message,!0)}},t.start=function(e){this.active?y.warn("[VideoFrameCaptureStream]: Start called, but already capturing"):(this.startRVFC(e),this.active=!0)},t.stop=function(){var e;this.active=!1,null==(e=this.stopCapture)||e.call(this)},t.stats=function(){return this.captureStats},t.resetStats=function(){this.captureStats={captured:0,missed:0,blocked:0,rVFCDelay:0}},t.getStream=function(){return this.frameStream.readable},t.startRVFC=function(e){var t,n=this,r=void 0,i=-1;null==(t=this.stopCapture)||t.call(this),this.stopCapture=function(){return e.cancelVideoFrameCallback(i)};var a=function(){var t=f()(p().mark((function t(s,u){var c,d,l,f;return p().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.active){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,d=performance.now(),n.captureStats.rVFCDelay+=d-s,l=new VideoFrame(e),(f=o()({},{timings:{composited:0,captured:0,received:0,transformStart:0,transformEnd:0,renderStart:0,renderEnd:0},number:0,budget:0,minBudget:0,blocked:!1,skipped:!1,transformed:!1,rendered:!1,overbudget:!1,failed:!1})).number=u.presentedFrames,f.timings.composited=s,f.timings.captured=d,!((null!=(c=n.frameWriter.desiredSize)?c:0)<1)){t.next=17;break}return n.captureStats.blocked++,f.blocked=!0,t.next=15,n.frameWriter.write({frame:l,record:f});case 15:t.next=18;break;case 17:n.frameWriter.write({frame:l,record:f}).catch((function(e){n.onError(new pt("CaptureStream",vt.FrameCaptureFailed,"Failed to write frame to stream: "+((null==e?void 0:e.message)||"unknown error"),!0))}));case 18:void 0===r?r=u.presentedFrames:u.presentedFrames-r>1&&(n.captureStats.missed+=u.presentedFrames-r),r=u.presentedFrames,n.captureStats.captured++,i=e.requestVideoFrameCallback(a),t.next=27;break;case 24:t.prev=24,t.t0=t.catch(2),n.errorHandler(new pt("CaptureStream",vt.FrameCaptureFailed,"Failed to write frame to stream: "+((null==t.t0?void 0:t.t0.message)||"unknown error"),!0));case 27:case"end":return t.stop()}}),t,null,[[2,24]])})));return function(e,n){return t.apply(this,arguments)}}();y.log("[VideoFrameCaptureStream]: Started",e),i=e.requestVideoFrameCallback(a)},t.errorHandler=function(e){this.stop(),this.onError(e)},e}(),Et=function(){function e(e,t){this.windowContext=e,this.config=t,this.adapter=void 0,this.adapterInfo=void 0,this.device=void 0,this.queue=void 0,this.timingInfoEnabled=void 0,this.storageFormat=void 0}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){var t,n,r,i,o,a;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.windowContext.navigator.gpu){e.next=2;break}return e.abrupt("return",new pt("WebGPUContext",vt.WebGPUNotAvailable,"WebGPU not available",!0));case 2:return e.next=4,this.windowContext.navigator.gpu.requestAdapter({});case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",new pt("WebGPUContext",vt.WebGPUAdapterNotAvailable,"WebGPU Adapter not available",!0));case 7:if(t.info){e.next=9;break}return e.abrupt("return",new pt("WebGPUContext",vt.WebGPUAdapterInfoUndefined,"WebGPU adapter.info is undefined",!0));case 9:return n=[].concat(this.config.requiredFeatures),r={},i="bgra8unorm"===this.windowContext.navigator.gpu.getPreferredCanvasFormat()&&t.features.has("bgra8unorm-storage"),o=this.config.timingInfoEnabled&&t.features.has("timestamp-query"),i&&n.push("bgra8unorm-storage"),o&&n.push("timestamp-query"),r.requiredFeatures=n,e.next=18,this.tryGetDevice(t,r);case 18:if(a=e.sent){e.next=21;break}return e.abrupt("return",new pt("WebGPUContext",vt.WebGPUDeviceNotAvailable,"WebGPU Device not available",!0));case 21:this.adapterInfo=t.info,this.timingInfoEnabled=o,this.storageFormat=i?"bgra8unorm":"rgba8unorm",this.adapter=t,this.device=a,this.queue=a.queue,y.info("[WebGPUContext]: WebGPU context initialized",this.properties());case 28:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.properties=function(){var e;if(!this.adapterInfo)return{architecture:"",description:"",device:"",vendor:"",adapterFeatures:"",deviceFeatures:"",wgslFeatures:""};var t="";this.adapter.features.forEach((function(e){t+=e+","}));var n="";this.device.features.forEach((function(e){n+=e+","}));var r="";return null==(e=navigator.gpu.wgslLanguageFeatures)||e.forEach((function(e){r+=e+","})),{architecture:this.adapterInfo.architecture,description:this.adapterInfo.description,device:this.adapterInfo.device,vendor:this.adapterInfo.vendor,adapterFeatures:t,deviceFeatures:n,wgslFeatures:r}},t.createBuffer=function(e,t){return this.device.pushErrorScope("out-of-memory"),this.device.createBuffer({size:e,usage:t})},t.setBufferData=function(){var e=f()(p().mark((function e(t,n,r){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===r&&(r=!0),this.device.queue.writeBuffer(t,0,n),!r){e.next=5;break}return e.next=5,this.device.queue.onSubmittedWorkDone();case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.createShaderModule=function(){var e=f()(p().mark((function e(t){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.device.createShaderModule({code:t}),e.next=3,n.getCompilationInfo();case 3:if(!((r=e.sent).messages.length>0)){e.next=7;break}return y.error("[WebGPUContext]: Error compiling shader",r.messages),e.abrupt("return",{err:new pt("WebGPUContext",vt.ShaderCompilationFailed,"Compilation failed: "+r.messages.join(),!0)});case 7:return e.abrupt("return",{module:n});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.tryGetDevice=function(){var e=f()(p().mark((function e(t,n){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.requestDevice(n);case 3:case 11:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.prev=8,e.next=11,t.requestDevice(null);case 14:return e.prev=14,e.t1=e.catch(8),e.abrupt("return",void 0);case 17:case"end":return e.stop()}}),e,null,[[0,6],[8,14]])})));return function(t,n){return e.apply(this,arguments)}}(),e}(),St=function(){function e(e,t,n){this.canvasEl=e,this.gpuContext=t,this.onError=n,this.canvas=void 0,this.device=void 0,this.canvasContext=void 0,this.pipelines=void 0,this.device=t.device,this.pipelines=new Map}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.setCanvas(this.canvasEl.transferControlToOffscreen());case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",new pt("CanvasSink",vt.CanvasCreationFailed,e.t0.message,!0));case 8:return e.abrupt("return",void 0);case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),t.render=function(){var e=f()(p().mark((function e(t){var n,r,i,o,a,s,u,c,d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvasContext&&this.canvas){e.next=2;break}return e.abrupt("return",new pt("CanvasSink",vt.Render,"Failed to get WebGPU Canvas context",!0));case 2:return n=t instanceof VideoFrame,e.next=5,this.getPipeline(this.canvas.width,this.canvas.height,n);case 5:if(r=e.sent,i=r.pipeline,!(o=r.error)&&i){e.next=10;break}return e.abrupt("return",o);case 10:a=n?this.device.importExternalTexture({source:t}):t.createView(),s=i.getBindGroupLayout(0),u=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.canvasContext.getCurrentTexture().createView()},{binding:1,resource:a}]}),this.device.pushErrorScope("validation"),c=this.device.createCommandEncoder(),(d=c.beginComputePass()).setPipeline(i),d.setBindGroup(0,u),d.dispatchWorkgroups(Math.ceil(this.canvas.width/16),Math.ceil(this.canvas.height/16),1),d.end(),this.device.queue.submit([c.finish()]),this.checkForErrorsAsync();case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.setDimensions=function(e,t){!this.canvas||e===this.canvas.width&&t===this.canvas.height||(this.canvas.width=e,this.canvas.height=t)},t.setCanvas=function(){var e=f()(p().mark((function e(t){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,this.canvasContext=t.getContext("webgpu"),this.canvasContext){e.next=4;break}return e.abrupt("return",new pt("CanvasSink",vt.Render,"Failed to get WebGPU Canvas context",!0));case 4:return n=this.gpuContext.storageFormat,r={device:this.device,format:n,usage:GPUTextureUsage.STORAGE_BINDING,viewFormats:[n],alphaMode:"opaque"},this.device.pushErrorScope("validation"),this.canvasContext.configure(r),e.next=10,this.device.popErrorScope();case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",new pt("CanvasSink",vt.Render,"Failed to configure Canvas context",!0));case 13:return e.abrupt("return",void 0);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.getPipeline=function(){var e=f()(p().mark((function e(t,n,r){var i,o=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r+"_"+t+"_"+n,!this.pipelines.has(i)||!this.pipelines.get(i)){e.next=3;break}return e.abrupt("return",{pipeline:this.pipelines.get(i),error:void 0});case 3:return e.abrupt("return",this.makePipeline(t,n,r).then((function(e){return e.pipeline&&o.pipelines.set(i,e.pipeline),e})));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.makePipeline=function(){var e=f()(p().mark((function e(t,n,r){var i,o,a,s,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.getShader(t,n,r),e.next=3,this.createShaderModule(i);case 3:if(o=e.sent,a=o.module,s=o.error,a&&!s){e.next=8;break}return e.abrupt("return",{error:s});case 8:return this.device.pushErrorScope("validation"),u=this.device.createComputePipeline({layout:"auto",compute:{module:a,entryPoint:"main"},label:"canvas-sink_"+t+"_"+n+"_"+r}),e.next=12,this.device.popErrorScope();case 12:if(!(c=e.sent)){e.next=15;break}return e.abrupt("return",{error:new pt("CanvasSink",vt.PipelineCreationFailed,""+c.message,!0)});case 15:return e.abrupt("return",{pipeline:u});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}(),t.createShaderModule=function(){var e=f()(p().mark((function e(t){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.device.createShaderModule({code:t}),e.next=3,n.getCompilationInfo();case 3:if(!((r=e.sent).messages.length>0)){e.next=7;break}return y.error("[CanvasSink]: Error compiling shader",r.messages),e.abrupt("return",{error:new pt("CanvasSink",vt.ShaderCompilationFailed,"Shader compilation failed: "+r.messages.join(),!0)});case 7:return e.abrupt("return",{module:n});case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.getShader=function(e,t,n){return"\n        @group(0) @binding(0) var outputTexture: texture_storage_2d<"+this.gpuContext.storageFormat+", write>;\n        @group(0) @binding(1) var inputTexture: "+(n?"texture_external":"texture_2d<f32>")+";\n\n        @compute @workgroup_size(16,16,1)\n        fn main(@builtin(global_invocation_id) global_id : vec3<u32>) {\n            if (global_id.x >= "+e+" || global_id.y >= "+t+") {\n                return;\n            }\n            let color = "+(n?"textureLoad(inputTexture, global_id.xy);":"textureLoad(inputTexture, global_id.xy, 0);")+";\n            textureStore(outputTexture, global_id.xy, color);\n        }\n        "},t.checkForErrorsAsync=function(){var e=this;this.device.popErrorScope().then((function(t){t&&(y.warn("[CanvasSink]: WebGPU error encountered",t),e.onErrorInternal(new pt("CanvasSink",vt.Render,"Failed to render: "+t.message,!0)))})).catch((function(t){e.onError(new pt("CanvasSink",vt.BadParameters,"Failed to popErrorScope: "+((null==t?void 0:t.message)||"unknown error"),!0))}))},t.onErrorInternal=function(e){this.onError(e)},e}(),bt=function(){function e(e){this.name=e,this.frameBudgetTimeout=-1}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve(void 0));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),t.transform=function(){var e=f()(p().mark((function e(t,n){var r,i=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.race([this.doTransform(t),this.frameBudgetExceededPassthrough(n)]).catch((function(e){return clearTimeout(i.frameBudgetTimeout),{frame:t,error:e}}));case 2:return r=e.sent,clearTimeout(this.frameBudgetTimeout),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.doTransform=function(){var e=f()(p().mark((function e(t){var n;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transformFn(t);case 2:return n=e.sent,e.abrupt("return",{texture:n});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.frameBudgetExceededPassthrough=function(){var e=f()(p().mark((function e(t){var n=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){return n.frameBudgetTimeout=window.setTimeout((function(){e({})}),t)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.transformFn=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",void 0);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e}(),Tt=function(e){function t(){return e.call(this,"PassthroughTransformer")||this}return re()(t,e),t.prototype.transform=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{});case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t}(bt);function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ct=function(){function e(e,t,n){this.config=e,this.getStats=t,this.listeners=n,this.monitorInterval=-1,this.active=!1,this.validators=[],y.log("[PerformanceMontior]: Config",this.config),this.validators.push(function(e){return{validate:function(t){var n=1-t.source_presented/t.source;if(n>=e.maxDroppedFramesPct)return{code:vt.PerformanceTooManyDroppedSourceFrames,fatal:!0,reason:"Too many dropped source frames. Dropped: "+(100*n).toFixed(0)+"%, Max: "+100*e.maxDroppedFramesPct+"% Presented frames: "+t.source_presented+", Total frames: "+t.source}}}}({maxDroppedFramesPct:e.frameRateDiffPercentage}),function(e){return{validate:function(t){var n=t.captured,r=t.source_presented,i=r-r*e.frameCountDiffPercentage;if(n<i)return{code:vt.PerformanceLowRenderFramerate,fatal:!0,reason:"Capture framerate is too low. Source Presented: "+r+" Min: "+i+" Captured: "+n+" Config: "+100*e.frameCountDiffPercentage+"%"}}}}({frameCountDiffPercentage:this.config.frameCountDiffPercentage,captureRateDiffPercentage:this.config.frameRateDiffPercentage}),function(e){return{validate:function(t){var n=t.source,r=t.rendered,i=t.received;if(t.overBudget>i*e.frameCountDiffPercentage)return{code:vt.PerformanceTooManyOverbudgetFrames,fatal:!0,reason:"Too many overbudget frames. Received: "+i+" Max: "+i*e.frameCountDiffPercentage+" Have: "+t.overBudget+" Config: "+100*e.frameCountDiffPercentage+"%"};if(t.skipped>i*e.frameCountDiffPercentage)return{code:vt.PerformanceTooManySkippedFrames,fatal:!0,reason:"Too many skipped frames. Received: "+i+" Max: "+i*e.frameCountDiffPercentage+" Have: "+t.skipped+" Config: "+100*e.frameCountDiffPercentage+"%"};var o=n-n*e.renderFramerateDiffPercentage;return r<o?{code:vt.PerformanceLowRenderFramerate,fatal:!0,reason:"Render framerate is too low. Source: "+n+" Min: "+o+" Rendered: "+r+" Config: "+100*e.renderFramerateDiffPercentage+"%"}:void 0}}}({frameCountDiffPercentage:this.config.frameCountDiffPercentage,renderFramerateDiffPercentage:this.config.frameRateDiffPercentage}))}var t=e.prototype;return t.start=function(){var e=this;if(this.config.enable)if(this.monitoring())y.log("[PerformanceMonitor]: Resume called on active instance");else{y.log("[PerformanceMonitor]: Monitoring started");var t=this.getStats();window.clearInterval(this.monitorInterval),this.monitorInterval=window.setInterval((function(){var n=e.getStats(),r=e.validatePerformance(t,n);r&&e.listeners.performanceBreach(r),t=n}),this.config.monitorIntervalMs)}},t.stop=function(){window.clearInterval(this.monitorInterval),this.monitorInterval=-1},t.monitoring=function(){return this.monitorInterval>0},t.validatePerformance=function(e,t){var n=this.diffFrameStats(e.frames,t.frames);y.log("[PerformanceMonitor] Stats:",e,t),y.log("[PerformanceMonitor] Stats diff:",n);var r=this.config.monitorIntervalMs/1e3*20;if(n.source<=r)y.log("[PerformanceMonitor]: Not enough source frames to validate. Have: "+n.source+" Need: "+r);else for(var i,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.validators);!(i=o()).done;){var a=i.value.validate(n);if(a)return a}},t.diffFrameStats=function(e,t){for(var n={source:0,source_presented:0,captured:0,missed:0,blocked:0,received:0,skipped:0,transformed:0,rendered:0,failed:0,overBudget:0},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r],a=o[0],s=o[1];n[a]=s-e[a]}return n},e}(),wt=function(e){return e[e.External=0]="External",e[e.Texture=1]="Texture",e[e.Buffer=2]="Buffer",e}({});function kt(e,t,n){return Array.from({length:e},(function(e,t){return t})).map(n).join(t)}var It=function(e){return e[e.Default=0]="Default",e[e.HostToDevice=1]="HostToDevice",e[e.DeviceToHost=4]="DeviceToHost",e[e.TimingQuery=8]="TimingQuery",e}({}),Pt=function(){function e(e,t,n){void 0===n&&(n=It.Default),this.bytesize=t,this.usage=n,this.deviceBuffer=void 0,this.stagingBuffer=void 0,this.closed=!1;var r=GPUBufferUsage.STORAGE;n===It.HostToDevice?r|=GPUBufferUsage.COPY_DST:n===It.DeviceToHost?(r|=GPUBufferUsage.COPY_SRC,this.stagingBuffer=e.createBuffer(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ)):n===It.TimingQuery&&(r|=GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC,this.stagingBuffer=e.createBuffer(t,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ)),this.deviceBuffer=e.createBuffer(t,r)}var t=e.prototype;return t.copyToDevice=function(){var e=f()(p().mark((function e(t,n){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.closed){e.next=2;break}return e.abrupt("return",new pt("Buffer",vt.ResourceClosed,"Buffer has been closed",!0));case 2:return e.prev=2,e.next=5,t.setBufferData(this.deviceBuffer,n,!1);case 5:e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(2),e.abrupt("return",new pt("Buffer",vt.BadParameters,"Failed to copy to host: "+((null==e.t0?void 0:e.t0.message)||"unknown"),!0));case 10:case"end":return e.stop()}}),e,this,[[2,7]])})));return function(t,n){return e.apply(this,arguments)}}(),t.copyToHost=function(){var e=f()(p().mark((function e(t){var n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.closed){e.next=2;break}return e.abrupt("return",{err:new pt("Buffer",vt.ResourceClosed,"Buffer has been closed",!0)});case 2:if(this.stagingBuffer&&this.usage!==It.DeviceToHost){e.next=4;break}return e.abrupt("return",{err:new pt("Buffer",vt.BadParameters,"Buffer usage is "+this.usage+", but should be BufferUsage.DeviceToHost",!0)});case 4:return e.prev=4,(n=t.createCommandEncoder()).copyBufferToBuffer(this.deviceBuffer,0,this.stagingBuffer,0,this.bytesize),t.queue.submit([n.finish()]),e.next=10,t.queue.onSubmittedWorkDone();case 10:return e.next=12,this.stagingBuffer.mapAsync(GPUMapMode.READ);case 12:return r=structuredClone(this.stagingBuffer.getMappedRange()),this.stagingBuffer.unmap(),e.abrupt("return",{buffer:r});case 17:return e.prev=17,e.t0=e.catch(4),e.abrupt("return",{err:new pt("Buffer",vt.BufferCopyFailed,"Failed to copy to host: "+((null==e.t0?void 0:e.t0.message)||"unknown"),!0)});case 20:case"end":return e.stop()}}),e,this,[[4,17]])})));return function(t){return e.apply(this,arguments)}}(),t.close=function(){var e;this.closed=!0,this.deviceBuffer.destroy(),null==(e=this.stagingBuffer)||e.destroy()},e}(),At=function(){function e(e,t,n,r,i){void 0===i&&(i=It.Default),this.usage=i,this.stagingBuffer=void 0,this.deviceTexture=void 0,this.closed=!1;var o=GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING;i===It.HostToDevice?o|=GPUTextureUsage.COPY_DST:i===It.DeviceToHost?(y.warn("[Buffer]: Copying texture to host buffer only supports 32bpp formats."),o|=GPUTextureUsage.COPY_SRC,this.stagingBuffer=e.createBuffer(256*Math.ceil(4*t/256)*n,GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ)):i===It.TimingQuery&&y.warn("[Buffer]: BufferUsage.TimingQuery is not valid for Texture"),this.deviceTexture=e.device.createTexture({size:{width:t,height:n},format:r,usage:o})}var t=e.prototype;return t.copyToHost=function(){var e=f()(p().mark((function e(t){var n,r,i;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.closed){e.next=2;break}return e.abrupt("return",{err:new pt("Texture",vt.ResourceClosed,"Texture has been closed",!0)});case 2:if(this.stagingBuffer&&this.usage!==It.DeviceToHost){e.next=4;break}return e.abrupt("return",{err:new pt("Texture",vt.BadParameters,"Buffer usage is "+this.usage+", but should be BufferUsage.DeviceToHost",!0)});case 4:return y.debug("[Buffer]: copying texture",this.deviceTexture),e.prev=5,(n=t.createCommandEncoder()).copyTextureToBuffer({texture:this.deviceTexture,mipLevel:0,origin:[0,0,0],aspect:"all"},{buffer:this.stagingBuffer,offset:0,bytesPerRow:256*Math.ceil(4*this.deviceTexture.width/256),rowsPerImage:this.deviceTexture.height},[this.deviceTexture.width,this.deviceTexture.height,1]),t.queue.submit([n.finish()]),e.next=11,t.queue.onSubmittedWorkDone();case 11:return e.next=13,this.stagingBuffer.mapAsync(GPUMapMode.READ);case 13:return r=this.stagingBuffer.getMappedRange(),i=structuredClone(r),this.stagingBuffer.unmap(),e.abrupt("return",{buffer:i});case 19:return e.prev=19,e.t0=e.catch(5),e.abrupt("return",{err:new pt("Texture",vt.BufferCopyFailed,"Failed to copy to host: "+((null==e.t0?void 0:e.t0.message)||"unknown"),!0)});case 22:case"end":return e.stop()}}),e,this,[[5,19]])})));return function(t){return e.apply(this,arguments)}}(),t.close=function(){var e;this.closed=!0,this.deviceTexture.destroy(),null==(e=this.stagingBuffer)||e.destroy()},e}(),Dt=function(e){return e.F16="f16",e.F32="f32",e}({}),Lt=function(){function e(e,t,n,r,i,o,a){void 0===i&&(i=1),void 0===o&&(o=!0),void 0===a&&(a=!1),this.inFilters=e,this.outFilters=t,this.kernelSize=n,this.scaleFactor=r,this.outPadding=i,this.convertToYuv=o,this.hostReadableOutput=a,this._configuration=void 0,this._activation=void 0,this._weights=void 0,this._biases=void 0,this._inputs=void 0,this._outputs=void 0,this._pipeline=void 0,this._outputShape=void 0,this._sampler=void 0}var t=e.prototype;return t.configure=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a,s,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.device.pushErrorScope("validation"),this._outputShape=[Math.ceil(n.inputShape[0]*this.scaleFactor),Math.ceil(n.inputShape[1]*this.scaleFactor),this.outFilters],r=(this._outputShape[0]+2*this.outPadding)*(this._outputShape[1]+2*this.outPadding)*this.outFilters,y.debug("[Conv2dEntry_Upscale]: Creating output buffer of size",r),i=n.dataType===Dt.F32?4:2,this._configuration=n,this._activation=n.activation,this._outputs=new Pt(t,r*i,this.hostReadableOutput?It.DeviceToHost:It.Default),o=this._createShader(n.expectedInputType),this._sampler=t.device.createSampler({magFilter:"linear",minFilter:"linear"}),e.next=12,t.createShaderModule(o);case 12:if(a=e.sent,s=a.module,!(u=a.err)&&s){e.next=17;break}return e.abrupt("return",u||new pt("Conv2dEntry_Upscale",vt.PipelineCreationFailed,"Failed to create shader module",!0));case 17:return this._pipeline=t.device.createComputePipeline({layout:"auto",compute:{module:s,entryPoint:"main"},label:"conv2d_entry_upscale"}),e.next=20,t.device.popErrorScope();case 20:if(!(c=e.sent)){e.next=23;break}return e.abrupt("return",new pt("Conv2dEntry_Upscale",vt.PipelineCreationFailed,"Error creating compute pipeline: "+c.message,!0));case 23:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.setWeights=function(e){this._weights=e},t.setBiases=function(e){this._biases=e},t.setInputs=function(e){this._inputs=e},t.setQuantOffsets=function(e){},t.getOutputs=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._outputs);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.close=function(){var e;this._weights.close(),null==(e=this._biases)||e.close(),this._outputs.close()},t.createFinalizedPass=function(e,t,n){try{var r,i={label:"conv2d_entry_upscale"},o=this._pipeline.getBindGroupLayout(0);if(this._inputs instanceof GPUTexture)r=this._inputs.createView();else if(this._inputs instanceof VideoFrame)r=e.device.importExternalTexture({source:this._inputs});else{if(!(this._inputs instanceof GPUExternalTexture))return y.error("Conv2d_entry_upscale invalid input type"),{err:new pt("Conv2d_Entry_Upscale",vt.BadParameters,"Input type is not one of GPUTexture, GPUExternalTexture, VideoFrame",!0)};r=this._inputs}var a=[{binding:0,resource:{buffer:this._outputs.deviceBuffer}},{binding:1,resource:r},{binding:2,resource:this._sampler},{binding:3,resource:{buffer:this._weights.deviceBuffer}}];this._biases&&a.push({binding:4,resource:{buffer:this._biases.deviceBuffer}});var s=e.device.createBindGroup({layout:o,entries:a});n&&(i.timestampWrites={querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1});var u=t.beginComputePass(i);return u.setPipeline(this._pipeline),u.setBindGroup(0,s),u.dispatchWorkgroups(Math.ceil(this._outputShape[1]/12),Math.ceil(this._outputShape[0]/12),1),u.end(),{pass:u}}catch(e){return{err:new pt("Conv2d_Entry_Upscale",vt.InferenceFailed,"Failed to create finalized pass: "+((null==e?void 0:e.message)||"unknown"),!0)}}},t._createShader=function(e){var t=e===wt.External?"texture_external":"texture_2d<fT>",n=this._configuration.dataType,r="sum;";this._activation&&(r=this._activation.getWGSL("x",n)+";");var i=4,o="";return this._biases&&(o="@group(0) @binding("+i+") var<storage, read> biases: array<fT, M * N>;",i++),"\n        "+(this._configuration.dataType===Dt.F16?"enable f16;":"")+"\n        const GROUP_SIDE: u32 = 12;\n        const GROUP_LIMIT: u32 = 14;\n        const GROUP_THREADS: u32 = GROUP_SIDE * GROUP_SIDE;\n        const WARP_SIZE = 32;\n        const IN_FILTERS: u32 = "+this.inFilters+";\n        const OUT_FILTERS: u32 = "+this.outFilters+";\n        const OUT_PADDING: u32 = "+this.outPadding+";\n        const IN_PADDING: u32 = 1;\n\n        const TOTAL_FILTERS = IN_FILTERS * OUT_FILTERS;\n\n        const TILE_OFFSET: u32 = (GROUP_LIMIT - GROUP_SIDE) / 2;\n        const KERNEL_SIZE: u32 = 3;\n        const OUT_WIDTH: u32 = "+this._outputShape[1]+";\n        const OUT_HEIGHT: u32 = "+this._outputShape[0]+";\n        const Y_COEF = vec3<fT>(0.299, 0.587, 0.114);\n\n        alias fT = "+this._configuration.dataType+";\n\n        @group(0) @binding(0) var<storage, read_write> outputBuffer: array<fT, (OUT_HEIGHT + OUT_PADDING * 2) * (OUT_WIDTH + OUT_PADDING * 2) * OUT_FILTERS>;\n        @group(0) @binding(1) var inputTexture: "+t+";\n        @group(0) @binding(2) var inputSampler: sampler;\n        @group(0) @binding(3) var<storage, read> weightsBuffer: array<fT, KERNEL_SIZE * KERNEL_SIZE * TOTAL_FILTERS>;\n\n        "+o+"\n\n        var<workgroup> weights: array<fT, KERNEL_SIZE * KERNEL_SIZE * TOTAL_FILTERS>;\n        var<workgroup> scratch1: array<fT, GROUP_LIMIT*GROUP_LIMIT>; // Handles input to convolution\n\n        fn activate(x: fT) -> fT {\n            return "+r+";\n        }\n\n        @compute @workgroup_size(GROUP_SIDE,GROUP_SIDE,1)\n        fn main(@builtin(global_invocation_id) global_id: vec3<u32>,\n                @builtin(local_invocation_index) tid: u32,\n                @builtin(local_invocation_id) thread_id: vec3<u32>,\n                @builtin(workgroup_id) group_id: vec3<u32>) {\n            let texSize = vec2<f32>(f32(OUT_WIDTH), f32(OUT_HEIGHT));\n            let texelSize = 1.0 / texSize;\n            let cRow = group_id.y * GROUP_SIDE;\n            let cCol = group_id.x * GROUP_SIDE ;\n\n            // 1. load weights\n            for (var i: u32 = 0 ; i < (TOTAL_FILTERS*KERNEL_SIZE*KERNEL_SIZE+GROUP_THREADS-1)/GROUP_THREADS; i++) {\n                let idx: u32 = i * GROUP_THREADS + tid;\n                if (idx < TOTAL_FILTERS*KERNEL_SIZE*KERNEL_SIZE) {\n                    weights[idx] = weightsBuffer[idx];\n                }\n            }\n\n            // 2. load pixels from input texture into shared scratch\n            if (thread_id.x * 2 < GROUP_LIMIT && thread_id.y * 2 < GROUP_LIMIT) {\n                let sRow = i32(cRow) - i32(TILE_OFFSET);\n                let sCol = i32(cCol) - i32(TILE_OFFSET);\n                let lRow = i32(thread_id.y * 2) + sRow;\n                let lCol = i32(thread_id.x * 2) + sCol;\n                var s: array<vec3<fT>, 4>;\n                let curPos = vec2<f32>(f32(lCol), f32(lRow)) * texelSize;\n                let cInc = vec2<f32>(texelSize.x, 0.0);\n                let rInc = vec2<f32>(0.0, texelSize.y);\n\n                // Collect the pixels this thread should collect, storing in registers\n                s[0] = vec3<fT>(textureSampleBaseClampToEdge(inputTexture, inputSampler, curPos).rgb);\n                s[1] = vec3<fT>(textureSampleBaseClampToEdge(inputTexture, inputSampler, curPos+cInc).rgb);\n                s[2] = vec3<fT>(textureSampleBaseClampToEdge(inputTexture, inputSampler, curPos+rInc).rgb);\n                s[3] = vec3<fT>(textureSampleBaseClampToEdge(inputTexture, inputSampler, curPos+texelSize).rgb);\n\n                // Do YUV conversion and store in workgroup memory.\n                // Doing the YUV conversion here instead of when storing to registers seems to be more performant (on M2 macbook anyway)\n                //\n                let row = thread_id.y * 2;\n                let col = thread_id.x * 2;\n\n                // Convert RGB to YUV and compress from full range to video range [16-236]. Not doing this will result in artifacts.\n                scratch1[row * GROUP_LIMIT + col] = dot(s[0] * 0.8627 + 0.0627, Y_COEF);\n                if (col+1 < GROUP_LIMIT) {\n                    scratch1[row * GROUP_LIMIT + col + 1] = dot(s[1] * 0.8627 + 0.0627, Y_COEF);\n                }\n                if (row+1 < GROUP_LIMIT) {\n                    scratch1[(row+1) * GROUP_LIMIT + col] = dot(s[2] * 0.8627 + 0.0627, Y_COEF);\n                    if (col+1 < GROUP_LIMIT) {\n                        scratch1[(row+1) * GROUP_LIMIT + col + 1] = dot(s[3] * 0.8627 + 0.0627, Y_COEF);\n                    }\n                }\n            }\n            workgroupBarrier();\n\n            // Each thread will perform OUT_FILTERS convolutions\n            var centers: array<u32, OUT_FILTERS>;\n            var results: array<fT, OUT_FILTERS>;\n            for (var i: u32 = 0; i < OUT_FILTERS; i++) {\n                let z = thread_id.z + i;\n                // let y = thread_id.y;\n                // let x = thread_id.x;\n                centers[i] = z;//vec3<u32>(x,y,z);\n            }\n            {\n\n                let row = thread_id.y + 1;\n                let col = thread_id.x + 1;\n\n                // Load values. There will probably be bank conflicts here that we can optimize in the future.\n                // TODO: Batch this into array<fT,9*4>;\n                var v: array<fT, 9>;\n                v[0] = scratch1[(row-1) * GROUP_LIMIT + (col-1)];\n                v[3] = scratch1[(row) * GROUP_LIMIT + (col-1)];\n                v[6] = scratch1[(row+1) * GROUP_LIMIT + (col-1)];\n                v[1] = scratch1[(row-1) * GROUP_LIMIT + (col)];\n                v[4] = scratch1[(row) * GROUP_LIMIT + (col)];\n                v[7] = scratch1[(row+1) * GROUP_LIMIT + (col)];\n                v[2] = scratch1[(row-1) * GROUP_LIMIT + (col+1)];\n                v[5] = scratch1[(row) * GROUP_LIMIT + (col+1)];\n                v[8] = scratch1[(row+1) * GROUP_LIMIT + (col+1)];\n                for (var i: u32 = 0; i < OUT_FILTERS; i++) {\n                    // Load weights\n                    var w: array<fT, 9>;\n                    let off = centers[i] * KERNEL_SIZE * KERNEL_SIZE;\n                    for (var j: u32 = 0; j < KERNEL_SIZE * KERNEL_SIZE; j++) {\n                        w[j] = weights[off + j];\n                    }\n\n                    // Do dots\n                    var sum: fT = 0.0;\n                    sum += v[0] * w[0];\n                    sum += v[1] * w[1];\n                    sum += v[2] * w[2];\n                    sum += v[3] * w[3];\n                    sum += v[4] * w[4];\n                    sum += v[5] * w[5];\n                    sum += v[6] * w[6];\n                    sum += v[7] * w[7];\n                    sum += v[8] * w[8];\n                    results[i] = activate(sum);\n                }\n            }\n\n            // write results\n            for (var i: u32 = 0; i < OUT_FILTERS; i++) {\n                let x = thread_id.x + cCol;\n                let y = thread_id.y + cRow;\n                let z = centers[i];\n                // reliniarize\n                let idx = (y+OUT_PADDING) * (OUT_WIDTH + OUT_PADDING * 2) * OUT_FILTERS + x * OUT_FILTERS + z;\n                outputBuffer[idx] = results[i];\n            }\n        }\n        "},e}(),Mt=function(){function e(e,t,n){void 0===n&&(n=!1),this.inFilters=e,this.outFilters=t,this.hostReadableOutput=n,this._configuration=void 0,this._activation=void 0,this._weights=void 0,this._biases=void 0,this._inputs=void 0,this._outputs=void 0,this._pipeline=void 0,this._inputShape=void 0,this._outputShape=void 0}var t=e.prototype;return t.configure=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a,s,u,c,d;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.device.pushErrorScope("validation"),r=Math.floor(1),this._outputShape=[n.inputShape[0]-r+1,n.inputShape[1]-r+1,this.outFilters],this._inputShape=n.inputShape,i=(this._outputShape[0]+2)*(this._outputShape[1]+2)*this.outFilters,y.debug("GPURenderPipeline hidden output shape: "+this._outputShape+", size: "+i+" hostReadable "+this.hostReadableOutput),o=n.dataType===Dt.F32?4:2,this._configuration=n,this._activation=n.activation,this._outputs=new Pt(t,i*o,this.hostReadableOutput?It.DeviceToHost:It.Default),a=this.createShader(),e.next=14,t.createShaderModule(a);case 14:if(s=e.sent,u=s.module,!(c=s.err)&&u){e.next=19;break}return e.abrupt("return",new pt("Conv2d_3x3s1p1",vt.PipelineCreationFailed,"Pipeline creation failed: "+(null==c?void 0:c.message),!0));case 19:return this._pipeline=t.device.createComputePipeline({layout:"auto",compute:{module:u,entryPoint:"main"},label:"conv2d_entry_upscale"}),e.next=22,t.device.popErrorScope();case 22:if(!(d=e.sent)){e.next=25;break}return e.abrupt("return",new pt("Conv2d_3x3s1p1",vt.PipelineCreationFailed,"Pipeline creation failed: "+(null==d?void 0:d.message),!0));case 25:e.next=30;break;case 27:return e.prev=27,e.t0=e.catch(0),e.abrupt("return",new pt("Conv2d_3x3s1p1",vt.PipelineCreationFailed,"Pipeline creation failed: "+(null==e.t0?void 0:e.t0.message),!0));case 30:case"end":return e.stop()}}),e,this,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}(),t.close=function(){var e;this._weights.close(),null==(e=this._biases)||e.close(),this._outputs.close()},t.setWeights=function(e){this._weights=e},t.setBiases=function(e){this._biases=e},t.setInputs=function(e){this._inputs=e},t.getOutputs=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._outputs);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.createFinalizedPass=function(e,t,n){if(!(this._inputs instanceof Pt))return{err:new pt("Conv2d_3x3s1p1",vt.BadParameters,"ModelLayerInput is not a Buffer",!0)};try{var r={label:"conv2d_mid_basic"},i=this._pipeline.getBindGroupLayout(0),o=[{binding:0,resource:{buffer:this._outputs.deviceBuffer}},{binding:1,resource:{buffer:this._inputs.deviceBuffer}},{binding:2,resource:{buffer:this._weights.deviceBuffer}}];this._biases&&o.push({binding:3,resource:{buffer:this._biases.deviceBuffer}});var a=e.device.createBindGroup({layout:i,entries:o});n&&(r.timestampWrites={querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1});var s=t.beginComputePass(r);return s.setPipeline(this._pipeline),s.setBindGroup(0,a),s.dispatchWorkgroups(Math.ceil(this._outputShape[1]/12),Math.ceil(this._outputShape[0]/8),this._outputShape[2]/8),s.end(),{pass:s}}catch(e){return{err:new pt("Conv2d_3x3s1p1",vt.InferenceFailed,"Layer pass failed: "+((null==e?void 0:e.message)||"unknown"),!0)}}},t.createShader=function(){var e=this._configuration.dataType,t="sum;";this._activation&&(t=this._activation.getWGSL("x",e)+";");var n="";return this._biases&&(n="@group(0) @binding(3) var<storage, read> biases: array<fT, M * N>;"),"\n            "+(this._configuration.dataType===Dt.F16?"enable f16;":"")+"\n            const IN_FILTERS: u32 = "+this.inFilters+";\n            const OUT_FILTERS: u32 = "+this.outFilters+";\n            const TOTAL_FILTERS: u32 = IN_FILTERS * OUT_FILTERS;\n            const OUT_WIDTH: u32 = "+this._outputShape[1]+";\n            const OUT_HEIGHT: u32 = "+this._outputShape[0]+";\n            const IN_WIDTH: u32 = "+this._inputShape[1]+";\n            const IN_HEIGHT: u32 = "+this._inputShape[0]+";\n            const PADDING: u32 = 1;\n            const KERNEL_SIZE: u32 = 3;\n            const GROUP_SIDE_W: u32 = 12;\n            const GROUP_SIDE_H: u32 = 8;\n            const GROUP_DEPTH: u32 = 8;\n            const THREAD_DEPTH: u32 = 8;\n            const GROUP_LIMIT_W: u32 = GROUP_SIDE_W + PADDING * 2;\n            const GROUP_LIMIT_H: u32 = GROUP_SIDE_H + PADDING * 2;\n            const GROUP_THREADS: u32 = GROUP_SIDE_W * GROUP_SIDE_H;\n\n            const WARP_SIZE: u32 = 32;\n            alias fT = "+this._configuration.dataType+";\n            @group(0) @binding(0) var<storage, read_write> outputBuffer: array<fT, (OUT_HEIGHT + PADDING * 2) * (OUT_WIDTH + PADDING * 2) * OUT_FILTERS>;\n            @group(0) @binding(1) var<storage, read> inputBuffer: array<fT, (IN_HEIGHT + PADDING * 2) * (IN_WIDTH + PADDING * 2) * IN_FILTERS>;\n            @group(0) @binding(2) var<storage, read> weightsBuffer: array<fT, TOTAL_FILTERS * KERNEL_SIZE * KERNEL_SIZE>;\n            "+n+"\n            var<workgroup> weights: array<fT, KERNEL_SIZE * KERNEL_SIZE * TOTAL_FILTERS>;\n            var<workgroup> inputs: array<fT, GROUP_LIMIT_W * GROUP_LIMIT_H * IN_FILTERS>;\n\n            fn activate(x: fT) -> fT {\n                return "+t+";\n            }\n\n            @compute @workgroup_size(GROUP_SIDE_W, GROUP_SIDE_H, GROUP_DEPTH/THREAD_DEPTH)\n            fn main(@builtin(global_invocation_id) global_id: vec3<u32>,\n                    @builtin(local_invocation_index) tid: u32,\n                    @builtin(local_invocation_id) thread_id: vec3<u32>,\n                    @builtin(workgroup_id) group_id: vec3<u32>) {\n\n                let tileCol = group_id.x * GROUP_SIDE_W ;\n                let tileRow = group_id.y * GROUP_SIDE_H ;\n\n                // Load weights\n                for (var i: u32 = 0 ; i < ((TOTAL_FILTERS*KERNEL_SIZE*KERNEL_SIZE+GROUP_THREADS-1)/GROUP_THREADS); i++) {\n                    let idx: u32 = i * GROUP_THREADS + tid;\n                    if (idx < TOTAL_FILTERS*KERNEL_SIZE*KERNEL_SIZE) {\n                        weights[idx] = weightsBuffer[idx];\n                    }\n                }\n\n                // Load activations. This will be GROUP_LIMIT*GROUP_LIMIT*IN_FILTERS in size.\n                // Buffers are in (H,W,C) format\n\n                if (thread_id.x * 2 < GROUP_LIMIT_W && thread_id.y * 2 < GROUP_LIMIT_H) {\n                    for (var c: u32 = 0; c < IN_FILTERS; c++) {\n                        for (var n: u32 = 0; n < 2; n++) {\n                            for (var m: u32 = 0; m < 2; m++) {\n                                let sCol: u32 = (thread_id.x*2+m) * IN_FILTERS + c;\n                                let sRow: u32 = (thread_id.y*2+n) * IN_FILTERS * GROUP_LIMIT_W;\n                                let gIdx: u32 = (tileRow + thread_id.y*2 + n) * IN_FILTERS * (IN_WIDTH + PADDING * 2) + (tileCol + thread_id.x*2 + m) * IN_FILTERS + c;\n                                inputs[sRow + sCol] = inputBuffer[gIdx];\n                            }\n                        }\n                    }\n                }\n                workgroupBarrier();\n                var centers: array<vec3<u32>, THREAD_DEPTH>;\n                var results: array<fT, THREAD_DEPTH>;\n                for (var i: u32 = 0; i < THREAD_DEPTH; i++) {\n                    let z = group_id.z * GROUP_DEPTH + thread_id.z * THREAD_DEPTH + i;\n                    let y = thread_id.y;\n                    let x = thread_id.x;\n                    centers[i] = vec3<u32>(x,y,z);\n                    results[i] = 0.0;\n                }\n                for (var z: u32 = 0; z < IN_FILTERS; z++) {\n                    let row = thread_id.y + PADDING;\n                    let col = thread_id.x + PADDING;\n                    let c: u32 = (tid + z) % IN_FILTERS;\n                    // Load values. There will probably be bank conflicts here that we can optimize in the future.\n                    var v: array<fT, 9>;\n                    v[0] = inputs[(row-1) * GROUP_LIMIT_W * IN_FILTERS + (col-1) * IN_FILTERS + c];\n                    v[3] = inputs[(row) * GROUP_LIMIT_W * IN_FILTERS + (col-1) * IN_FILTERS + c];\n                    v[6] = inputs[(row+1) * GROUP_LIMIT_W * IN_FILTERS + (col-1) * IN_FILTERS + c];\n                    v[1] = inputs[(row-1) * GROUP_LIMIT_W * IN_FILTERS + (col) * IN_FILTERS + c];\n                    v[4] = inputs[(row) * GROUP_LIMIT_W * IN_FILTERS + (col) * IN_FILTERS + c];\n                    v[7] = inputs[(row+1) * GROUP_LIMIT_W * IN_FILTERS + (col) * IN_FILTERS + c];\n                    v[2] = inputs[(row-1) * GROUP_LIMIT_W * IN_FILTERS + (col+1) * IN_FILTERS + c];\n                    v[5] = inputs[(row) * GROUP_LIMIT_W * IN_FILTERS + (col+1) * IN_FILTERS + c];\n                    v[8] = inputs[(row+1) * GROUP_LIMIT_W * IN_FILTERS + (col+1) * IN_FILTERS + c];\n\n                    // Do dots\n                    for (var i: u32 = 0; i < THREAD_DEPTH; i++) {\n                        let weightBase = centers[i].z * IN_FILTERS * KERNEL_SIZE * KERNEL_SIZE ;\n                        var w: array<fT, 9>;\n                        let off = weightBase + c * KERNEL_SIZE * KERNEL_SIZE;\n                        for (var j: u32 = 0; j < KERNEL_SIZE * KERNEL_SIZE; j++) {\n                            w[j] = weights[off + j];\n                        }\n\n                        var sum: fT = 0.0;\n                        sum += v[0] * w[0];\n                        sum += v[1] * w[1];\n                        sum += v[2] * w[2];\n                        sum += v[3] * w[3];\n                        sum += v[4] * w[4];\n                        sum += v[5] * w[5];\n                        sum += v[6] * w[6];\n                        sum += v[7] * w[7];\n                        sum += v[8] * w[8];\n                        results[i] += sum;\n                    }\n                }\n\n                // write results\n                for (var i: u32 = 0; i < GROUP_DEPTH; i++) {\n                    let x = centers[i].x + PADDING;\n                    let y = centers[i].y + PADDING;\n                    let z = centers[i].z;\n\n                    let outIdx = (tileRow + y) * (OUT_WIDTH + PADDING * 2) * OUT_FILTERS + (tileCol + x) * OUT_FILTERS + z ;\n                    if (tileRow + y < (OUT_HEIGHT - PADDING) && tileCol + x < (OUT_WIDTH - PADDING)) {\n                        outputBuffer[outIdx] = activate(results[i]);\n                    }\n                }\n            };\n        "},e}(),Rt=function(e){return e[e.Bits16=0]="Bits16",e[e.Bits32=1]="Bits32",e[e.Vec2_Bits16=2]="Vec2_Bits16",e[e.Vec4_Bits16=3]="Vec4_Bits16",e[e.Vec2_Bits32=4]="Vec2_Bits32",e[e.Vec4_Bits32=5]="Vec4_Bits32",e}({});function xt(e){switch(e){case 16:return Rt.Vec4_Bits32;case 8:return Rt.Vec2_Bits32;case 4:return Rt.Bits32;case 2:return Rt.Bits16}return Rt.Bits32}function Ot(e){switch(e){case Rt.Bits16:case Rt.Vec2_Bits16:case Rt.Vec4_Bits16:return 2;default:return 4}}function Nt(e){switch(e){case Rt.Bits16:case Rt.Bits32:return 1;case Rt.Vec2_Bits16:case Rt.Vec2_Bits32:return 2;case Rt.Vec4_Bits16:case Rt.Vec4_Bits32:return 4}}function Ut(e){return Ot(e)*Nt(e)}function Ft(e,t,n){void 0===n&&(n=!1);var r=Ut(e),i=2===Ot(e)?"f16":n?"f32":"u32",o="";switch(Nt(e)){case 4:o="vec4<"+i+">";break;case 2:o="vec2<"+i+">";break;default:o=i}return r===t?o:"array<"+o+", "+Math.floor(t/r)+">"}function Vt(e,t,n,r,i,o,a,s,u){var c=Ut(u.bufferMemoryLayout);if(1===r||t===e&&n===e)return Gt(e,r,i,o,a,s,u);if(e>=u.numberThreads*c){for(var d="",l=0;l<r;l++)d+="{\n                let src_off_"+l+" = "+i+" + "+l*t+";\n                let dst_off_"+l+" = "+o+" + "+l*n+";\n                "+Gt(e,1,"src_off_"+l,"dst_off_"+l,a,s,u)+"\n            }";return d}return function(e,t,n,r,i,o,a,s,u){var c=Ut(u.bufferMemoryLayout),d=function(e,t){return function(e,t,n){var r=Math.ceil(e/(n.subgroupSize*t));return{subgroupsPerLoadgroup:r,loadgroups:Math.floor(n.numberThreads/(n.subgroupSize*r))}}(e,Ut(t.bufferMemoryLayout),t)}(e,u),l=d.subgroupsPerLoadgroup,f=d.loadgroups,h=Math.floor(r/f),p=r%f,v="{\n";v+=function(e,t){var n="";return(n+="let loadgroupId = i32("+t.subgroupIdName+") / "+e+";\n")+"let loadgroupTid = i32("+t.threadIdName+") % ("+e*t.subgroupSize+");\n"}(l,u),v+="if (loadgroupTid < "+e/c+") {";for(var m=0;m<h;m++){var g=Bt(0,0,n,h,0,"loadgroupId","loadgroupTid",0,o,m,u),y=Bt(0,0,t,h,0,"loadgroupId","loadgroupTid",0,i,m,u);v+="{\n            "+g.registers+"\n            "+y.registers+"\n            "+s+g.indices+" = "+a+y.indices+";\n        }"}if(p>0){var E=Bt(0,0,n,1,0,"loadgroupId","loadgroupTid",h*f*n,o,0,u),S=Bt(0,0,t,1,0,"loadgroupId","loadgroupTid",h*f*t,i,0,u);v+="\n        if (loadgroupId < "+p+") {\n            "+E.registers+"\n            "+S.registers+"\n            "+s+E.indices+" = "+a+S.indices+";\n        }"}return v+="}",v+="}\n"}(e,t,n,r,i,o,a,s,u)}function Bt(e,t,n,r,i,o,a,s,u,c,d){d.subgroupThreadIdName,0===r&&(d.threadIdName,d.numberThreads,d.subgroupSize);var l=d.bufferMemoryLayout,f=(Ot(l),Nt(l),Ut(l)),h="[";return h+="("+u+" / "+f+") + "+s/f+" + ",h+="("+c+" + "+r+" * "+o+") * "+n/f+" +",h+="("+a+")",{registers:"",indices:h+="]"}}function Gt(e,t,n,r,i,o,a){var s=e*t,u=Ut(a.bufferMemoryLayout),c=Math.floor(s/(u*a.numberThreads)),d=s%(u*a.numberThreads)/u,l="{\n";l+="let loadgroupId = 1;\n",l+="let loadgroupTid = i32("+a.threadIdName+");\n";for(var f=0;f<c;f++){var h=Bt(0,a.numberThreads,u*a.numberThreads,0,0,"loadgroupId","loadgroupTid",0,r,f,a),p=Bt(0,a.numberThreads,u*a.numberThreads,0,0,"loadgroupId","loadgroupTid",0,n,f,a);l+="{",l+=""+h.registers,l+=""+p.registers,l+=""+o+h.indices+" = "+i+p.indices+";",l+="}\n"}if(d>0){l+="\n              if ("+a.threadIdName+" < "+d+") {\n";var v=Bt(0,0,d*u,0,0,"loadgroupId","loadgroupTid",c*u*a.numberThreads,r,0,a),m=Bt(0,0,d*u,0,0,"loadgroupId","loadgroupTid",c*u*a.numberThreads,n,0,a);l+=v.registers,l+=m.registers,l+=""+o+v.indices+" = "+i+m.indices+";",l+="}"}return l+"}\n"}var Ht=function(){function e(e,t,n){void 0===n&&(n=!1),this.inChannels=e,this.outChannels=t,this.hostReadableOutput=n,this._configuration=void 0,this._activation=void 0,this._weights=void 0,this._biases=void 0,this._inputs=void 0,this._outputs=void 0,this._pipeline=void 0,this._inputShape=void 0,this._outputShape=void 0}var t=e.prototype;return t.configure=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a,s,u,c;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.device.pushErrorScope("validation"),this._outputShape=[n.inputShape[0]-1+1,n.inputShape[1]-1+1,this.outChannels],this._inputShape=n.inputShape,r=(this._outputShape[0]+2)*(this._outputShape[1]+2)*this.outChannels,y.debug("[Conv2d_igemm_f16_Nx3x3x8]: Hidden output shape: "+this._outputShape+", size: "+r+" hostReadable "+this.hostReadableOutput),i=n.dataType===Dt.F32?4:2,this._configuration=n,this._activation=n.activation,this._outputs=new Pt(t,r*i,this.hostReadableOutput?It.DeviceToHost:It.Default),o=this._createShader(),y.debug("[Conv2d_igemm_f16_Nx3x3x8]: Shader",o),e.next=14,t.createShaderModule(o);case 14:if(a=e.sent,s=a.module,!(u=a.err)&&s){e.next=19;break}return e.abrupt("return",u||new pt("Conv2d_igemm_f16_Nx3x3x8",vt.PipelineCreationFailed,"Failed to create shader module",!0));case 19:return this._pipeline=t.device.createComputePipeline({layout:"auto",compute:{module:s,entryPoint:"main"},label:"conv2d_igemm_f16_Nx3x3x8"}),e.next=22,t.device.popErrorScope();case 22:if(!(c=e.sent)){e.next=25;break}return e.abrupt("return",new pt("conv2d_igemm_f16_Nx3x3x8",vt.PipelineCreationFailed,"Failed to create compute pipeline: "+c.message,!0));case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.setWeights=function(e){this._weights=e},t.setBiases=function(e){this._biases=e},t.setInputs=function(e){this._inputs=e},t.setQuantOffsets=function(e){},t.getOutputs=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._outputs);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.close=function(){var e;this._weights.close(),null==(e=this._biases)||e.close(),this._outputs.close()},t.createFinalizedPass=function(e,t,n){if(!(this._inputs instanceof Pt))return{err:new pt("Conv2d_igemm_f16_Nx3x3x8",vt.BadParameters,"ModelLayerInput is not a Buffer",!0)};try{var r={label:"conv2d_mid_basic"},i=this._pipeline.getBindGroupLayout(0),o=[{binding:0,resource:{buffer:this._outputs.deviceBuffer}},{binding:1,resource:{buffer:this._inputs.deviceBuffer}},{binding:2,resource:{buffer:this._weights.deviceBuffer}}];this._biases&&o.push({binding:3,resource:{buffer:this._biases.deviceBuffer}});var a=e.device.createBindGroup({layout:i,entries:o});n&&(r.timestampWrites={querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1});var s=t.beginComputePass(r);return s.setPipeline(this._pipeline),s.setBindGroup(0,a),s.dispatchWorkgroups(Math.ceil(this._outputShape[1]/16),Math.ceil(this._outputShape[0]/8),1),s.end(),{pass:s}}catch(e){return{err:new pt("Conv2d_igemm_f16_Nx3x3x8",vt.InferenceFailed,"Finalized pass failed: "+((null==e?void 0:e.message)||"unknown"),!0)}}},t._createShader=function(){var e=this,t=this._configuration.dataType,n="sum;";this._activation&&(n=this._activation.getWGSL("x",t)+";");var r="";this._biases&&(r="@group(0) @binding(3) var<storage, read> biases: array<fT, M * N>;");var i=this._configuration.loadWidthBytes,o={bufferMemoryLayout:xt(i),numberThreads:128,subgroupSize:32,threadIdName:"tid",subgroupThreadIdName:"wtid",subgroupIdName:"wid",subgroupSizeName:"WARP_SIZE"},a=Ut(o.bufferMemoryLayout),s=(this._inputShape[0]+2)*(this._inputShape[1]+2)*this.inChannels*2,u=this.inChannels*this.outChannels*3*3*2,c=18*this.inChannels*10*2,d=Nt(o.bufferMemoryLayout),l=a/(2*d);return"\n        "+(this._configuration.dataType===Dt.F16?"enable f16;":"")+"\n        // Load Width: "+i+"\n        const IN_CHANNELS: i32 = "+this.inChannels+";\n        const OUT_CHANNELS: i32 = "+this.outChannels+";\n        const PACKED_IN_CHANNELS: i32 = IN_CHANNELS/2;\n        const PACKED_OUT_CHANNELS: i32 = OUT_CHANNELS/2;\n        const KERNEL_SIZE: i32 = 3;\n\n        const TILE_IN_W: i32 = 18;\n        const TILE_IN_H: i32 = 10;\n        const TILE_OUT_W: i32 = 16;\n        const TILE_OUT_H: i32 = 8;\n        const TILE_OUT_DEPTH: i32 = OUT_CHANNELS;\n        const PACKED_TILE_OUT_DEPTH: i32 = PACKED_OUT_CHANNELS;\n\n        const IN_PADDING: i32 = 1;\n        const OUT_PADDING: i32 = 1;\n\n        const IN_WIDTH: i32 = "+this._inputShape[1]+";\n        const IN_HEIGHT: i32 = "+this._inputShape[0]+";\n        const OUT_WIDTH: i32 = "+this._outputShape[1]+";\n        const OUT_HEIGHT: i32 = "+this._outputShape[0]+";\n\n        const K: i32 = IN_CHANNELS * 3 * 3;\n\n        alias fT = "+this._configuration.dataType+";\n        @group(0) @binding(0) var<storage, read_write> outputBuffer: array<vec2<fT>, (OUT_HEIGHT + OUT_PADDING * 2) * (OUT_WIDTH + OUT_PADDING * 2) * PACKED_OUT_CHANNELS>;\n        @group(0) @binding(1) var<storage, read> inputBuffer: "+Ft(o.bufferMemoryLayout,s)+";\n        @group(0) @binding(2) var<storage, read> weightsBuffer: "+Ft(o.bufferMemoryLayout,u)+";\n        "+r+"\n\n        var<workgroup> S_WEIGHTS: "+Ft(o.bufferMemoryLayout,u)+";\n        var<workgroup> S_ACTIVATIONS: "+Ft(o.bufferMemoryLayout,c)+";\n\n        fn activate(x: fT) -> fT {\n            return "+n+";\n        }\n\n        @compute @workgroup_size(128,1,1)\n        fn main(@builtin(global_invocation_id) global_id: vec3<u32>,\n                @builtin(local_invocation_index) tid: u32,\n                @builtin(local_invocation_id) thread_id: vec3<u32>,\n                @builtin(workgroup_id) group_id: vec3<u32>) {\n\n            let tileCol: i32 = i32(group_id.x) * TILE_OUT_W;\n            let tileRow: i32 = i32(group_id.y) * TILE_OUT_H;\n            let wid: i32 = i32(tid) / 32;\n            let wtid: i32 = i32(tid) % 32;\n            let warpX: i32 = wid % 2;\n            let warpY: i32 = wid / 2;\n            let threadX: i32 = wtid % 8;\n            let threadY: i32 = wtid / 8;\n            \n            {\n                "+Vt(u,0,0,1,"0","0","weightsBuffer","S_WEIGHTS",o)+"\n            }\n            \n            // Load activations to SMEM\n            {\n                let x: i32 = i32(group_id.x) * TILE_OUT_W;\n                let y: i32 = i32(group_id.y) * TILE_OUT_H;\n                let offsetBytes = (y * (IN_WIDTH+IN_PADDING*2) * IN_CHANNELS + x * IN_CHANNELS) * 2;\n                "+Vt(18*this.inChannels*2,this.inChannels*(this._inputShape[1]+2)*2,18*this.inChannels*2,10,"offsetBytes","0","inputBuffer","S_ACTIVATIONS",o)+"\n            }\n            // Wait for memory operations to complete\n            workgroupBarrier();\n\n            var results: array<array<array<vec2<fT>, PACKED_OUT_CHANNELS>, 1>, 1>;\n            for (var k: i32 = 0; k < K; k += 8) {\n                var weights: array<array<vec2<fT>, 4>, OUT_CHANNELS>;\n                var activations: array<array<array<vec2<fT>,4>, 1>, 1>;\n                "+kt(1,"\n\t\t\t",(function(e){return kt(1,"\n\t\t\t",(function(t){return"\n                    {\n                        let currentXOff: i32 = (k / IN_CHANNELS) % 3;\n                        let currentYOff: i32 = (k / IN_CHANNELS) / 3;\n                        let currentCOff: i32 = k % IN_CHANNELS;\n                        let idx: i32 = ((currentYOff + (warpY * 4) + (threadY * 1) + "+e+") * TILE_IN_W * IN_CHANNELS\n                            + (currentXOff + (warpX * 8) + (threadX * 1) + "+t+") * IN_CHANNELS\n                            + currentCOff) / "+l+";\n                        "+kt(8/l,"\n\t\t\t",(function(n){return"{\n                                    let outer: i32 = (idx+"+n+") / "+d+";\n                                    let inner: i32 = ((idx+"+n+") % "+d+");\n                                    activations["+e+"]["+t+"]["+n+"] = vec2<f16>(unpack2x16float(S_ACTIVATIONS[outer][inner]));\n                                }\n                                "}))+"\n                    }"}))}))+"\n                \n                for (var co: i32 = 0; co < OUT_CHANNELS; co++) {\n                    let idx: i32 = co * KERNEL_SIZE * KERNEL_SIZE * IN_CHANNELS / "+l+";\n                    "+kt(8/l,"\n\t\t\t\t",(function(e){return"\n                          {\n                            let outer: i32 = (idx + k / "+l+" + "+e+") / "+d+";\n                            let inner: i32 = ((idx + k / "+l+" + "+e+") % "+d+");\n                            weights[co]["+e+"] = vec2<f16>(unpack2x16float(S_WEIGHTS[outer][inner]));\n                          }\n                          "}))+"\n                }\n                \n                "+kt(1,"\n\t\t\t\t",(function(t){return kt(1,"\n\t\t\t\t",(function(n){return kt(e.outChannels,"\n\t\t\t\t",(function(e){var r=Math.floor(e/2),i=e%2;return kt(8,"\n\t\t\t\t",(function(o){var a=Math.floor(o/2),s=o%2;return"results["+t+"]["+n+"]["+r+"]["+i+"] += activations["+t+"]["+n+"]["+a+"]["+s+"] * weights["+e+"]["+a+"]["+s+"];"}))}))}))}))+"\n            }\n            // OK we now have all of our output channels for this pixel. Write to VRAM.\n            "+kt(1,"\n\t\t\t",(function(t){return kt(1,"\n\t\t\t",(function(n){return"\n            {\n                let idx: i32 = (tileRow + OUT_PADDING + (warpY * 4) + (threadY * 1) + "+t+") * (OUT_WIDTH + OUT_PADDING * 2) * PACKED_OUT_CHANNELS\n                              + (tileCol + OUT_PADDING + (warpX * 8) + (threadX * 1) + "+n+") * PACKED_OUT_CHANNELS; \n                "+kt(e.outChannels/2,"\n\t\t\t\t",(function(e){return"outputBuffer[idx + "+e+"] = vec2<fT>(activate(results["+t+"]["+n+"]["+e+"][0]), activate(results["+t+"]["+n+"]["+e+"][1]));"}))+"\n            }"}))}))+"\n        };\n    "},e}(),Wt=function(){function e(e,t,n,r,i){void 0===i&&(i=!1),this.inFeatures=e,this.outFeatures=t,this.kernelSize=n,this.inPadding=r,this.hostReadableOutput=i,this._configuration=void 0,this._activation=void 0,this._weights=void 0,this._biases=void 0,this._inputs=void 0,this._lrImage=void 0,this._outputs=void 0,this._pipeline=void 0,this._inputShape=void 0,this._outputShape=void 0,this._sampler=void 0,this._storageFormat=void 0}var t=e.prototype;return t.configure=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a,s,u;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.device.pushErrorScope("validation"),r=Math.floor((this.kernelSize-1)/2),this._outputShape=[n.inputShape[0]-r+this.inPadding,n.inputShape[1]-r+this.inPadding,this.outFeatures],this._storageFormat=t.storageFormat,this._inputShape=n.inputShape,this._configuration=n,this._activation=n.activation,this._outputs=new At(t,this._outputShape[1],this._outputShape[0],this._storageFormat,this.hostReadableOutput?It.DeviceToHost:It.Default),i=this._createShader(n.expectedInputType),this._sampler=t.device.createSampler({magFilter:"linear",minFilter:"linear"}),e.next=12,t.createShaderModule(i);case 12:if(o=e.sent,a=o.module,!(s=o.err)&&a){e.next=17;break}return e.abrupt("return",s||new pt("Conv2d_Exit_ChromaCombine",vt.ShaderCompilationFailed,"Failed to create shader module",!0));case 17:return this._pipeline=t.device.createComputePipeline({layout:"auto",compute:{module:a,entryPoint:"main"},label:"conv2d_entry_upscale"}),e.next=20,t.device.popErrorScope();case 20:(u=e.sent)&&new pt("Conv2d_Exit_ChromaCombine",vt.PipelineCreationFailed,"Failed to create compute pipeline: "+u.message,!0);case 22:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.setWeights=function(e){this._weights=e},t.setBiases=function(e){this._biases=e},t.setInputs=function(e){this._inputs=e},t.setQuantOffsets=function(e){},t.getOutputs=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._outputs);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t.setLowResTexture=function(e){this._lrImage=e},t.close=function(){var e;this._weights.close(),null==(e=this._biases)||e.close(),this._outputs.close()},t.createFinalizedPass=function(e,t,n){if(!(this._inputs instanceof Pt))return{err:new pt("Conv2d_Exit_ChromaCombine",vt.BadParameters,"ModelLayerInput is not a Buffer",!0)};try{var r,i={label:"conv2d_exit"};if(this._lrImage instanceof GPUTexture)r=this._lrImage.createView();else if(this._lrImage instanceof VideoFrame)r=e.device.importExternalTexture({source:this._lrImage});else{if(!(this._lrImage instanceof GPUExternalTexture))return{err:new pt("Conv2d_Exit_ChromaCombine",vt.BadParameters,"Input is not one of GPUTexture, VideoFrame, GPUExternalTexture",!0)};r=this._lrImage}var o=this._pipeline.getBindGroupLayout(0),a=[{binding:0,resource:this._outputs.deviceTexture.createView()},{binding:1,resource:{buffer:this._inputs.deviceBuffer}},{binding:2,resource:{buffer:this._weights.deviceBuffer}},{binding:3,resource:r},{binding:4,resource:this._sampler}];this._biases&&a.push({binding:3,resource:{buffer:this._biases.deviceBuffer}});var s=e.device.createBindGroup({layout:o,entries:a});n&&(i.timestampWrites={querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1});var u=t.beginComputePass(i);return u.setPipeline(this._pipeline),u.setBindGroup(0,s),u.dispatchWorkgroups(Math.ceil(this._outputShape[1]/16),Math.ceil(this._outputShape[0]/16),1),u.end(),{pass:u}}catch(e){return{err:new pt("Conv2d_Exit_ChromaCombine",vt.InferenceFailed,"Failed to create finalized pass: "+((null==e?void 0:e.message)||"unknown"),!0)}}},t._createShader=function(e){var t=e===wt.External?"texture_external":"texture_2d<fT>",n=this._configuration.dataType;this._activation&&this._activation.getWGSL("sum",n);var r="";return this._biases&&(r="@group(0) @binding(5) var<storage, read> biases: array<fT, M * N>;"),"\n            "+(this._configuration.dataType===Dt.F16?"enable f16;":"")+"\n\n            const OUT_FEATURES: u32 = "+this.outFeatures+";\n            const OUT_WIDTH: u32 = "+this._outputShape[1]+";\n            const OUT_HEIGHT: u32 = "+this._outputShape[0]+";\n            const IN_WIDTH: u32 = "+this._inputShape[1]+";\n            const IN_HEIGHT: u32 = "+this._inputShape[0]+";\n            const IN_FEATURES: u32 = "+this.inFeatures+";\n            const IN_PADDING: u32 = "+this.inPadding+";\n            const KERNEL_SIZE: u32 = "+this.kernelSize+";\n            const GROUP_SIDE: u32 = 16;\n            const GROUP_THREADS: u32 = GROUP_SIDE * GROUP_SIDE;\n\n            alias fT = "+this._configuration.dataType+";\n            @group(0) @binding(0) var outputTexture: texture_storage_2d<"+this._storageFormat+", write>;\n            @group(0) @binding(1) var<storage, read> inputBuffer: array<fT, (IN_HEIGHT + IN_PADDING * 2) * (IN_WIDTH + IN_PADDING * 2) * IN_FEATURES>;\n            @group(0) @binding(2) var<storage, read> weightsBuffer: array<fT, OUT_FEATURES * IN_FEATURES * KERNEL_SIZE * KERNEL_SIZE>;\n            @group(0) @binding(3) var lrTexture: "+t+";\n            @group(0) @binding(4) var inputSampler: sampler;\n            "+r+"\n            const Y_COEF = vec3<fT>(0.299, 0.587, 0.114);\n            fn rgbToYuv(x: vec3<f32>) -> vec3<f32> {\n                let y = dot(x, vec3<f32>(Y_COEF));\n                return vec3<f32>(\n                    y, 0.493*(x.b-y), 0.877*(x.r-y)\n                );\n            }\n\n            fn yuvToRgb(x: vec3<f32>) -> vec3<f32> {\n                return vec3<f32>(\n                    x.x + 1.0 / 0.877 * x.z,\n                    x.x - 0.39393 * x.y - 0.58081 * x.z,\n                    x.x + 1.0 / 0.493 * x.y\n                );\n            }\n\n            @compute @workgroup_size(GROUP_THREADS,1,1)\n            fn main(@builtin(global_invocation_id) global_id: vec3<u32>,\n                    @builtin(local_invocation_index) tid: u32,\n                    @builtin(workgroup_id) group_id: vec3<u32>) {\n                let cRow = group_id.y * GROUP_SIDE + tid / GROUP_SIDE;\n                let cCol = group_id.x * GROUP_SIDE + (tid % GROUP_SIDE);\n\n                // TODO: Optimize. First, load these into workgroup memory.\n                // assuming symmetric odd-numbered kernel size\n                var inputs: array<fT, KERNEL_SIZE * KERNEL_SIZE * IN_FEATURES>;\n                let off: u32 = (KERNEL_SIZE-1)/2;\n\n                for (var m: u32 = 0; m < KERNEL_SIZE; m++) {\n                    for (var n: u32 = 0; n < KERNEL_SIZE; n++) {\n                        for (var c: u32 = 0; c < IN_FEATURES; c++) {\n                            let in_idx = (cRow + n - off + IN_PADDING) * (IN_WIDTH + IN_PADDING * 2) * IN_FEATURES + (cCol + m - off + IN_PADDING) * IN_FEATURES + c;\n                            inputs[n * KERNEL_SIZE * IN_FEATURES + m * IN_FEATURES + c] = inputBuffer[in_idx];\n                        }\n                    }\n                }\n\n                // Should probably change the order of these loops to better map to channel ordering\n                // Also move weights loading into workgroup memory...\n                var color = vec4<f32>(0.0, 0.0, 0.0, 1.0);\n                for (var z: u32 = 0; z < OUT_FEATURES; z++) {\n                    var sum: fT = 0.0;\n                    for (var j: u32 = 0; j < IN_FEATURES; j++) {\n                        var weights: array<fT, KERNEL_SIZE * KERNEL_SIZE>;\n                        for (var m: u32 = 0; m < KERNEL_SIZE; m++) {\n                            for (var n: u32 = 0; n < KERNEL_SIZE; n++) {\n                                var weights_off = z * IN_FEATURES * KERNEL_SIZE * KERNEL_SIZE + m * KERNEL_SIZE * IN_FEATURES + n * IN_FEATURES + j;\n                                weights[m * KERNEL_SIZE + n] = weightsBuffer[weights_off];\n                            }\n                        }\n                        {\n                            {\n                                sum += inputs[0 * KERNEL_SIZE * IN_FEATURES + 0 * IN_FEATURES + j] * weights[0 * KERNEL_SIZE + 0];\n                                sum += inputs[0 * KERNEL_SIZE * IN_FEATURES + 1 * IN_FEATURES + j] * weights[0 * KERNEL_SIZE + 1];\n                                sum += inputs[0 * KERNEL_SIZE * IN_FEATURES + 2 * IN_FEATURES + j] * weights[0 * KERNEL_SIZE + 2];\n                            }\n                            {\n                                sum += inputs[1 * KERNEL_SIZE * IN_FEATURES + 0 * IN_FEATURES + j] * weights[1 * KERNEL_SIZE + 0];\n                                sum += inputs[1 * KERNEL_SIZE * IN_FEATURES + 1 * IN_FEATURES + j] * weights[1 * KERNEL_SIZE + 1];\n                                sum += inputs[1 * KERNEL_SIZE * IN_FEATURES + 2 * IN_FEATURES + j] * weights[1 * KERNEL_SIZE + 2];\n                            }\n                            {\n                                sum += inputs[2 * KERNEL_SIZE * IN_FEATURES + 0 * IN_FEATURES + j] * weights[2 * KERNEL_SIZE + 0];\n                                sum += inputs[2 * KERNEL_SIZE * IN_FEATURES + 1 * IN_FEATURES + j] * weights[2 * KERNEL_SIZE + 1];\n                                sum += inputs[2 * KERNEL_SIZE * IN_FEATURES + 2 * IN_FEATURES + j] * weights[2 * KERNEL_SIZE + 2];\n                            }\n                        }\n                    }\n                    color[z] = clamp(f32(sum), 0.0627, 1.0-0.0627);\n                }\n\n                let texSize = vec2<f32>(f32(OUT_WIDTH), f32(OUT_HEIGHT));\n                let texelSize = 1.0 / texSize;\n                let inPos = vec2<f32>(f32(cCol+1), f32(cRow)) * texelSize;\n                let lr = rgbToYuv(textureSampleBaseClampToEdge(lrTexture, inputSampler, inPos).rgb * 0.8627 + 0.0627);\n                let mixval: f32 = f32(cCol > 3) * f32(cRow > 3) * f32(cCol < OUT_WIDTH - 3) * f32(cRow < OUT_HEIGHT - 3);\n                color.x = mix(lr.x, color.x, mixval);\n                color = vec4((yuvToRgb(vec3<f32>(color.x, lr.y, lr.z)) * 1.1591) - 0.0627, 1.0);\n                textureStore(outputTexture, vec2<u32>(cCol, cRow), color);\n            };\n        "},e}(),Kt=function(){function e(e){this.a=e}var t=e.prototype;return t.activationsPerFeature=function(){return 1},t.getWGSL=function(e){return this.a+" * "+e+" + (1 - "+this.a+") * max(0, "+e+")"},e}(),jt={"init_feat.0":{weight:{offset:0,bits:16,count:144}},"bottleneck.0":{weight:{offset:288,bits:16,count:1152}},"bottleneck.2":{weight:{offset:2592,bits:16,count:576}},"bottleneck.4":{weight:{offset:3744,bits:16,count:576}},"bottleneck.6":{weight:{offset:4896,bits:16,count:576}},reconstruct:{weight:{offset:6048,bits:16,count:72}}},zt=function(){try{for(var e=atob("SKM6JcKhrbrmQFkvoDrqwEewEbtDQuM5fjvbw7C5eLDFO1crj7gZQkkzGTp0wwO0nLAOqdqsKi6aufS2Db7bQTGyWKAQsQ4wNrqdQV+4abBixRhBajkrOKS5V6+aLDIfyUDLwOGtdq4qL/mkAbK7L5YzyzurvaW9cjicOEwzJKLuOx8z6DzvwJI6LjP3u3swZrjXNE2xjMALP7K0VixKts6gVLWVOTnBFzSzOY48OCgMtwa8JLkwM2IkLCqlQIg9WLmqPEmoRD68wlxAdrwOQVG/kbh+MlAsTqlXOhIxcEBmwk26ILn/OAcyHqysLNaqYzL0w001gbHKQy21FyoYOqG6nK2Dw4JDn6kPM5eyjLR1MW2tX7juw+o/YjWBPx24gcG3sXm+wbRJPCa2DEAJugO8uiY4M70xZzIGtXM8jLQyRmK4erh0OHarij0YvwOz+r54srOvFreoLRkwKUBNPRS+ozM6Nma45bShvZi6rbQXvkOwHriTuK88wrVrtEotnLQBQKnANzSaxL/BBb0LumayPqBmPFm8cSo2vDE94r+7OOjAGr60w+TC0bk4vGWncke9Oay8L7XaOF5CbrK5wZS0L7O4PWG0zrlKOPi25D++xzk5IbntqAK4QbgVOgy5ejyeu3o6VDQdN3U+0rQKuFa+0sHoOzE3dbh7vqk65sQkwGE+iroFLi8xJrwCO405U0iGPMe/4D1SuDO1GTzSPAk3LbM7uqO47DzaPSU8Irt2xys8OD1cOqS9jTfJuJbA6Tsju0yvQLVQPLE1cjaSsoQot7tbOh01hbdzvk4wvsBeQhY/csByQM+z4754vE6/jkASvRm/jLsWtbw95zygvAm84Ll6PI62bkBHPb2yJ778PeK84jv9ucq72r/KuFW1KDlMt3o7nsEPs2SwFbv8PJlAXD/EplQ9KTvcLfg6MChsPWawwsJUPUY0pTTwufI+8bhKOpjALiJ2Or48wL4etZJAEsC/Ql8uv75iw6LCbT01xaM7S75fvDg4FMGAuOooIrY4upyhWrzzPAoyNrNeOB44sEGLPNe4OrdduwutaD/WPdU8jzAVQNm/ib1vN3e8Hr8xwaI31L9KPdU4n8S9uzCzC7hGtuO9MsNFPqM7/bZeyS5Baj0XuoXEQLZJvb6+k7xmNXqsrrATphwtMLyPOuBAzT2gtWU1HrSoN/M41LnvRCo8RsKespQ+G8EKQEs5VriPPou74TrkPBvCMrwytQa9lbvTOCI9ijlPITrANzAXP3S4djYTK8I8ILzeuAytNrzoMsc7XLlBOdQ8NjX0reM42T9AwSs9173bunrBXj38xDa/Vjy2wDXCAUBqvzu+1cJsxPXAo8NxNns/lyrjQOhAJjGeK3q5sL+Dulo+EjyVOMk/kLQ/OqmxtaiQQHC6cC1nvRU7E0EbvIa9m7HyuKa8fUJ7r2+8ij92Oow77LMsN9A/YCxWPGxAeTV3NA43F7jbvJ+9HT5UwDs/NT4GvvU6NDWrubS4kDsCO8w0E7pOPuS4cTtxNR6z1azesmy8Y0EJOvy9mrQSOOAzZa3uNY4v2Dl9NzY3RzwbsLG/gbh9vY0/Ar4sOQI6yL3hNB6527wPtSSxAbUbObU6GL23OWA+ELoxuLe6qjR2upK72Dt6wgc9UbJaOMg65jdktJwzwigHuYi0tjuyvDI9z71dMIK8iTeuOTIzbb9AOxw6DTgFvMW8nTkxuCi7iT02JEy/ZEQZt1G8OS2ls449aj77vC08GKQJOJ28HjI6skI1PDe5uGA5tzCIsOm7uLv5sbu4cjVpp+8xxLn+t8ewUz2IMsgwI7NlMxY0mTvYqEE4LLGxvBW6+sOqPfLB9DYJuZempz4bMnm+XbexJKM3Xrr6Pb85K7c0sgypxrkquj0x9TVYyTc9YjslPga7HTW5uFExWUB3OSK5IbgcOEyvEj2QODIz0TlMHjc1ObzDu4Syva5kQnSwxrT2NQ27Qzt0uUGp6zZEM78noK3HOVk8VjwzOLK4zKqgPtw7cLxVxIkuTrvBuE++5bhDu8g/iDIDLvdCGj5OuQc9orw7u/g87cGKvNKmG7w2uiy8h8I9OGw6OToivZS4msCbv1PCwb2TvdLBxyuTuq02DbE1QG02Drzyv5BDLDjNuthAt0MLOPM9RryiwADA2LjsvSK4ortBwFTBhbm2u9a9ETzxsygn0bEUuRM198EFHIW1zrgCvIW3HkBzMMXAozzOsNO1zTbkL7pBvbsoP545Uz8cPT68BD/4t4e5yj11OYUwGDlWN7Uv9rWivqu5BDZ4wFy9CsMUweA/j7musnU5ZrTTuVs8Cz6FvEO1FjxSsPQ5ccAARKZAhsRmQhc59rz8wSCwuESvw5g+rUMIPQO1pUCStRHFWbisuLq4uTdDOe+tzrQwpr2877U8wDo9sbDPPKIyBLmjrN024Dx/P7K+xr+wtjW9l7tdPo5BAT8uM0A0dz/usKC/OcHDvHY2PTomQJ08QMFXpkS4PMDiwG4xlMAiPP6+1TTzPvnAK73Ev5+/VkIMyLM3XjtawzU6ezTsPvbA6zwMwDoqNDfVuhW12DO6Nag57jAvrCm4wzmNOPa9T6h2tPu86L/eN184dMWRQGu4vzwiPXy+Lbv0wc6uA7Xiuh2++7zOQPuu6L4Bveg22Lp+Nec4sb3pQWbB1rt+sUTCUb0xO+RC5DRHuLw8ZqZSu7a5NzWZtBG7TDefuqSz571tuPUokT5ftBE4HrxZNnk3j7uaNTI4D0G9uia++iduOuPC5b1BqljBwLsvOoK3VD1ivgQ5aL8gwGq1vzyHtuI8ZL6iugS8UbQaO3zDmsV2uDQspL5/PnVGdsEetym67zdJwlm65z7/sK0oO8MvvO69X8LsPJ+6LsZRP5s5GrwNRF++X8cFNFy5TrVpt9O05LL9sra9Ej71t2I9QjT3NP0/OL42uR+6rbAdvZ1B4DzNPCo+77kgunG5RUGOOEWkGr8KNZu+JK7xtMm9EDhRPprCD0BDMiy10rRPtgO39De3vqooTLy3P445cLwIPY8z58NgOJo/QsDpuse3UzefOLa9lbrtNfYx8r4TwBC12z8VQZWwNz8QuJa6qsFZs5e8s8DLNzO/MLtNQqDB5j7GtuO7VT1Dv5Q9B8JGuuI2O7pouOa5niIftxI7mLJgvQm45Tu8Pv+srTijQa0y9SylJjQ9qDUINSG40rS7OXy4Hr5QPFW4+7x5PY88KUFCNGZCHTR/PmZBvb9ItQM9l8H9vKOzY8J7PYLB2UDbNCs/Hr05QQlANj2jtZS9Vz4wvWw86zz3Ob8uq8FtssW92jOJubq/7iXirvs6Tb4ZOQu4/sBxwDY52L7sPwdEWjkcv1+2WrkpPAi9sTRVNL88K7+gwgQ5QDXZMmI5y735QMs36zvluIu7fr18uL+xSi0RutRCC7QCxIQ0WzQQvka/mb7KOwgyDi39O7Y1/jBlrT4ptzVbKmUuoK6FtUg3tS9FOoU6Hy3XNTUulbcjNoUxb7R9pfMpRjHAvG8iFrjksDsqkzVcNnQ2OS+8r465L7rxtwK4GjniM2k/frxYOeO5iD1ysIcwkKT/vFO1Vbt7uC4oRDWRKM207EAfs1K5WrWSvOU1UbeoOMFAzLJeNEG7o7Wdu+m51rqpP5K38DP8Nmk14Da+uOYwFTiOvIW7Pr+6vxS+QLvnLCBCxLu0tDy1ojgQuJy+iqpquu261i1ROLOxTTnmLcE4FbReOMkxZjJ5PaC1vLY3sQZBhjNTK+k5UrTptxe+5byLQYQ09jWxsi43zzR2sWwyvbhhMzYyRDibMfY2RSm/NRQ4NDDStvcq07ZsNCsvNS2kwAOqOrCGKT4jvBdwnDadiLKRL3AufKXuNbAuHbJ4sMUnta0TM5AzzLSANTG0nbvROny7qK+ZKCGxgioiM/cwqzcJLqmyiyoEwEouWbDqKy88JqQcunC8PkRvuwA9Lbj4PZu45LG+LzyxgS2Tqhakia8SLmuwTqFqLdO0nLFItCCwZapfIewij7EKwJy+R8AgSIMybLVJK8MyyK6+LE6vrrQ0MtmzSDhGO1EwSy6PMCY6hrOrr8M5hbncKhiv0Da/vpw5+bH3OEe7wieEupWx30DVsw+wTrhmQLa6+LTvMxc6KCyAtE43LbgNs+uwhjhwwUY4S7hRufsvEzPyN2A1l0KNsCqveL9XLjq07rGcMSVFnrvrrlU7nb3YsPI2bDlxwYs0tCmrN6k0kaTJKUapHrR0trE2B71RsmKyaLNzIpQu5SOgtZ40+TH+sSwcca8YOAEtdzbjqRAzOLPgtGmh273AtlY5I8HAPekyprgotZM2jK5KtAY3Ur34svU2Ca8zMNEzFSvtqJusGrEes7MnKTUNrzwtd7SvL4U25jEpsrdAjS3uMWoxu6ynuugv9K+tua6usC+HMtkyJC2pM16yNLy4NO8yjaSZOhS2vrIcrP08Ui3xuow207zCtDooADOqOTAzM7WZNdizHDyks2m1njseOf05d7RYNX84e7lStlpAj71ZsNQ0OTeMuSkyKjUjviGrxreELEU1JLsENo+1Yre/M5eo6LQmvaUuk7C3taI/BjHOsWW1MzkINnU0UzVZIN2wG6nPNNgyCTS7KQAxerWeM9KqOyDgoDQ5yDI0Myq4VK1ALnOz9CRWqBYu66xWMn+z0iSsOIc00LQfrgy0hK3UM/0p/DDVK9C4fDTeuVW8uzV+Nvi0+7JjNF40sbh3QKWxsCmHNbSyHrUwsb21wLLyroux3i28M/KxiTQ3uAK+M6i3rwesljVLLGczAzGNuGAtFC6zLqIlZawIsFejYqCso/auXiwXMtGuPSjfJUcsSS3MJz2qtrYjHk8pHq3DNIOpJrEyJi6smjDyodUmH6veqlGqAbLMw9EswzWfMmg6Ca7sNOerbK/vLEGwM6zysG2cSKisMLk0oatCpkCyiTEAqgYsl6Q8vYeyWa6WrYe8LTF6pOYpMDlhKlunKahdNLMYWqprqOE6ICrWKVcl+iYUK/Gz1CblN0cwzbC/shi1lrAoMK8tOa9zrzuvdh0/s9cvcSE8tNM2vK7RwSwv9jBoqCu09LGCNq0smblNsFu2JbZcrxU1a7IhL0W5O7KGNCM17i6CrTIyLaxiL5WwaCRxqxGxl7R5O7sxH7jesVOxjbGnrcEynS35p9C2YylXrFs02bEWK5xC8jWzNR6y368KNNs2SDEfOKiwdzSgvHmvTbAyr3g1M7BmsU+yiTRAMK0shLdYNQw8ZjdQg3m2tTR3sIw1WzeYuUaz+DDtuNi2ji5dNp41SjWjMgcz/bdmoWCpFLoqtx4//LWKtpm5zTG3L1GyCLjyOigwdbInMm0wy7PgtCOytLJLtk+tdDYGrVgv5rf4sAs+JjbBFhmsfbVwKyWyxKDMNOu06KoWM1O106+EtBWvNChmtJGysDDDqSkwS7iZtThE1y2WtAazPauJNZox+7hCs1u6VLeAqlO82bJfs5G5V7CwtDisnDQIudK2jrQvuUM3xTKzL6MyMiZSKP+2nR/7NGYwZyV0NAG4B7GTttKx4DRBMTQzNjPNqJg3IbS8tfg6iSGtp86xqLSbqDqf6LCzOPGyOqvTqca1y6xqJbiy+7Iop1GpM63JqoUxhLY7tLY3ZKoaKNq1ZLTyKVurZLj/MMi4XbKNsU2rwrXnJl+60LeAtMKlp6fntDMt8qzutN89gTPHLp0wdDRLJmQz0rQrOSs06LGPNRy5ZLLFpzq4niqlmsYwMC6PtE41qzBKnbk1SJm4LHKvirc4qEsoIbNhMiy0dC6rub20oyz5rvcxgLK0LLgumSoItHMvoLJfM5pA1jXWrDUgBbWTK3av0LQjMyKyrbWFtKa097WcuVg1vi4uMH26hLN5LvUww5QLsgNAsbdhN6e4Fpt8M1oxfbUDN6K43LVlu8swy7PYKEswfi2puHoxYbVfrAcxUayZMoc3cTA3sVcwqzQIsSAwVjD8s/SqgTUitH80i7f1MOow7DA4KhElSLKuMlm1IawVnwEwdjP0tFo1h7A/uGYvbLZDvlm3pDWNLeW4Br9yKsAx9CiTn322M7EKMPG5J7NiHro9FzFeoRyo7C1CJTqxDrFXOWoq0jUmMESwIbUgra2jNDTHqr+uwKpNJjaxVDOtLy03ZDK0sOIxnDXPKJo1zjJssdgwZTPLsJgw2hzsNTM0KDG2Mxiw7rVhM4auAi72MvO3yzYGrQc1DLM4KogwJjGAHt0zyjIursW5lqzuNQw03LXQMWYw0bMgrzazXaUAMNMgeR3YF1gyF6musT4xpzTbM4A08DMBNUyv4ygIIo02yjQMNKupkC2NMy4yTq9zHB4z3DKQNQkr37D0rdY3FbaMuEqqQzgJJ226zC2usOIpaKhUqSu34C9hLxOx9LGmtgpFYLAOub+0xbKgM1muoZw7PTi0Y7wzKrIzmrensbkx9i9SMO021aw3LxE4NC+utsm9JjR6Oq8vxDYDsAk3KCr2tpylozZRuVi5ZaUbMcgx2rK5Jx+0QLqssCugxrXhtpM/msDIOHylMzExMKIoP6bFN9G0XzSdMdCptK4AsI4h96dKrDa1jjAlJPUvD7CcuOE4eDQ+Okw9u7Tcseg43Sy9NDUkqzlXvPQxt7DUsH+oAbAKIAS3J64ErPoxyDd0MAI1CrVlPLu1vim9u/m4czBzNac0NDfbNJgr3iyJMT+tFTTdsW+1aKrqrFqkaLTJtqYy3jkRszy4kBzwK/u4uq4ZtU04ozj8NIGrnC49tpgxyjOSNVG4zDMfKXmtWzTQKcU86r1StXo9OrbGoF42N61jvhs7iTw8vBmwzrRROIAzvj1KMq68f7V2sqSvzzkLM3BA37yzuka6DrGus+w6WKTAut+01DwRPOqvHrFtveitvDhwOea8CK4ItLMwjj8psSm3RjoFvuaoczVjN0O5WLK9PHstBD8Os3Wwjy4auKq0LTgHL2+p+jUls20xWD0FrEEx6K/6vUa0HrQfqW+3BbINuRW2b7hjOFe5cDVZuHcmwjjxszW1HrMVseipkjYiskMyDDNrODmyNC9Mt1O7zTKorxexEzwaNEYtnayOrAknYjAQNe85qawyLWK21C77LuWxFTUMMoK1iyqxJpss6inLr3M3wbSGPCispK2PNA8dJDA/tm+vNibMJ8ufWi67rrkyUbG1LVY8HKwOpB21u64WoZ+jRiZyQEKquKyssjUltzYxJJ6wCbadLFapJyIiKPy2XCqxJP+k2hGaMWMlBCDEsnKrxCy1NX4lASVhrOwnxi9Lsd0t5DNHKqIvyrNMswguM7dGLbIxnq5WKwgqF65RMSS0VTXXJi+pj6rGsdIvlx+zN2mwRbHwrCcsS7blKKk2EbKYKscc9y8BKSqxgy8GsAg7JTWkvxgmFCr/tA+cLyqysAA41D8vsqYyijcntOkuezRPLaywDCcMMY4zBKSkOq2yR7oBQDGwV7dUOeqoDqMyKeY7T79ZMDa7zDLUMx2vYDvCIH60nSKBLhO15rAWM8G4U7gqPF2zE7OxtTiuCzonMXkpqrlDqFqx1rYINHmwDDExnFs3k7HEMgS8qLFzuuU5ADa/vqa4HS08vC8sfDoqtwWuFj5Tsnaf0LQ3GWGxxTd5ONWzcBJ6Jwu3PLQJNGWuiDZLOe2ozK27sLAsJjpiMCKvAbiipTW0YS7Cnvu5Wj8ws0K4uy74KUGhurCJti859CZ2MJIsnq3HNTasIC1BtCmyOzHqJDskiLCpKiw737xItF4/Uq5psyO4CatkM1ys8Te9MhEshLRHt4YsQTT4Mi+ta7VdKfWpqrTZNDC+5SoZNi++mDE8OYypyC/PNAO3ZiqcsaqYVDJkJJ0mZrSCsWc4gDMWJSQwSjlCsGuwq7jetPS2PKRkKVg2tLZkOrUvIDhlQFC3CLyUNeMfW6C8raY5trlkqIS+dbWltt06LrC5Nxk41inIMF61nbp3tlI4eDmhwC42ZTU8l5QxDDCgM4O2QDopq8oyy6yfLHewZazctkYpTa3mLqQ2gbOlNSY2/bpPNT2xBTGyqr2jt680Miu4OyFaraUy85y1HYEVsij/HdGa85IynfIWZxnXnYCrUKefG6CXFZAIrjegOpuYND4cCZNSpVCg2Z/KHBkd+BuzpKKhqxinClwomCGynqe1myfJJIsY5yZPJdGkHpkUuBab7KBVJeYUt55YkbUisS5lEgcZxARFmSGjKhkkFbWxLhZkEbySVaWLKyybyBkqNNwYnpUml7cV"),t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return{buffer:t.buffer}}catch(e){return{err:new pt("Model",vt.ModelInitFailed,"Failed to read weights binary string: "+((null==e?void 0:e.message)||"unknown"),!0)}}};function qt(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Qt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Qt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Yt=function(){function e(e,t,n){this.config=e,this.gpuContext=t,this.onError=n,this.entry=void 0,this.exit=void 0,this.hidden=[],this.timingInfoEntry=void 0,this.timingInfoExit=void 0,this.timingQueryEntry=void 0,this.timingQueryExit=void 0,this.weightsMap=void 0,this.weightsBinary=void 0,this.width=0,this.height=0,this.frameNum=0,this.initialized=!1,this.initializing=!1,this.MIN_AREA=void 0,this.MAX_AREA=void 0,this.SCALE_FACTOR=void 0,this.MIN_AREA=this.config.inputResolutionAreaBand[0],this.MAX_AREA=this.config.inputResolutionAreaBand[1],this.SCALE_FACTOR=this.config.scaleFactor,y.info("[ModelIVSEN]: Config",this.config)}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){var t,n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y.info("[ModelIVSEN]: Initializing"),this.initialized=!1,this.initializing=!1,this.entry=void 0,this.exit=void 0,this.width=0,this.height=0,this.frameNum=0,e.prev=8,this.weightsMap=jt,t=zt(),n=t.buffer,!(r=t.err)){e.next=14;break}return y.error("Model init failed",r),e.abrupt("return",r);case 14:this.weightsBinary=n,e.next=21;break;case 17:return e.prev=17,e.t0=e.catch(8),y.error("Model init failed",e.t0),e.abrupt("return",new pt("Model",vt.ModelInitFailed,"Failed to init the model: "+((null==e.t0?void 0:e.t0.message)||"unknown"),!0));case 21:return y.info("[ModelIVSEN]: Init complete"),e.abrupt("return",void 0);case 23:case"end":return e.stop()}}),e,this,[[8,17]])})));return function(){return e.apply(this,arguments)}}(),t.infer=function(){var e=f()(p().mark((function e(t){var n,r,i,o,a,s,u,c,d,l,f,h,v,m,g,E,S,b,T,_,C=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.initializing){e.next=2;break}return e.abrupt("return",void 0);case 2:if(n=t instanceof VideoFrame?t.displayWidth:t.width,r=t instanceof VideoFrame?t.displayHeight:t.height,!((i=n*r)<this.MIN_AREA||i>this.MAX_AREA)){e.next=9;break}return this.initialized=!1,this.initializing=!1,e.abrupt("return");case 9:if(n===this.width&&r===this.height||(this.initialized=!1),this.initialized){e.next=14;break}return e.next=13,this.reinit(n,r);case 13:return e.abrupt("return",void 0);case 14:for(performance.now(),this.gpuContext.device.pushErrorScope("validation"),o=this.gpuContext.device.createCommandEncoder(),this.entry&&(this.entry.setInputs(t),this.entry.createFinalizedPass(this.gpuContext,o,this.timingQueryEntry),this.timingInfoEntry&&this.timingQueryEntry&&o.resolveQuerySet(this.timingQueryEntry,0,2,this.timingInfoEntry.deviceBuffer,0)),a=qt(this.hidden);!(s=a()).done;)(u=s.value).layer&&u.layer.createFinalizedPass(this.gpuContext,o,u.timingQuery),u.timingQuery&&u.timingInfo&&o.resolveQuerySet(u.timingQuery,0,2,u.timingInfo.deviceBuffer,0);return this.exit&&(this.exit.setLowResTexture(t),this.exit.createFinalizedPass(this.gpuContext,o,this.timingQueryExit),this.timingInfoExit&&this.timingQueryExit&&o.resolveQuerySet(this.timingQueryExit,0,2,this.timingInfoExit.deviceBuffer,0)),this.gpuContext.queue.submit([o.finish()]),this.frameNum++,this.frameNum,e.next=25,this.gpuContext.queue.onSubmittedWorkDone();case 25:if(!this.timingInfoEntry){e.next=35;break}return e.next=28,this.timingInfoEntry.copyToHost(this.gpuContext.device);case 28:if(c=e.sent,d=c.err,l=c.buffer,!d){e.next=34;break}return this.onError(d),e.abrupt("return");case 34:y.debug("[ModelIVSEN]: entry timing="+Zt(l));case 35:f=qt(this.hidden);case 36:if((h=f()).done){e.next=50;break}if(!(v=h.value).timingInfo){e.next=48;break}return e.next=41,v.timingInfo.copyToHost(this.gpuContext.device);case 41:if(m=e.sent,g=m.err,E=m.buffer,!g){e.next=47;break}return this.onError(g),e.abrupt("return");case 47:y.debug("[ModelIVSEN]: hidden["+v.idx+"] timing="+Zt(E));case 48:e.next=36;break;case 50:if(!this.timingInfoExit){e.next=60;break}return e.next=53,this.timingInfoExit.copyToHost(this.gpuContext.device);case 53:if(S=e.sent,b=S.err,T=S.buffer,!b){e.next=59;break}return this.onError(b),e.abrupt("return");case 59:y.debug("[ModelIVSEN]: exit timing="+Zt(T));case 60:if(this.gpuContext.device.popErrorScope().then((function(e){var t;e&&C.onError(new pt("ModelIVSEN",vt.InferenceFailed,null!=(t=null==e?void 0:e.message)?t:"Unknown error",!0))})).catch((function(e){var t;C.onError(new pt("ModelIVSEN",vt.InferenceFailed,null!=(t=null==e?void 0:e.message)?t:"Unknown error",!0))})),this.exit){e.next=64;break}return y.warn(["ModelIVSEN: Exit layer does not exist, cant return texture"]),e.abrupt("return",void 0);case 64:return e.next=66,this.exit.getOutputs();case 66:if((_=e.sent)instanceof At){e.next=71;break}return this.initialized=!1,y.warn(["ModelIVSEN: Exit layer did not return a texture"]),e.abrupt("return",void 0);case 71:return e.abrupt("return",_.deviceTexture);case 72:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.reinit=function(){var e=f()(p().mark((function e(t,n){var r,i,o,a,s,u,c,d,l,f,h,v,m,g,y,E,S;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.weightsBinary,i=this.weightsMap,r&&i){e.next=4;break}return e.abrupt("return",new pt("Model",vt.ModelInitFailed,"Model was not initialized before infer was called",!0));case 4:return this.initializing=!0,this.cleanup(),e.next=8,this.configureEntrypoint(t,n,this.SCALE_FACTOR,1,16,r,i);case 8:if(o=e.sent,a=o.err,s=o.entry,!a&&s){e.next=14;break}return this.handleError(a||new pt("Model",vt.PipelineCreationFailed,"Failed to create entry layer",!0)),e.abrupt("return");case 14:this.entry=s,this.hidden=[],u=0;case 17:if(!(u<4)){e.next=42;break}if(c=void 0,d=8,0!==u){e.next=27;break}return e.next=23,this.entry.getOutputs();case 23:c=e.sent,d=16,e.next=30;break;case 27:return e.next=29,this.hidden[u-1].layer.getOutputs();case 29:c=e.sent;case 30:return e.next=32,this.configureMid(Math.ceil(t*this.SCALE_FACTOR),Math.ceil(n*this.SCALE_FACTOR),d,8,r,i,c,2*u);case 32:if(l=e.sent,f=l.err,h=l.layer){e.next=38;break}return this.handleError(f||new pt("Model",vt.PipelineCreationFailed,"Failed to create midlayer",!0)),e.abrupt("return");case 38:this.hidden.push({layer:h,timingInfo:null,timingQuery:null,idx:u});case 39:u++,e.next=17;break;case 42:return e.next=44,this.configureExit(Math.ceil(t*this.SCALE_FACTOR),Math.ceil(n*this.SCALE_FACTOR),8,1,r,i);case 44:if(v=e.sent,m=v.err,g=v.exit,!m&&g){e.next=50;break}return this.handleError(m||new pt("Model",vt.PipelineCreationFailed,"Failed to create exit layer",!0)),e.abrupt("return");case 50:if(this.exit=g,this.gpuContext.timingInfoEnabled){for(this.timingInfoEntry=new Pt(this.gpuContext,16,It.TimingQuery),y=qt(this.hidden);!(E=y()).done;)(S=E.value).timingInfo=new Pt(this.gpuContext,16,It.TimingQuery),S.timingQuery=this.gpuContext.device.createQuerySet({type:"timestamp",count:2});this.timingInfoExit=new Pt(this.gpuContext,16,It.TimingQuery),this.timingQueryEntry=this.gpuContext.device.createQuerySet({type:"timestamp",count:2}),this.timingQueryExit=this.gpuContext.device.createQuerySet({type:"timestamp",count:2})}this.width=t,this.height=n,this.initializing=!1,this.initialized=!0;case 56:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),t.cleanup=function(){var e,t,n,r;null==(e=this.exit)||e.close();for(var i,o=qt(this.hidden);!(i=o()).done;)i.value.layer.close();null==(t=this.entry)||t.close(),null==(n=this.timingInfoEntry)||n.close(),null==(r=this.timingInfoExit)||r.close()},t.configureEntrypoint=function(){var e=f()(p().mark((function e(t,n,r,i,o,a,s){var u,c,d,l,f,h,v;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=new Lt(i,o,3,r,1,!0,!1),c=s["init_feat.0"].weight,d=c.bits/8,l=a.slice(c.offset,c.offset+c.count*d),f={inputShape:[n,t,i],weightShape:[3,3,o*i],bias:!1,dataType:4===d?Dt.F32:Dt.F16,expectedInputType:wt.External,activation:new Kt(.1),loadWidthBytes:this.config.loadWidthBytes},h=new Pt(this.gpuContext,9*i*o*d,It.HostToDevice),e.next=8,h.copyToDevice(this.gpuContext,l);case 8:return u.setWeights(h),e.next=11,u.configure(this.gpuContext,f);case 11:if(!(v=e.sent)){e.next=14;break}return e.abrupt("return",{err:v});case 14:return e.abrupt("return",{entry:u});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,s){return e.apply(this,arguments)}}(),t.configureMid=function(){var e=f()(p().mark((function e(t,n,r,i,o,a,s,u){var c,d,l,f,h,v,m;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=a["bottleneck."+u].weight,d=c.bits/8,l=o.slice(c.offset,c.offset+c.count*d),f=4===d?new Mt(r,i,!1):new Ht(r,i,!1),h={inputShape:[n,t,r],weightShape:[3,3,i*r],bias:!1,dataType:4===d?Dt.F32:Dt.F16,expectedInputType:wt.Buffer,activation:new Kt(.1),loadWidthBytes:this.config.loadWidthBytes},v=new Pt(this.gpuContext,9*r*i*d,It.HostToDevice),e.next=8,v.copyToDevice(this.gpuContext,l);case 8:return f.setInputs(s),f.setWeights(v),e.next=12,f.configure(this.gpuContext,h);case 12:if(!(m=e.sent)){e.next=15;break}return e.abrupt("return",{err:m});case 15:return e.abrupt("return",{layer:f});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a,s,u){return e.apply(this,arguments)}}(),t.configureExit=function(){var e=f()(p().mark((function e(t,n,r,i,o,a){var s,u,c,d,l,f,h,v=this;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new Wt(r,i,3,1,!1),u=a.reconstruct.weight,c=u.bits/8,d=o.slice(u.offset,u.offset+u.count*c),l={inputShape:[n,t,r],weightShape:[3,3,i*r],bias:!1,dataType:4===c?Dt.F32:Dt.F16,expectedInputType:wt.External,activation:new Kt(.1),loadWidthBytes:this.config.loadWidthBytes},f=new Pt(this.gpuContext,9*r*i*c,It.HostToDevice),e.next=8,f.copyToDevice(this.gpuContext,d);case 8:return this.hidden[this.hidden.length-1].layer.getOutputs().then((function(e){return s.setInputs(e)})).catch((function(e){var t;v.onError(new pt("Model",vt.BadParameters,null!=(t=null==e?void 0:e.message)?t:"Failed to access hidden layer",!0))})),s.setWeights(f),e.next=12,s.configure(this.gpuContext,l);case 12:if(!(h=e.sent)){e.next=15;break}return e.abrupt("return",{err:h});case 15:return e.abrupt("return",{exit:s});case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o,a){return e.apply(this,arguments)}}(),t.handleError=function(e){this.initializing=!1,this.initialized=!1,this.onError(e)},e}(),Zt=function(e){if(!e)return y.warn("[ModelIVSEN]: timingInfo buffer is undefined"),0;var t=0;try{var n=new BigInt64Array(e);t=Number(n[1]-n[0])/1e9}catch(e){y.warn("[ModelIVSEN': Failed to get seconds from timingInfo")}return t},Jt=function(e){function t(t,n,r){var i;return(i=e.call(this,"SuperResolutionTransformer")||this).onError=r,i.model=void 0,i.model=new Yt(t,n,r),i}re()(t,e);var n=t.prototype;return n.init=function(){var e=f()(p().mark((function e(){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.model.init();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),n.transformFn=function(){var e=f()(p().mark((function e(t){return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.model.infer(t);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),this.onError(new pt("SuperResolutionTransformer",vt.InferenceFailed,"Unhandled exception "+(null==e.t0?void 0:e.t0.message),!0)),e.abrupt("return",void 0);case 10:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),t}(bt),Xt=function(){function e(e,t,n){this.windowContext=e,this.listeners=n,this.canvas=void 0,this.sourceVideo=void 0,this.pipeline=void 0,this.frameStream=void 0,this.gpuContext=void 0,this.performanceMonitor=void 0,this.config=void 0,this.config=ut({gpu:{timingInfoEnabled:!1,requiredFeatures:["shader-f16"]},pipeline:{minimumFramerate:60,includeReceiveDelay:!0},capture:{maxQueueSize:2},monitor:{enable:!0,monitorIntervalMs:5e3,frameRateDiffPercentage:.25,frameCountDiffPercentage:.25},model:{enable:!1,inputResolutionAreaBand:[0,921600],scaleFactor:1.5,loadWidthBytes:8}},t),y.info("[VideoTransformer]: Parsed config",this.config),this.canvas=e.document.createElement("canvas")}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){var t,n,r,i,o,a,s,u,c,d,l,f,h;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=performance.now(),y.log("[VideoTransformer]: Init start"),n=this.onErrorInternal.bind(this),e.prev=3,r=this.gpuContext=new Et(this.windowContext,this.config.gpu),e.next=7,r.init();case 7:if(!(i=e.sent)){e.next=10;break}return e.abrupt("return",{err:i});case 10:return o=new St(this.canvas,r,n),e.next=13,o.init();case 13:if(!(a=e.sent)){e.next=16;break}return e.abrupt("return",{err:a});case 16:if(s=new yt(this.config.capture,n),!(u=s.init())){e.next=20;break}return e.abrupt("return",{err:u});case 20:if(c=new gt(s.getStream(),o,n,this.config.pipeline),!this.config.model.enable){e.next=31;break}return l=new Jt(this.config.model,r,n),e.next=25,l.init();case 25:if(!(f=e.sent)){e.next=28;break}return e.abrupt("return",{err:f});case 28:d=l,e.next=32;break;case 31:d=new Tt;case 32:return e.next=34,c.init(d);case 34:if(!(h=e.sent)){e.next=37;break}return e.abrupt("return",{err:h});case 37:return this.performanceMonitor=new Ct(this.config.monitor,this.stats.bind(this),{performanceBreach:this.onPerformanceBreach.bind(this)}),this.frameStream=s,this.pipeline=c,y.log("[VideoTransformer]: Init complete in "+(performance.now()-t).toFixed(3)+"ms"),e.abrupt("return",{info:{timeMs:performance.now()-t,gpuProperties:r.properties()}});case 44:return e.prev=44,e.t0=e.catch(3),y.warn("[VideoTransformer]: Failed to init",e.t0),e.abrupt("return",{err:new pt("VideoTransformer",vt.Init,e.t0.message,!0)});case 48:case"end":return e.stop()}}),e,this,[[3,44]])})));return function(){return e.apply(this,arguments)}}(),t.start=function(e){var t,n;this.ready()?this.active()?y.warn("[VideoTransformer]: Start called on active instance"):(this.sourceVideo=e,null==(t=this.frameStream)||t.start(e),null==(n=this.performanceMonitor)||n.start(),y.log("[VideoTransformer]: Pipeline started")):y.log("[VideoTransformer]: Start called before init")},t.stop=function(){var e,t;y.log("[VideoTransformer]: Stopping render pipeline"),null==(e=this.frameStream)||e.stop(),null==(t=this.performanceMonitor)||t.stop()},t.active=function(){var e,t;return null!=(e=null==(t=this.frameStream)?void 0:t.active)&&e},t.stats=function(){var e,t,n,r,i,o;if(!this.pipeline||!this.frameStream)return{timestamp:performance.now(),frames:{source:0,source_presented:0,captured:0,received:0,transformed:0,rendered:0,missed:0,blocked:0,skipped:0,failed:0,overBudget:0},timings:{captureDelay:0,receiveDelay:0,transformTime:0,renderTime:0,endToEnd:0},resolution:{sourceHeight:0,sourceWidth:0,renderHeight:0,renderWidth:0}};var a=this.pipeline.stats(),s=a.received,u=a.transformTime,c=a.skipped,d=a.transformed,l=a.failed,f=a.overBudget,h=a.rendered,p=a.renderTime,v=a.receiveDelay,m=a.endToEnd,g=this.frameStream.stats(),y=g.captured,E=g.blocked,S=g.missed,b=g.rVFCDelay,T=null!=(e=null==(t=this.sourceVideo)?void 0:t.getVideoPlaybackQuality())?e:{totalVideoFrames:0,droppedVideoFrames:0},_=T.totalVideoFrames,C=T.droppedVideoFrames;return{timestamp:performance.now(),frames:{source:_,source_presented:_-C,captured:y,received:s,transformed:d,rendered:h,missed:S,blocked:E,skipped:c,failed:l,overBudget:f},timings:{captureDelay:b,receiveDelay:v,transformTime:u,renderTime:p,endToEnd:m},resolution:{sourceHeight:null!=(n=null==(r=this.sourceVideo)?void 0:r.videoHeight)?n:0,sourceWidth:null!=(i=null==(o=this.sourceVideo)?void 0:o.videoWidth)?i:0,renderHeight:this.canvas.height,renderWidth:this.canvas.width}}},t.renderSurface=function(){return this.canvas},t.gpuProperties=function(){var e;return null==(e=this.gpuContext)?void 0:e.properties()},t.reset=function(){var e,t,n;y.info("[VideoTransformer]: Resetting instance"),null==(e=this.frameStream)||e.resetStats(),null==(t=this.pipeline)||t.resetStats(),null!=(n=this.performanceMonitor)&&n.monitoring()&&(this.performanceMonitor.stop(),this.performanceMonitor.start())},t.destroy=function(){y.info("[VideoTransformer]: Destroying instance"),this.stop(),this.gpuContext=void 0,this.frameStream=void 0,this.pipeline=void 0,this.performanceMonitor=void 0},t.ready=function(){return!!(this.frameStream&&this.pipeline&&this.performanceMonitor&&this.gpuContext)},t.onPerformanceBreach=function(e){this.onErrorInternal(new pt("PerformanceMonitor",e.code,e.reason,e.fatal))},t.onErrorInternal=function(e){this.stop(),this.reset(),this.listeners.error(e)},e}(),$t=function(e){return e.setAttribute("playsinline",""),{element:function(){return e},displayDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},videoDimensions:function(){return{width:e.videoWidth,height:e.videoHeight}},stats:function(){return{timestamp:performance.now(),droppedFrames:(0,ue.ld)(e),decodedFrames:(0,ue.xB)(e)}},visible:function(){return(0,Ue.j)(e)}}},en=["nvidia"],tn=["ampere","lovelace"],nn=function(){function e(e,t){var n;this.initialConfig=e,this.listeners=t,this.videoTransformer=void 0,this.surface=void 0,this.statusInterval=void 0,this.scoutModeTimeout=void 0,this.config=void 0,this.disabled=!1,this.scouted=!1,this.resumeOnVisible=!1;var r={statusIntervalMs:5e3,scoutPeriodMs:5500,logLevel:v.$.WARN,gpuAllowlist:{vendors:[],architectures:[]},transformer:{}};this.config=ut(r,e.module);var i=null==(n=this.config.transformer.monitor)?void 0:n.monitorIntervalMs;void 0===e.module.scoutPeriodMs&&i&&(this.config.scoutPeriodMs=i+500),y.setConfig({enabled:!0,level:this.config.logLevel})}var t=e.prototype;return t.init=function(){var e=f()(p().mark((function e(){var t,n,r;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.videoTransformer){e.next=3;break}return y.debug("[VideoTransformerModule]: Init called on setup instance"),e.abrupt("return",void 0);case 3:if(!this.disabled){e.next=6;break}return y.warn("[VideoTransformerModule]: Init called, but the module is disabled"),e.abrupt("return",void 0);case 6:return e.prev=6,t=new Xt(window,this.config.transformer,{error:this.onTransformerError.bind(this)}),e.next=10,t.init();case 10:if(!(n=e.sent).err){e.next=14;break}return this.onTransformerError(n.err),e.abrupt("return",void 0);case 14:if(this.videoTransformer=t,r=this.gpuAllowed(),this.logInitEvent(n,r),r){e.next=20;break}return this.disable(),e.abrupt("return",void 0);case 20:return this.surface=this.createWebGpuCanvasSurface(t.renderSurface()),e.abrupt("return",this.surface);case 24:return e.prev=24,e.t0=e.catch(6),y.error("[VideoTransformerModule]: Unhandled error encountered during init",e.t0),this.onTransformerError(new pt("VideoTransformerModule",vt.Init,"Unhandled error during init: "+((null==e.t0?void 0:e.t0.message)||"unknown"),!0)),e.abrupt("return",void 0);case 29:case"end":return e.stop()}}),e,this,[[6,24]])})));return function(){return e.apply(this,arguments)}}(),t.start=function(e){if(this.disabled)y.log("[VideoTransformerModule]: Video transformer not starting: module is disabled");else if(this.videoTransformer)if(this.videoTransformer.active())y.log("[VideoTransformerModule]: Start called, but transformer is already active");else{if(an())return y.log("[VideoTransformerModule]: Start called, but page is hidden. Resuming on visible"),void(this.resumeOnVisible=!0);y.log("[VideoTransformerModule]: Starting"),this.videoTransformer.start(e),this.videoTransformer.active()?(this.startLogStatusEvents(this.config.statusIntervalMs),this.scout(this.config.scoutPeriodMs)):(y.log("[VideoTransformerModule]: Failed to start"),this.onTransformerError(new pt("VideoTransformerModule",vt.BadParameters,"Transformer failed to start",!0)))}else y.log("[VideoTransformerModule]: Video transformer not starting: start called before transformer init")},t.stats=function(){var e,t,n=0,r=0,i=performance.now(),o=null==(e=this.videoTransformer)?void 0:e.stats().frames;return o?(n=null!=(t=o.rendered)?t:0,{timestamp:i,droppedFrames:r=o.missed+o.skipped+o.failed,decodedFrames:n}):{timestamp:i,decodedFrames:n,droppedFrames:r}},t.swapVideoSource=function(e){var t;null!=(t=this.videoTransformer)&&t.active()&&(this.videoTransformer.stop(),this.videoTransformer.start(e))},t.stop=function(){var e;null==(e=this.videoTransformer)||e.stop(),this.resumeOnVisible=!1,clearInterval(this.statusInterval),clearInterval(this.scoutModeTimeout)},t.reset=function(){var e;null==(e=this.videoTransformer)||e.reset()},t.destroy=function(){this.stop(),this.videoTransformer=void 0,this.listeners.inactive()},t.disable=function(){this.disabled=!0,this.destroy()},t.onPageVisibilityChanged=function(e,t){if(e){var n,r,i=null!=(n=null==(r=this.videoTransformer)?void 0:r.active())&&n;this.stop(),y.log("[VideoTransformerModule]: Page hidden. Was active: "+i),this.resumeOnVisible=i}else y.log("[VideoTransformerModule]: Page visible, resumeOnVisible: "+this.resumeOnVisible),this.resumeOnVisible&&this.start(t),this.resumeOnVisible=!1},t.scout=function(e){var t=this;window.clearTimeout(this.scoutModeTimeout),this.scouted?y.log("[VideoTransformerModule]: Already scouted"):(y.log("[VideoTransformerModule]: Starting "+e+"ms scout mode before ready"),this.scoutModeTimeout=window.setTimeout((function(){var e;t.scouted=!0,null!=(e=t.videoTransformer)&&e.active()?(y.log("[VideoTransformerModule]: Scout mode complete"),t.listeners.active()):y.log("[VideoTransformerModule]: Scout mode complete, but video transformer is no longer active")}),e))},t.gpuAllowed=function(){var e,t=null==(e=this.videoTransformer)?void 0:e.gpuProperties();if(!t)return y.info("[VideoTransformerModule]: GPU not allowed: gpu properties not found"),!1;var n,r,i,o,a,s=(n=this.config.gpuAllowlist,o=[].concat(en,null!=(r=null==n?void 0:n.vendors)?r:[]),a=[].concat(tn,null!=(i=null==n?void 0:n.architectures)?i:[]),{allowed:function(e){var t={allowed:!0,reason:""};return o.includes(e.vendor)||o.includes("*")||(t={allowed:!1,reason:"GPU Vendor not allowed. Have: "+e.vendor+" Need: "+o.join(",")}),a.includes(e.architecture)||a.includes("*")||(t={allowed:!1,reason:"GPU Architecture not allowed. Have: "+e.architecture+" Need: "+a.join(",")}),t}}),u=s.allowed(t);return!!u.allowed||(y.info("[VideoTransformerModule]: GPU not allowed: "+u.reason),!1)},t.createWebGpuCanvasSurface=function(e){var t=function(e){return e.className="ivs-player-canvas-surface",e.style.objectFit="contain",e.style.overflowClipMargin="content-box",e.style.overflow="clip",e.style.imageRendering="auto",{element:function(){return e},displayDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},videoDimensions:function(){return{width:e.clientWidth,height:e.clientHeight}},stats:function(){return{timestamp:performance.now(),droppedFrames:0,decodedFrames:0}},visible:function(){return(0,Ue.j)(e)}}}(e);return t.stats=this.stats.bind(this),t},t.startLogStatusEvents=function(e){var t,n,r=this,i=null!=(t=null==(n=this.videoTransformer)?void 0:n.stats())?t:on();clearInterval(this.statusInterval),this.statusInterval=window.setInterval((function(){var t,n;if(r.videoTransformer){var a=r.videoTransformer.stats(),s=rn(i,a),u=s.frames,c=s.timings,d=s.timestamp,l=s.resolution,f=0,h=0,p=0,v=0,m=(a.timestamp-i.timestamp)/1e3;m>0&&(f=s.frames.source/m,h=s.frames.source_presented/m,p=s.frames.captured/m,v=s.frames.rendered/m),r.printStats(s,f,h,p,v);var g=o()({status_timestamp:d,status_interval:e,surface_visible:null!=(t=null==(n=r.surface)?void 0:n.visible())&&t,source_height:l.sourceHeight,source_width:l.sourceWidth,render_height:l.renderHeight,render_width:l.renderWidth,frames_source:u.source,frames_source_presented:u.source_presented,frames_captured:u.captured,frames_missed:u.missed,frames_blocked:u.blocked,frames_skipped:u.skipped,frames_transformed:u.transformed,frames_rendered:u.rendered,frames_overbudget:u.overBudget,frames_failed:u.failed,framerate_source:f,framerate_source_presented:h,framerate_capture:p,framerate_render:v,time_capture_delay:c.captureDelay,time_receive_delay:c.receiveDelay,time_transform:c.transformTime,time_render:c.renderTime,time_end_to_end:c.endToEnd},r.gpuAnalyticsProperties());i=a,r.listeners.analytics({name:"onGpuStatus",data:g})}else window.clearInterval(r.statusInterval)}),e)},t.logInitEvent=function(e,t){if(e.info){var n=e.info,r=n.timeMs,i=n.gpuProperties,a=o()({gpu_time_init:r,gpu_adapter_features:i.adapterFeatures,gpu_device_features:i.deviceFeatures,gpu_wgsl_features:i.wgslFeatures,gpu_transformer_config:JSON.stringify(this.initialConfig),gpu_allowed:t},this.gpuAnalyticsProperties());this.listeners.analytics({name:"onGpuInit",data:a})}},t.onTransformerError=function(e){var t,n;this.stop();var r=o()({code:e.code,source:e.source,message:e.message,fatal:!0,surface_visible:null!=(t=null==(n=this.surface)?void 0:n.visible())&&t},this.gpuAnalyticsProperties());y.warn("[VideoTransformerModule]: Error, disabling module",e),this.disabled=!0,this.listeners.error(r),this.listeners.analytics({name:"onGpuError",data:r})},t.gpuAnalyticsProperties=function(){var e,t,n,r,i,o=null==(e=this.videoTransformer)?void 0:e.gpuProperties();return{gpu_architecture:null!=(t=null==o?void 0:o.architecture)?t:"",gpu_description:null!=(n=null==o?void 0:o.description)?n:"",gpu_device:null!=(r=null==o?void 0:o.device)?r:"",gpu_vendor:null!=(i=null==o?void 0:o.vendor)?i:""}},t.printStats=function(e,t,n,r,i){var o,a,s=e.frames,u=s.source,c=s.source_presented,d=s.captured,l=s.received,f=s.transformed,h=s.rendered,p=s.missed,v=s.blocked,m=s.skipped,g=s.failed,E=s.overBudget,S=e.timings,b=S.captureDelay,T=S.receiveDelay,_=S.transformTime/f,C=S.renderTime/h,w=T/d,k=S.endToEnd/h,I=b/d,P="Stats:\nStats Interval:                        "+this.config.statusIntervalMs+"ms\nDocument visible:                      "+!document.hidden+"\nSurface visible:                       "+(null!=(o=null==(a=this.surface)?void 0:a.visible())&&o)+"\nSource Resolution                      "+e.resolution.sourceWidth+"x"+e.resolution.sourceHeight+"\nRender Resolution                      "+e.resolution.renderWidth+"x"+e.resolution.renderHeight+"\nSource Total Framerate:                "+t.toFixed(1)+"\nSource Presented Framerate:            "+n.toFixed(1)+"\nCapture Framerate:                     "+r.toFixed(1)+"\nRender Framerate:                      "+i.toFixed(1)+"\nSource Total frames:                   "+u+"\nSource Presented frames:               "+c+"\nSource Dropped frames:                 "+(u-c)+"\nCaptured frames:                       "+d+"\nReceived frames:                       "+l+"\nTransformed frames:                    "+f+"\nRendered frames:                       "+h+"\nMissed frames:                         "+p+"\nBlocked frames:                        "+v+"\nSkipped frames:                        "+m+"\nOverbudget frames:                     "+E+"\nFailed frames:                         "+g+"\nAverage rVFC capture delay:            "+I.toFixed(3)+"ms\nAverage frame receive delay:           "+w.toFixed(3)+"ms\nAverage frame transform time:          "+_.toFixed(3)+"ms\nAverage frame render time:             "+C.toFixed(3)+"ms\nAverage frame end-to-end time:         "+k.toFixed(3)+"ms\n";y.log("[VideoTransformerModule]: "+P)},e}(),rn=function(e,t){var n={timestamp:t.timestamp,resolution:o()({},t.resolution),frames:{source:0,source_presented:0,captured:0,received:0,transformed:0,rendered:0,missed:0,blocked:0,skipped:0,failed:0,overBudget:0},timings:{captureDelay:0,receiveDelay:0,transformTime:0,renderTime:0,endToEnd:0}};return["frames","timings"].forEach((function(r){for(var i=0,o=Object.entries(t[r]);i<o.length;i++){var a=o[i],s=a[0],u=a[1];n[r][s]=u-e[r][s]}})),n},on=function(){return{timestamp:performance.now(),frames:{source:0,source_presented:0,captured:0,received:0,transformed:0,rendered:0,missed:0,blocked:0,skipped:0,failed:0,overBudget:0},timings:{captureDelay:0,receiveDelay:0,transformTime:0,renderTime:0,endToEnd:0},resolution:{sourceHeight:0,sourceWidth:0,renderHeight:0,renderWidth:0}}},an=function(){var e=(0,Ue.sQ)(document).hidden;return document[e]},sn=function(e,t){var n=e,r=t,i=0;return{update:function(e,t){t!==r&&(i=(e-n)/(t-r)*1e3,n=e,r=t)},framerate:function(){return i}}},un=function(e){return e.video="video",e.canvas="canvas",e.debug_both="debug_both",e}({}),cn=function(){function e(e){this.context=e,this.video=void 0,this.canvas=void 0,this.surfaceContainer=void 0,this.framerateTracker=void 0,this.surfaceContainer=e.createElement("div");var t=e.createElement("video");this.video=$t(t),this.moveVideoToRenderSurface();var n=this.video.stats();this.framerateTracker=sn(n.decodedFrames,n.timestamp)}var t=e.prototype;return t.setVideo=function(e){if(this.video.element()!==e){this.activeSurface()!==un.video&&this.hideSurface(e);var t=$t(e),n=t.stats();this.framerateTracker=sn(n.decodedFrames,n.timestamp),this.video=t}},t.moveVideoToRenderSurface=function(){this.replaceElement(un.video,this.video.element())},t.setCanvas=function(e){this.canvas!==e&&(this.activeSurface()!==un.canvas&&this.hideSurface(e.element()),this.replaceElement(un.canvas,e.element()),this.canvas=e)},t.setActiveSurface=function(e){if(e!==this.activeSurface())if(e===un.canvas){if(!this.canvas)return void console.warn("[RenderSurface]: Tried to set canvas surface to active, but the canvas surface is undefiend.");this.hideSurface(this.video.element()),this.showSurface(this.canvas.element())}else if(e===un.video){var t;this.hideSurface(null==(t=this.canvas)?void 0:t.element()),this.showSurface(this.video.element())}else if(e===un.debug_both){var n;this.showSurface(null==(n=this.canvas)?void 0:n.element()),this.showSurface(this.video.element())}},t.surface=function(){return this.surfaceContainer},t.videoElement=function(){return this.video.element()},t.displayDimensions=function(){return this.video.displayDimensions()},t.videoDimensions=function(){return this.video.videoDimensions()},t.stats=function(){var e=this.video.stats();return this.framerateTracker.update(e.decodedFrames,e.timestamp),e},t.framerate=function(){return this.framerateTracker.framerate()},t.activeSurface=function(){var e;return null!=(e=this.canvas)&&e.visible()?un.canvas:un.video},t.safeAppendSurface=function(e){try{this.surfaceContainer.appendChild(e)}catch(e){console.warn("[RenderSurface]: Failed to append surface to container",e)}},t.safeRemoveSurface=function(e){try{var t=this.surfaceContainer.querySelector(e);t&&this.surfaceContainer.removeChild(t)}catch(e){console.warn("[RenderSurface]: Failed to remove surface from container",e)}},t.replaceElement=function(e,t){this.safeRemoveSurface(e),this.safeAppendSurface(t)},t.hideSurface=function(e){e&&(e.style.visibility="hidden",e.style.position="absolute",e.style.inset="0")},t.showSurface=function(e){e&&(e.style.visibility="inherit",e.style.position="inherit",e.style.inset="inherit")},e}(),dn=function(){function e(){this.emitter=new ot.TypedEmitter({}),this.queue=new Array}e.getInstance=function(){return e.gInstance||(e.gInstance=new e),e.gInstance};var t=e.prototype;return t.registerMetricsCallback=function(e){this.emitter.on("newMetrics",e)},t.unregisterMetricsCallback=function(e){this.emitter.off("newMetrics",e)},t.enqueue=function(e){this.queue.push(e),this.emitter.emit("newMetrics")},t.dequeueAll=function(){var e=this.queue;return this.queue=new Array,e},e}();function ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}dn.gInstance=void 0;var fn=function(){function e(t,n){var i,s,u=this;this.worker=void 0,this.id=void 0,this.emitter=new be,this.seekTime=null,this.paused=!0,this.isLoaded=!1,this.autoPlayOptions=null,this.mediaSinkManager=void 0,this.experiments={},this.adjustments=void 0,this.enableRemoteSearch=void 0,this.isQualitySupported=void 0,this.onvisibilitychange=void 0,this.onmessage=function(e){return u.onWorkerMessage(e)},this.onOnline=function(){return u.postMessage("onOnline")},this.onOffline=function(){return u.postMessage("onOffline")},this.pauseHiddenSilentTab=void 0,this.state=void 0,this.workerMessageProcessors=[c],this.configManager=void 0,this.deviceConfigMetricsHelper=dn.getInstance(),this.deviceConfigEmitMetricsBound=this.emitDeviceConfigManagerMetrics.bind(this),this.daterangeTagAssembler=void 0,this.videoTransformerModule=void 0,this.renderSurface=new cn(document),this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,e.instanceCount+=1,this.worker=n,this.id=e.instanceId++,this.isQualitySupported=t.isQualitySupported||Ue.h3,this.onvisibilitychange=function(){return u.onVisibilityChange()},this.enableRemoteSearch=t.enableRemoteSearch||!1;var l,h=(0,r.cp)();if(this.pauseHiddenSilentTab=h.chrome&&63===h.major||h.opera,this.adjustments=(l=null!=(i=null==(s=t.webviewHost)?void 0:s.adjustments)?i:{},o()({},tt,l)),this.mediaSinkManager=new Je(this,this.enableRemoteSearch,this.adjustments,this.renderSurface.videoElement()),d.isSupported()){var v=new d;this.workerMessageProcessors.push(v.processor)}var m,g,b,T,_=(m={architecture:"",description:"",device:"",vendor:""},g=!1,b=null,{init:function(){return f()(p().mark((function e(){var t;return p().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g=!1,b=E.gpu_pending,e.prev=2,navigator.gpu){e.next=7;break}return y.warn(E.gpu_unavailable),b=E.gpu_unavailable,e.abrupt("return");case 7:return e.next=9,navigator.gpu.requestAdapter();case 9:if(t=e.sent){e.next=14;break}return y.warn(E.gpu_adapter_unavailable),b=E.gpu_adapter_unavailable,e.abrupt("return");case 14:if(t.info){e.next=18;break}return y.warn(E.gpu_adapterinfo_undefined),b=E.gpu_adapterinfo_undefined,e.abrupt("return");case 18:m=t.info,b=null,g=!0,e.next=27;break;case 23:e.prev=23,e.t0=e.catch(2),y.warn(E.gpu_error,e.t0),b=E.gpu_error+" "+((null==e.t0?void 0:e.t0.message)||"unknown");case 27:case"end":return e.stop()}}),e,null,[[2,23]])})))()},process:function(e){if(!e)return e;var t=e.type,n=e.arg,r=t===a.a.ANALYTICS_EVENT,i=n&&("video-play"===n.name||"minute-watched"===n.name);return r&&i?(n.properties.gpu_supported=g,n.properties.gpu_unsupported_reason=b,n.properties.gpu_architecture=m.architecture,n.properties.gpu_description=m.description,n.properties.gpu_device=m.device,n.properties.gpu_vendor=m.vendor,e):e}});_.init(),this.workerMessageProcessors.push(_.process.bind(_)),void 0!==t.serviceWorker&&("serviceWorker"in navigator||(Re.warn("Service workers are not supported."),0))&&(function(e){Me=Ne(e)}(t.serviceWorker),null==(T=xe())||T.registerAndActivate()),this.state={averageBitrate:0,bandwidthEstimate:0,looping:!1,autoQualityMode:!0,volume:1,liveLatency:0,liveLowLatencyEnabled:!0,liveLowLatency:!1,statistics:{}},this.resetState(),this.attachHandlers(),this.checkDebugCaptureEnabled();var C=[];(0,S.bz)()&&C.push("hevc"),(0,S.dq)()&&C.push("av01"),this.configManager=new ct({},this.onConfigChanged.bind(this)),this.onConfigChanged(),this.postMessage("create",[{mseSupported:(0,S.aP)(),keySystem:void 0!==t.keySystem?t.keySystem:N(h),browserContext:o()({},h,{webviewHost:t.webviewHost}),codecs:C,testOnly:t.testOnly,playerFramework:t.playerFramework,buildDistId:"npm"},this.configManager.getConfigSnapshot()]);var w=(0,Ue.sQ)(document).hidden;this.postMessage("setVisible",[!document[w]]),this.deviceConfigMetricsHelper.registerMetricsCallback(this.deviceConfigEmitMetricsBound),this.emitDeviceConfigManagerMetrics()}var t=e.prototype;return t.delete=function(){var t,n,r=this;null==(t=xe())||t.destroy();var i=(0,Ue.sQ)(document).visibilityChange;document.removeEventListener(i,this.onvisibilitychange),window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline),this.emitter.removeAllListeners(),this.emitter.on(et.DESTROY,(function(){r.mediaSinkManager.destroy(),r.emitter.removeAllListeners(),r.worker.removeEventListener("message",r.onmessage)})),this.configManager.delete(),null==(n=this.videoTransformerModule)||n.destroy(),this.videoTransformerModule=void 0,this.postMessage("delete"),e.instanceCount>0&&(e.instanceCount-=1),this.deviceConfigMetricsHelper.unregisterMetricsCallback(this.deviceConfigEmitMetricsBound)},t.attachHTMLVideoElement=function(e){var t,n;null==(t=this.mediaSinkManager)||t.destroy(),this.mediaSinkManager=new Je(this,this.enableRemoteSearch,this.adjustments,e),this.processVideoElementAttributes(e),this.renderSurface.setVideo(e),null==(n=this.videoTransformerModule)||n.swapVideoSource(e),this.configManager.getConfigSnapshot().features.gpu.flags.enable_render_surface&&this.renderSurface.moveVideoToRenderSurface()},t.getHTMLVideoElement=function(){return this.renderSurface.videoElement()},t.getVideoRenderSurface=function(){if(this.configManager.getConfigSnapshot().features.gpu.flags.enable_render_surface)return this.renderSurface.surface()},t.load=function(t,n){var r,i=this;void 0===n&&(n=""),null==(r=xe())||r.configure(),this.trySetupVideoTransformer(),this.postMessage("load",[t,n]),this.autoPlayOptions&&this.postMessage("playIntent"),this.configManager.initDeviceConfigManager({canRefreshNow:e.canDeviceConfigManagerRefreshNowCallback,emitMetrics:e.emitDeviceConfigManagerMetricsCallback,emitAnalytics:function(e,t){i.sendConfigManagerDeviceConfigAnalytics(e,t)}});var o=this.getDeviceConfigPropertyHolder();o&&o.getJsonValue("sr_model_f16")},t.play=function(){this.postMessage("playIntent"),this.mediaSinkManager.captureGesture(),this.paused=!1,this.attemptPlay()},t.setAutoplay=function(e){this.autoPlayOptions=e?{attemptMutedRetry:!0}:null},t.setAutoPlayOptions=function(e){this.autoPlayOptions=e},t.getExperiments=function(){return this.experiments},t.setExperiment=function(e,t){this.setExperimentData({id:e,assignment:t,version:0,type:""})},t.setExperimentData=function(e){this.configManager.setExperiment(e.id,e.assignment),this.postMessage("setExperiment",[e])},t.pause=function(){this.paused=!0,this.postMessage("pause")},t.isPaused=function(){return this.paused},t.seekTo=function(e){this.seekTime=e,this.postMessage("seekTo",[e])},t.isSeeking=function(){return null!==this.seekTime},t.isAutoplay=function(){return!!this.autoPlayOptions},t.getDuration=function(){return this.state.duration},t.getStartOffset=function(){return this.state.startOffset||0},t.getPosition=function(){return null===this.seekTime?this.mediaSinkManager.getCurrentSink().getCurrentTime():this.seekTime},t.getSyncTime=function(){return this.state.syncTime},t.getBuffered=function(){return this.mediaSinkManager.getCurrentSink().buffered()},t.getBufferedRanges=function(){return this.postMessage("updateBufferedRanges",[]),this.state.trackBufferedRanges},t.getSinkBufferedRanges=function(){var e=this.mediaSinkManager.getCurrentSink();return{audio:e.getBufferedRanges("audio"),video:e.getBufferedRanges("video")}},t.getBufferDuration=function(){return this.state.bufferedPosition-this.getPosition()},t.getState=function(){return this.state.state},t.getVideoWidth=function(){return this.getHTMLVideoElement().videoWidth},t.getVideoHeight=function(){return this.getHTMLVideoElement().videoHeight},t.getVideoFrameRate=function(){return this.state.statistics.framerate},t.getVideoBitRate=function(){return this.state.statistics.bitrate},t.getAverageBitrate=function(){return this.state.averageBitrate},t.getBandwidthEstimate=function(){return this.state.bandwidthEstimate},t.getPath=function(){return this.state.path},t.getProtocol=function(){return this.state.protocol},t.getVersion=function(){return"1.34.1"},t.isLiveLowLatency=function(){return this.state.liveLowLatencyEnabled&&this.state.liveLowLatency},t.isLooping=function(){return this.state.looping},t.setLogLevel=function(e){!function(e){var t={debug:!1,log:!1,info:!1,warn:!1,error:!1},n=function(e,n){for(var r,i=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?we(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(e);!(r=i()).done;){var o=r.value;t[o]=n}};switch(e.level){case"debug":n(["debug","log","info","warn","error"],!0);break;case"log":n(["log","info","warn","error"],!0);break;case"info":n(["info","warn","error"],!0);break;case"warn":n(["warn","error"],!0);break;case"error":n(["error"],!0)}!function(e){ke.enabled=e.enabled,ke.levels=o()({},e.levels),Ie.emit("logConfigUpdated",e)}({enabled:e.enabled,levels:t})}({enabled:!0,level:e}),this.postMessage("setLogLevel",[e])},t.setLooping=function(e){this.state.looping=e,this.postMessage("setLooping",[e])},t.isMuted=function(){return this.mediaSinkManager.getCurrentSink().isMuted()},t.setMuted=function(e){this.mediaSinkManager.getCurrentSink().setMuted(e)},t.setVolume=function(e){this.state.volume=e,this.postMessage("setVolume",[this.state.volume])},t.getVolume=function(){return this.state.volume},t.getQuality=function(){return this.state.quality},t.setQuality=function(e,t){void 0===t&&(t=!1),this.getHTMLVideoElement().controls||(this.postMessage("setQuality",[e,t]),this.state.autoQualityMode=!1)},t.getQualities=function(){return this.state.qualities},t.setAuthToken=function(e){this.postMessage("setAuthToken",[e])},t.isAutoQualityMode=function(){return this.state.autoQualityMode},t.setAutoQualityMode=function(e){this.state.autoQualityMode=e,this.postMessage("setAutoQualityMode",[e])},t.setAutoInitialBitrate=function(e){this.postMessage("setAutoInitialBitrate",[e])},t.setAutoMaxQuality=function(e){this.postMessage("setAutoMaxQuality",[e])},t.setAutoMaxBitrate=function(e){this.postMessage("setAutoMaxBitrate",[e])},t.setAutoMaxVideoSize=function(e,t){this.postMessage("setAutoMaxVideoSize",[e,t])},t.setAutoViewportSize=function(e,t){this.postMessage("setAutoViewportSize",[e,t])},t.getPlaybackRate=function(){return this.mediaSinkManager.getCurrentSink().getPlaybackRate()},t.setPlaybackRate=function(e){return this.mediaSinkManager.getCurrentSink().setPlaybackRate(e)},t.setClientId=function(e){this.postMessage("setClientId",[e])},t.setDeviceId=function(e){this.postMessage("setDeviceId",[e])},t.setLiveSpeedUpRate=function(e){this.postMessage("setLiveSpeedUpRate",[e])},t.setPlayerType=function(e){this.postMessage("setPlayerType",[e])},t.setLiveMaxLatency=function(e){this.postMessage("setLiveMaxLatency",[e])},t.setLiveLowLatencyEnabled=function(e){this.state.liveLowLatencyEnabled=e,this.postMessage("setLiveLowLatencyEnabled",[e])},t.setRebufferToLive=function(e){var t;null!=(t=xe())&&null!=(t=t.getDriftDetectionConfig())&&t.enabled||this.postMessage("setRebufferToLive",[e])},t.setVisible=function(e){this.postMessage("setVisible",[e])},t.setInitialBufferDuration=function(e){this.postMessage("setInitialBufferDuration",[e])},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.removeListener(e,t)},t.getDroppedFrames=function(){return this.state.statistics.droppedFrames},t.getDecodedFrames=function(){return this.state.statistics.decodedFrames},t.getDisplayWidth=function(){return this.renderSurface.displayDimensions().width},t.getDisplayHeight=function(){return this.renderSurface.displayDimensions().height},t.getSessionId=function(){return this.state.sessionId},t.getChannelMetadata=function(){return this.state.channelMetadata},t.getSessionData=function(){return this.state.sessionData},t.getLiveLatency=function(){return this.state.liveLatency},t.isProtected=function(){return this.mediaSinkManager.isProtected()},t.startRemotePlayback=function(){this.postMessage("startRemotePlayback")},t.endRemotePlayback=function(){this.postMessage("endRemotePlayback")},t.setPlatformName=function(e){this.postMessage("setPlatformName",[e])},t.setRequestCredentials=function(e){this.postMessage("setRequestCredentials",[e])},t.setSinkType=function(e){this.postMessage("setSinkType",[e])},t.onSinkTimeUpdate=function(){if(null===this.seekTime){var e=this.mediaSinkManager.getCurrentSink(),t=this.renderSurface.stats(),n=t.droppedFrames,r=t.decodedFrames,i=this.renderSurface.displayDimensions(),o=i.height,s=i.width;this.postMessage("onClientSinkUpdate",[{currentTime:e.getCurrentTime(),decodedFrames:r,droppedFrames:n,framerate:this.renderSurface.framerate(),bufferDuration:e.bufferDuration(),displayHeight:o,displayWidth:s}]),this.setAutoViewportSize(s*window.devicePixelRatio,o*window.devicePixelRatio),this.emitter.emit(a.a.TIME_UPDATE,e.getCurrentTime())}},t.onSinkBufferUpdate=function(){this.emitter.emit(a.a.BUFFER_UPDATE)},t.onSinkDurationChanged=function(e){this.postMessage("onClientSinkDurationChanged",[e])},t.onSinkEnded=function(){this.postMessage("onClientSinkEnded")},t.onSinkIdle=function(){this.postMessage("onClientSinkIdle")},t.onSinkPlaying=function(e){this.postMessage("onClientSinkPlaying"),e&&this.play()},t.onSinkStop=function(e){var t,n,r=(0,Ue.sQ)(document).hidden;if(document[r])this.postMessage("pause");else if(e){if(!this.isMuted()&&(null==(t=null==(n=this.autoPlayOptions)?void 0:n.attemptMutedRetry)||t))return this.setMuted(!0),this.mediaSinkManager.getCurrentSink().play(),void this.emitter.emit(a.a.AUDIO_BLOCKED);this.pause(),this.emitter.emit(a.a.PLAYBACK_BLOCKED)}else this.pause()},t.onSinkReset=function(){this.postMessage("onClientSinkReset")},t.onSinkError=function(e){var t=e.value,n=e.code,r=e.message;this.postMessage("onClientSinkError",[t,n,r])},t.onSinkRecoverableError=function(e){var t=e.value,n=e.code,r=e.message;this.postMessage("onClientSinkRecoverableError",[t,n,r])},t.onSinkVolumeChanged=function(e,t){this.getHTMLVideoElement().controls&&t&&this.setVolume(e),this.emitter.emit(a.a.VOLUME_CHANGED,this.state.volume)},t.onSinkMutedChanged=function(e){this.postMessage("setMuted",[e]),this.emitter.emit(a.a.MUTED_CHANGED)},t.onSinkPlaybackRateChanged=function(e){this.postMessage("setPlaybackRate",[e])},t.onPassthroughSinkDataCue=function(e){var t;null==(t=this.daterangeTagAssembler)||t.addCue(e)},t.onPassthroughSinkMetadata=function(e,t,n,r,i){this.emitter.emit(a.a.TEXT_METADATA_CUE,{description:r,endTime:t,startTime:e,text:n,owner:i,type:"TextMetadataCue"})},t.onPassthroughSinkPropertyChanged=function(e,t){this.postMessage("onClientSinkPassthroughPropertyChanged",[e,t])},t.onSinkControlsChanged=function(e){this.postMessage("setControls",[e])},t.onSinkGapJump=function(e){this.postMessage("onClientSinkGapJump",[e])},t.onRemoteDevice=function(e){this.emitter.emit(e?Q.G.AVAILABLE:Q.G.UNAVAILABLE)},t.onRemoteReconnect=function(){this.startRemotePlayback()},t.onSessionError=function(){this.postMessage("onClientSinkError",[b.pn,0,"Chromecast session error"])},t.onLoadMediaError=function(){this.postMessage("onClientSinkError",[b.pn,0,"Chromecast load media failed"])},t.onUserCancel=function(){this.endRemotePlayback(),this.emitter.emit(Q.G.SESSION_ENDED)},t.onSegmentDiscontinuity=function(){this.mediaSinkManager.onSegmentDiscontinuity()},t.onSessionStop=function(){this.endRemotePlayback(),this.emitter.emit(Q.G.SESSION_ENDED)},t.onSessionStarted=function(e){this.emitter.emit(Q.G.SESSION_STARTED,e)},e.canDeviceConfigManagerRefreshNowCallback=function(){return e.instanceCount>0},e.emitDeviceConfigManagerMetricsCallback=function(e){dn.getInstance().enqueue(e)},t.emitDeviceConfigManagerMetrics=function(){for(var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ln(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ln(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(this.deviceConfigMetricsHelper.dequeueAll());!(e=t()).done;){var n=e.value;this.sendConfigManagerDeviceConfigAnalytics("ivs_devconf_ops_metrics",n)}},t.sendConfigManagerDeviceConfigAnalytics=function(e,t){var n=(0,Ue.dl)(t);n&&this.postMessage("onDeviceConfigAnalytics",[e,n])},t.attemptPlay=function(){var e=(0,Ue.sQ)(document).hidden;!document[e]&&this.isLoaded&&this.postMessage("play")},t.postMessage=function(e,t,n){void 0===n&&(n=[]),this.worker.postMessage({id:this.id,funcName:e,args:t},n)},t.resetState=function(){Object.assign(this.state,{state:Y.p.IDLE,quality:{name:"",group:"",codecs:"",bitrate:0,width:0,height:0,framerate:0},qualities:[],duration:0,startOffset:0,sessionData:{},volume:1,statistics:{bitrate:0,framerate:0,droppedFrames:0,decodeFrames:0,renderedFrames:0},trackBufferedRanges:{audio:[],video:[]},channelMetadata:[]}),this.emitter.emit(a.a.DURATION_CHANGED,0),this.seekTime=null,this.isLoaded=!1},t.attachHandlers=function(){var e=this;this.worker.addEventListener("message",this.onmessage);var t=(0,Ue.sQ)(document).visibilityChange;document.addEventListener(t,this.onvisibilitychange),window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline);var n=this.emitter;n.on(a.a.VOLUME_CHANGED,(function(){return e.onVolumeChanged()})),n.on(a.a.MUTED_CHANGED,(function(){return e.onMutedChanged()})),n.on(a.a.SEEK_COMPLETED,(function(){return e.onSeekCompleted()})),n.on(a.a.ERROR,(function(){return e.onError()})),n.on(a.a.SESSION_DATA,(function(t){return e.onSessionData(t)})),n.on(a.a.SEGMENT_DISCONTINUITY,(function(){return e.onSegmentDiscontinuity()})),n.on(et.STATE_CHANGED,(function(t){return e.onStateChanged(t)})),n.on(et.MEDIA_SINK_RPC,(function(t){return e.mediaSinkManager.applyRPC(t)})),n.on(et.CONFIGURE,(function(t){e.mediaSinkManager.configure(t),e.setSinkType(t.mode)})),n.on(et.RESET,(function(){var t,n;null==(t=e.videoTransformerModule)||t.stop(),null==(n=e.videoTransformerModule)||n.reset(),e.mediaSinkManager.reset()})),n.on(q.C.ID3,(function(t){return e.onID3(t)})),n.on(et.GET_EXPERIMENTS,(function(t){e.experiments=t})),n.on(et.PROPERTY_CHANGED,(function(t){var n=t.key,r=t.value;e.state[n]=function(e,t){return"syncTime"===e&&(t*=1e3),t}(n,r)})),n.on(et.SYNC_TIME_CHANGED,(function(t){e.emitter.emit(a.a.SYNC_TIME_UPDATE,1e3*t)})),n.on(et.BUFFERED_RANGES,(function(t){e.state.trackBufferedRanges=t})),n.on(et.LOG_MESSAGE,(function(e){var t=e.level,n=e.message;return console[t](n)}))},t.onVolumeChanged=function(){var e=(0,Ue.sQ)(document).hidden;this.pauseHiddenSilentTab&&document[e]&&0===this.getVolume()&&this.postMessage("pause")},t.onMutedChanged=function(){var e=(0,Ue.sQ)(document).hidden;this.pauseHiddenSilentTab&&document[e]&&this.isMuted()&&this.postMessage("pause")},t.onSeekCompleted=function(){this.seekTime=null},t.onError=function(){this.paused=!0},t.onStateChanged=function(e){var t=this;switch(e){case Y.p.READY:var n=this.isQualitySupported;if(this.adjustments.abrTranscodesOnly&&this.state.qualities.length>1){var r=this.state.qualities.slice().sort((function(e,t){return t.bitrate-e.bitrate}));"chunked"!==r[0].group?n=function(e){return"chunked"!==e.group&&t.isQualitySupported(e)}:this.setAutoMaxQuality(r[1])}var i=(0,Ue.YH)(this.state.qualities,n);this.state.qualities=i.supported,i.unsupported.forEach((function(e){return t.postMessage("removeQuality",[e])})),this.isLoaded=!0,this.autoPlayOptions&&this.play(),this.paused||this.attemptPlay();break;case Y.p.IDLE:var o;null==(o=this.videoTransformerModule)||o.stop();break;case Y.p.PLAYING:this.tryStartVideoTransformer();break;case Y.p.ENDED:this.paused=!0}this.emitter.emit(a.a.STATE_CHANGED,e),this.emitter.emit(e)},t.onID3=function(e){var t=this;e.forEach((function(e){if("TXXX"===e.id&&"segmentmetadata"===e.desc&&e.info.length){var n=(0,Ue.N8)(e.info[0]);if(Object.prototype.hasOwnProperty.call(n,"stream_offset")){var r=Number(n.stream_offset);isNaN(r)||(t.state.startOffset=r-t.getPosition())}}}))},t.onVisibilityChange=function(){var e,t=(0,Ue.sQ)(document).hidden,n=document[t];this.paused||document[t]||this.attemptPlay(),this.pauseHiddenSilentTab&&!this.paused&&n&&(this.isMuted()||0===this.getVolume())&&this.postMessage("pause"),null==(e=this.videoTransformerModule)||e.onPageVisibilityChanged(n,this.getHTMLVideoElement()),(0,r.cp)().firefox||this.postMessage("setVisible",[!n])},t.onSessionData=function(e){Object.assign(this.state,e)},t.onConfigChanged=function(){var e,t=this.configManager.getConfigSnapshot();t.features.gpu.flags.enable_render_surface&&this.renderSurface.moveVideoToRenderSurface(),this.setupDaterangeTagAssembler(null!=(e=t.features.passthroughDaterangeTags)&&e),this.postMessage("updatePlayerConfiguration",[t])},t.setupDaterangeTagAssembler=function(e){var t,n,r,i,s=this;e?this.daterangeTagAssembler||(this.daterangeTagAssembler=(t=function(e){var t=e.attributes["X-TV-TWITCH-STREAM-SOURCE"];void 0!==t&&s.emitter.emit(a.a.STREAM_SOURCE_CUE,{type:"StreamSourceCue",streamSource:t}),s.emitter.emit(a.a.METADATA,{type:"text/json",data:(0,Ue.dl)(o()({ID:e.ID,CLASS:e.CLASS},e.attributes))})},n=new Map,r=function(e,t){return Array.from(e.attributes).every((function(e){return void 0!==t.attributes[e]}))},i=function(e,n,i,o){for(var a=0;a<n.length;++a){var s=n[a];if(s.CLASS===e.CLASS&&void 0===s.attributes[i])return s.attributes[i]=o,r(e,s)&&(n.splice(a,1),t(s)),!0}return!1},{addCue:function(e){var o,a,s=null==(o=e.value)?void 0:o.key,u=null==(a=e.value)?void 0:a.data;if(void 0!==s&&void 0!==u)for(var c=0;c<$e.length;++c){var d=$e[c];if(d.attributes.has(s)){var l=e.startTime+"-"+e.endTime,f=n.get(l);if(f||(f=[],n.set(l,f)),!i(d,f,s,u)){var h,p={ID:"com.apple.quicktime.FAKE-HLS-"+Xe++,CLASS:d.CLASS,attributes:(h={},h[s]=u,h.DURATION=""+(e.endTime-e.startTime),h["START-DATE"]=(new Date).toISOString(),h)};r(d,p)?t(p):f.push(p)}}}}})):this.daterangeTagAssembler=void 0},t.trySetupVideoTransformer=function(){var e=this;if(!this.videoTransformerModule){var t=this.configManager.getConfigSnapshot().features.gpu;if(t.flags.init_transformer||t.flags.run_transformer){var n=function(t){e.renderSurface.setActiveSurface(un.video),y.warn("[MediaPlayer]: Video Transformer error, switching render surface to video",t)},r=function(t){y.debug("[MediaPlayer]: Sending analytics event",t),e.postMessage(t.name,[t.data])};this.videoTransformerModule=new nn(t,{error:n,analytics:r,active:function(){var n,r=un.video;t.flags.allow_canvas_visible&&(r=un.canvas,null!=(n=t.render)&&n.debug&&(r=un.debug_both)),e.renderSurface.setActiveSurface(r)},inactive:function(){e.renderSurface.setActiveSurface(un.video)}}),this.videoTransformerModule.init().then((function(n){n&&e.videoTransformerModule&&(t.flags.add_canvas_to_surface&&(y.debug("[MediaPlayer]: Adding canvas to render surface"),e.renderSurface.setCanvas(n)),e.getState()===Y.p.PLAYING&&e.tryStartVideoTransformer())})).catch((function(t){var i;null==(i=e.videoTransformerModule)||i.disable(),y.warn("[MediaPlayer]: Unhanled error initializing the Video Transformer");var o={source:"MediaPlayer",code:vt.Init,message:"Unhandled error initializing the Video Transformer: "+((null==t?void 0:t.message)||"unknown"),fatal:!0,gpu_architecture:"",gpu_description:"",gpu_device:"",gpu_vendor:"",surface_visible:!1};n(),r({name:"onGpuError",data:o})}))}}},t.tryStartVideoTransformer=function(){this.videoTransformerModule&&this.configManager.getConfigSnapshot().features.gpu.flags.run_transformer&&this.videoTransformerModule.start(this.getHTMLVideoElement())},t.onWorkerMessage=function(e){var t=e.data;if(t&&t.id===this.id){var n=this.workerMessageProcessors.reduce((function(e,t){return t(e)}),t),r=n.type,i=n.arg;void 0!==t.arg?this.emitter.emit(r,i):this.emitter.emit(r)}},t.processVideoElementAttributes=function(e){if(e.hasAttribute("autoplay")&&(e.removeAttribute("autoplay"),this.setAutoplay(!0)),e.hasAttribute("playbackRate")){var t,n=parseFloat(null!=(t=e.getAttribute("playbackRate"))?t:"1.0");if(!isNaN(n)){var r=(0,Ue.qE)(n,.25,2);this.setPlaybackRate(r)}e.removeAttribute("playbackRate")}if(e.hasAttribute("src")){var i=e.src;(0,Ue.Pr)(e),this.load(i)}if(e.hasAttribute("loop")&&(e.removeAttribute("loop"),this.setLooping(!0)),e.hasAttribute("muted")&&(e.removeAttribute("muted"),this.setMuted(!0)),e.hasAttribute("volume")){var o,a=parseFloat(null!=(o=e.getAttribute("volume"))?o:"1.0");isNaN(a)||this.setVolume((0,Ue.qE)(a,0,1)),e.removeAttribute("volume")}},t.checkDebugCaptureEnabled=function(){},t.getDeviceConfigPropertyHolder=function(){return this.configManager.getDeviceConfigPropertyHolder()},e}();fn.instanceCount=0,fn.instanceId=0;var hn=n(573),pn=function(){function e(e){var t=this;this.workerPort=void 0,this.emitter=void 0,this.messageQueue=void 0,this.workerPort={postMessage:this.postMessageFromWorker.bind(this),onmessage:function(){}},this.emitter=new Se.EventEmitter,this.messageQueue=new hn.o,this.loadScript(e,(function(e){return t.applyWorkerEnv(e)}))}var t=e.prototype;return t.postMessage=function(e){this.messageQueue?this.messageQueue.push(e):this.postMessageToWorker(e)},t.addEventListener=function(e,t){this.emitter.on(e,t)},t.removeEventListener=function(e,t){this.emitter.off(e,t)},t.onmessage=function(){},t.onmessageerror=function(){},t.onerror=function(){},t.terminate=function(){},t.dispatchEvent=function(){return!0},t.loadScript=function(e,t){var n=this,r=new XMLHttpRequest;r.open("GET",e),r.addEventListener("load",(function(){r.status>=200&&r.status<400?t(r.response):n.emitter.emit("error",new Error(r.statusText))})),r.addEventListener("error",(function(e){n.emitter.emit("error",e)})),r.send()},t.applyWorkerEnv=function(e){if(this.messageQueue){try{Function("self","messageHandler",e)(window,this.workerPort)}catch(e){return void this.emitter.emit("error",e)}for(;!this.messageQueue.empty();)this.postMessageToWorker(this.messageQueue.pop());this.messageQueue=null}},t.postMessageFromWorker=function(e){var t=this;setTimeout((function(){t.emitter.emit("message",{data:e})}),0)},t.postMessageToWorker=function(e){var t=this;setTimeout((function(){t.workerPort.onmessage({data:e})}),0)},e}();function vn(e,t,n){var i;return void 0===n&&(n=!1),(i=(0,r.cp)().msIE?new pn(e):(0,Ue.J6)(e)?new Worker(e):new Worker(URL.createObjectURL(new Blob(["importScripts('"+e+"')"])))).postMessage({wasmBinaryUrl:t,showWorkerLogs:n}),i}var mn="undefined"!=typeof window&&"object"==typeof window.WebAssembly&&"function"==typeof window.WebAssembly.instantiate,gn=mn;function yn(e){var t=e.asmWorker,n=e.wasmWorker,r=e.wasmBinary;if(!gn&&!t)throw new Error("WebAssembly is not supported by the browser. This is required for playback.");var i=vn(gn?n:t,r,e.showWorkerLog);return new Sn(e,i)}function En(){return"1.34.1"}var Sn=function(){function e(e,t){this.core=void 0,this.startCapture=void 0,this.stopCapture=void 0,this.requestCaptureAnalytics=void 0,this.core=new fn(e,t)}var t=e.prototype;return t.addEventListener=function(e,t){var n;null==(n=this.checkCore())||n.addEventListener(e,t)},t.attachHTMLVideoElement=function(e){var t;null==(t=this.checkCore())||t.attachHTMLVideoElement(e)},t.delete=function(){var e;null==(e=this.checkCore())||e.delete(),this.core=null},t.endRemotePlayback=function(){var e;null==(e=this.checkCore())||e.endRemotePlayback()},t.isAutoplay=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoplay()},t.isAutoQualityMode=function(){var e;return null==(e=this.checkCore())?void 0:e.isAutoQualityMode()},t.getAverageBitrate=function(){var e;return null==(e=this.checkCore())?void 0:e.getAverageBitrate()},t.getBandwidthEstimate=function(){var e;return null==(e=this.checkCore())?void 0:e.getBandwidthEstimate()},t.getBufferDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferDuration()},t.getBuffered=function(){var e;return null==(e=this.checkCore())?void 0:e.getBuffered()},t.getBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getBufferedRanges()},t.getSinkBufferedRanges=function(){var e;return null==(e=this.checkCore())?void 0:e.getSinkBufferedRanges()},t.getDecodedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDecodedFrames()},t.getDisplayHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayHeight()},t.getDisplayWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getDisplayWidth()},t.getDroppedFrames=function(){var e;return null==(e=this.checkCore())?void 0:e.getDroppedFrames()},t.getDuration=function(){var e;return null==(e=this.checkCore())?void 0:e.getDuration()},t.getExperiments=function(){var e;return null==(e=this.checkCore())?void 0:e.getExperiments()},t.getHTMLVideoElement=function(){var e;return null==(e=this.checkCore())?void 0:e.getHTMLVideoElement()},t.getVideoRenderSurface=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoRenderSurface()},t.getLiveLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.getLiveLatency()},t.getPath=function(){var e;return null==(e=this.checkCore())?void 0:e.getPath()},t.getProtocol=function(){var e;return null==(e=this.checkCore())?void 0:e.getProtocol()},t.getPlaybackRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getPlaybackRate()},t.getPosition=function(){var e;return null==(e=this.checkCore())?void 0:e.getPosition()},t.getSyncTime=function(){var e;return null==(e=this.checkCore())?void 0:e.getSyncTime()},t.getQualities=function(){var e;return null==(e=this.checkCore())?void 0:e.getQualities()},t.getQuality=function(){var e;return null==(e=this.checkCore())?void 0:e.getQuality()},t.getSessionData=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionData()},t.getSessionId=function(){var e;return null==(e=this.checkCore())?void 0:e.getSessionId()},t.getChannelMetadata=function(){var e,t;return null!=(e=null==(t=this.checkCore())?void 0:t.getChannelMetadata())?e:[]},t.getStartOffset=function(){var e;return null==(e=this.checkCore())?void 0:e.getStartOffset()},t.getState=function(){var e;return null==(e=this.checkCore())?void 0:e.getState()},t.getVersion=function(){var e;return null==(e=this.checkCore())?void 0:e.getVersion()},t.getVideoBitRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoBitRate()},t.getVideoFrameRate=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoFrameRate()},t.getVideoHeight=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoHeight()},t.getVideoWidth=function(){var e;return null==(e=this.checkCore())?void 0:e.getVideoWidth()},t.getVolume=function(){var e;return null==(e=this.checkCore())?void 0:e.getVolume()},t.isLiveLowLatency=function(){var e;return null==(e=this.checkCore())?void 0:e.isLiveLowLatency()},t.isLooping=function(){var e;return null==(e=this.checkCore())?void 0:e.isLooping()},t.isMuted=function(){var e;return null==(e=this.checkCore())?void 0:e.isMuted()},t.isPaused=function(){var e;return null==(e=this.checkCore())?void 0:e.isPaused()},t.isProtected=function(){var e;return null==(e=this.checkCore())?void 0:e.isProtected()},t.isSeeking=function(){var e;return null==(e=this.checkCore())?void 0:e.isSeeking()},t.load=function(e,t){var n;return void 0===t&&(t=""),null==(n=this.checkCore())?void 0:n.load(e,t)},t.pause=function(){var e;null==(e=this.checkCore())||e.pause()},t.play=function(){var e;null==(e=this.checkCore())||e.play()},t.removeEventListener=function(e,t){var n;null==(n=this.checkCore())||n.removeEventListener(e,t)},t.seekTo=function(e){var t;null==(t=this.checkCore())||t.seekTo(e)},t.setAuthToken=function(e){var t;null==(t=this.checkCore())||t.setAuthToken(e)},t.setAutoInitialBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoInitialBitrate(e)},t.setAutoMaxQuality=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxQuality(e)},t.setAutoMaxBitrate=function(e){var t;null==(t=this.checkCore())||t.setAutoMaxBitrate(e)},t.setAutoMaxVideoSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoMaxVideoSize(e,t)},t.setAutoplay=function(e){var t;null==(t=this.checkCore())||t.setAutoplay(e)},t.setAutoPlayOptions=function(e){var t;null==(t=this.checkCore())||t.setAutoPlayOptions(e)},t.setAutoQualityMode=function(e){var t;null==(t=this.checkCore())||t.setAutoQualityMode(e)},t.setAutoViewportSize=function(e,t){var n;null==(n=this.checkCore())||n.setAutoViewportSize(e,t)},t.setClientId=function(e){var t;null==(t=this.checkCore())||t.setClientId(e)},t.setDeviceId=function(e){var t;null==(t=this.checkCore())||t.setDeviceId(e)},t.setExperiment=function(e,t){var n;null==(n=this.checkCore())||n.setExperiment(e,t)},t.setExperimentData=function(e){var t;null==(t=this.checkCore())||t.setExperimentData(e)},t.setInitialBufferDuration=function(e){var t;null==(t=this.checkCore())||t.setInitialBufferDuration(e)},t.setLiveLowLatencyEnabled=function(e){var t;null==(t=this.checkCore())||t.setLiveLowLatencyEnabled(e)},t.setLiveMaxLatency=function(e){var t;null==(t=this.checkCore())||t.setLiveMaxLatency(e)},t.setLiveSpeedUpRate=function(e){var t;null==(t=this.checkCore())||t.setLiveSpeedUpRate(e)},t.setLogLevel=function(e){var t;null==(t=this.checkCore())||t.setLogLevel(e)},t.setLooping=function(e){var t;null==(t=this.checkCore())||t.setLooping(e)},t.setMuted=function(e){var t;null==(t=this.checkCore())||t.setMuted(e)},t.setPlaybackRate=function(e){var t;null==(t=this.checkCore())||t.setPlaybackRate(e)},t.setPlayerType=function(e){var t;null==(t=this.checkCore())||t.setPlayerType(e)},t.setQuality=function(e,t){var n;void 0===t&&(t=!1),null==(n=this.checkCore())||n.setQuality(e,t)},t.setRebufferToLive=function(e){var t;null==(t=this.checkCore())||t.setRebufferToLive(e)},t.setVisible=function(e){var t;null==(t=this.checkCore())||t.setVisible(e)},t.setVolume=function(e){var t;null==(t=this.checkCore())||t.setVolume(e)},t.startRemotePlayback=function(){var e;null==(e=this.checkCore())||e.startRemotePlayback()},t.setPlatformName=function(e){var t;null==(t=this.checkCore())||t.setPlatformName(e)},t.setRequestCredentials=function(e){var t;null==(t=this.checkCore())||t.setRequestCredentials(e)},t.checkCore=function(){return this.core||console.warn("Method called on deleted player instance."),this.core},e}()},573:function(e,t,n){"use strict";n.d(t,{o:function(){return r}});var r=function(){function e(){this.buffer=void 0,this.head=void 0,this.tail=void 0,this.buffer=[],this.head=0,this.tail=0}var t=e.prototype;return t.push=function(e){this.tail===this.buffer.length?this.buffer.push(e):this.buffer[this.tail]=e,this.tail++},t.pop=function(){var e,t=null!=(e=this.buffer[this.head])?e:null;return this.buffer[this.head]=null,this.head++,this.empty()&&(this.head=0,this.tail=0),t},t.size=function(){return this.tail-this.head},t.empty=function(){return this.head>=this.tail},e}()},290:function(e,t,n){"use strict";n.d(t,{$1:function(){return c},$_:function(){return h},Ec:function(){return f},Pt:function(){return i},Ri:function(){return d},a1:function(){return r},lU:function(){return u},ok:function(){return o},pn:function(){return a},xA:function(){return l},yY:function(){return s}});var r=2,i=4,o=3,a=1,s=101,u=102,c=201,d=202,l=203,f=204,h=404},309:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(898),i=n.n(r),o=n(290),a=n(573),s=n(623);function u(e){var t=(e||"").match(/codecs="([^.]+)\./);return t&&t[1]?t[1]:""}var c=function(){function e(e,t,n,r,i){this.rawCodec=t,this.group=n,this.isProtected=r,this.onError=i,this.pending=void 0,this.unsubscribers=[],this.srcBuf=void 0,this.blocked=!1,this.srcBuf=e,this.pending=new a.o,this.unsubscribers.push((0,s.B1)(e,"updateend",this.process.bind(this)))}var t=e.prototype;return t.getBufferedRanges=function(){try{var e=[];if(this.srcBuf)for(var t=this.srcBuf.buffered,n=0;n<t.length;n++)e.push({start:t.start(n),end:t.end(n)});return e}catch(e){return[]}},t.abort=function(){this.schedule((function(e){e.abort()}))},t.changeType=function(e){this.rawCodec=function(e){var t=(e||"").match(/codecs=".+"/);return t&&t[0]?t[0]:'codecs=""'}(e),this.schedule((function(t){t.changeType(e)}))},t.appendBuffer=function(e){this.schedule((function(t){try{t.appendBuffer(e)}catch(e){if("QuotaExceededError"!==e.name)throw e;var n=t.buffered,r=n.start(0),i=n.end(n.length-1),o=(r+i)/2;t.remove(o,i)}}))},t.setTimestampOffset=function(e){this.schedule((function(t){t.timestampOffset=e}))},t.remove=function(e,t){this.schedule((function(n){var r=n.buffered;if(r.length){var i=Math.max(e,r.start(0)),o=Math.min(t,r.end(r.length-1));i<o&&n.remove(i,o)}}))},t.block=function(){var e=this;return new Promise((function(t){e.schedule((function(){e.blocked=!0,t()}))}))},t.unblock=function(){this.blocked=!1,this.process()},t.destroy=function(){this.pending=new a.o,this.unsubscribers.forEach((function(e){return e()})),this.srcBuf=void 0},t.schedule=function(e){this.pending.empty()&&this.canProcess()?this.safeExecute(e):(this.pending.push(e),this.process())},t.safeExecute=function(e){try{if(!this.srcBuf)throw new Error("srcBuf is undefined");e(this.srcBuf)}catch(e){this.onError(e,!1)}},t.process=function(){for(;!this.pending.empty()&&this.canProcess();)this.safeExecute(this.pending.pop())},t.canProcess=function(){return!(!this.srcBuf||this.srcBuf.updating||this.blocked)},i()(e,[{key:"buffer",get:function(){return this.srcBuf}},{key:"codec",get:function(){return this.rawCodec}},{key:"timestampOffset",get:function(){return this.buffer?this.buffer.timestampOffset:0}}])}(),d=n(789),l=function(){function e(e,t,n){this.mediaSource=e,this.onEnded=t,this.onError=n,this.sourceBuffers=Object.create(null),this.unsubscribers=[],this.unsubscribers.push((0,s.B1)(e,"sourceended",this.onEnded))}e.isSupported=function(){return void 0!==self.MediaSource},e.isSupportedInWorker=function(){return e.isSupported()&&MediaSource.canConstructInDedicatedWorker&&"function"==typeof MediaSourceHandle},e.create=function(t,n){var r=new MediaSource,i=new Promise((function(i,o){var a=(0,s.B1)(r,"sourceopen",(function(){"open"===r.readyState?(i(new e(r,t,n)),a()):o("The MediaSource was closed upon opening")}))}));return{ms:r,sink:i}};var t=e.prototype;return t.getBufferedRanges=function(e){var t,n;return null!=(t=null==(n=this.sourceBuffers[d.kD[e]])?void 0:n.getBufferedRanges())?t:[]},t.addTrack=function(e,t,n,r){var i=this.mediaSource,o=this.sourceBuffers,a=function(e){return"video/mp4;"+e}(t);if(o[e]){var s,d=u(o[e].codec);return u(t)!==d&&o[e].changeType(a),null!=(s=o[e].buffer)?s:null}try{var l=i.addSourceBuffer(a);return o[e]=new c(l,t,n,r,this.handleError.bind(this)),l}catch(e){this.handleError(e,"open"===i.readyState)}return null},t.append=function(e,t){var n;null==(n=this.sourceBuffers[e])||n.appendBuffer(t)},t.remove=function(e,t){for(var n=this.sourceBuffers,r=0,i=Object.keys(n);r<i.length;r++)n[i[r]].remove(e,t)},t.setTimestampOffset=function(e,t){var n=this.sourceBuffers[e];n&&(n.abort(),n.setTimestampOffset(t))},t.setDuration=function(e){var t=this;this.scheduleUpdate((function(){return t.mediaSource.duration=e})).catch((function(e){return t.handleError(e,!1)}))},t.setLiveSeekableRange=function(e,t){var n=this;this.scheduleUpdate((function(){return n.mediaSource.setLiveSeekableRange(e,t)})).catch((function(e){return n.handleError(e,!1)}))},t.scheduleUpdate=function(e){var t=this;void 0===e&&(e=f);var n=Object.keys(this.sourceBuffers).map((function(e){return t.sourceBuffers[e]}));return Promise.all(n.map((function(e){return e.block()}))).then(e).then((function(){return n.forEach((function(e){return e.unblock()}))}))},t.isDrmProtected=function(){return this.bufferProperties.some((function(e){return e.isProtected}))},t.isAudioOnly=function(){return 1===this.bufferProperties.length&&"audio_only"===this.bufferProperties[0].group},t.destroy=function(){this.destroySourceBuffers(),this.unsubscribers.forEach((function(e){return e()})),this.unsubscribers=[]},t.handleError=function(e,t){var n=e.code||o.lU,r=o.lU;"NotSupportedError"===e.name&&(r=n=o.Pt),this.onError(r,n,e.message,t)},t.destroySourceBuffers=function(){for(var e=this.mediaSource;e.sourceBuffers.length>0;)try{e.removeSourceBuffer(e.sourceBuffers[0])}catch(e){this.handleError(e,!1);break}for(var t=0,n=Object.keys(this.sourceBuffers);t<n.length;t++){var r=n[t];this.sourceBuffers[r].destroy()}this.sourceBuffers=Object.create(null)},i()(e,[{key:"duration",get:function(){return this.mediaSource.duration}},{key:"bufferProperties",get:function(){var e=this.sourceBuffers;return Object.keys(e).map((function(t){var n=e[t];return{trackID:Number(t),codec:n.codec,mode:"mse",path:"",isProtected:n.isProtected,group:n.group,srcObj:null}}))}}])}(),f=function(){}},789:function(e,t,n){"use strict";n.d(t,{HJ:function(){return a},Pp:function(){return o},Sf:function(){return i},de:function(){return r},kD:function(){return s}});var r=.1,i=1<<30,o=12e4,a=3e3,s={audio:1936684398,video:1986618469}},623:function(e,t,n){"use strict";n.d(t,{B1:function(){return l},GX:function(){return h},V3:function(){return c},gd:function(){return s},ld:function(){return a},tX:function(){return d},v8:function(){return f},vG:function(){return u},xB:function(){return o}});var r=n(796),i=n(789);function o(e){return"number"==typeof e.webkitDecodedFrameCount?e.webkitDecodedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().totalVideoFrames:"number"==typeof e.mozDecodedFrames?e.mozDecodedFrames:0}function a(e){return"number"==typeof e.webkitDroppedFrameCount?e.webkitDroppedFrameCount:"function"==typeof e.getVideoPlaybackQuality?e.getVideoPlaybackQuality().droppedVideoFrames:0}function s(e,t){for(var n=0;n<t.length;n++)console.info(e,"start: ",t.start(n),", end: ",t.end(n))}function u(e,t,n){for(var r=0;r<e.length;r++){var i=e.start(r),o=e.end(r);if(!(o<=t)){if(i-n>t)break;for(var a=r+1;a<e.length&&!(e.start(a)-o>n);a++)o=e.end(a);for(var s=r-1;s>=0&&!(i-e.end(s)>n);s--)i=e.start(s);return{start:Math.min(i,t),end:o}}}return{start:t,end:t}}function c(e,t){var n=u(e.buffered,e.currentTime,t).end,r=e.currentTime,i=n-r;return!(e.ended||e.duration-r<t)&&i<t}function d(e,t,n){void 0===n&&(n=i.de);var r=u(e,t,n).end-t>n;if(e.length>1||!r)for(var o=0;o<e.length;o++){var a=e.start(o),s=e.end(o);if(t<a&&s-a>n)return a+n}return r?t+n:t}function l(e,t,n){return e.addEventListener(t,n),function(){e.removeEventListener(t,n)}}function f(e){if(e.src){var t=e.src;r.Pr(e),e.load(),URL.revokeObjectURL(t)}}function h(e,t){var n=e.playbackRate,r=e.src;r&&URL.revokeObjectURL(r),e.src=t,e.playbackRate=n}},272:function(){},847:function(){},139:function(e,t,n){"use strict";n.d(t,{$:function(){return r}});var r=function(e){return e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error",e}({})},993:function(){},796:function(e,t,n){"use strict";function r(e){try{return JSON.parse(e)}catch(t){return console.error("Failed JSON parse:",e),{}}}function i(e){try{return JSON.stringify(e)}catch(t){return console.error("Failed JSON stringify:",e),""}}function o(e){return""===e.codecs||"undefined"==typeof MediaSource||MediaSource.isTypeSupported('video/mp4;codecs="'+e.codecs+'"')}function a(e,t){var n=[],r=[];return e.forEach((function(e){t(e)?n.push(e):r.push(e)})),{supported:n,unsupported:r}}function s(e){var t,n;return void 0!==e.hidden?(t="hidden",n="visibilitychange"):void 0!==e.msHidden?(t="msHidden",n="msvisibilitychange"):void 0!==e.webkitHidden&&(t="webkitHidden",n="webkitvisibilitychange"),{hidden:t,visibilityChange:n}}function u(e,t,n){return Math.min(n,Math.max(t,e))}function c(e){e.removeAttribute("src")}function d(e){var t=window.location,n=document.createElement("a");return n.href=e,n.hostname===t.hostname&&n.port===t.port&&n.protocol===t.protocol}function l(e){if("function"==typeof e.checkVisibility)return e.checkVisibility({visibilityProperty:!0});var t=e.style;return"none"!==t.display&&"hidden"!==t.visibility}n.d(t,{J6:function(){return d},N8:function(){return r},Pr:function(){return c},YH:function(){return a},dl:function(){return i},h3:function(){return o},j:function(){return l},qE:function(){return u},sQ:function(){return s}})},579:function(e,t,n){"use strict";n.d(t,{G:function(){return h}});var r,i=n(911),o=n(0),a=n(184),s=n(376),u=n(120),c=function(e){return e.DURATION_CHANGE="durationchange",e.ENDED="ended",e.ERROR="error",e.LOADED_METADATA="loadedmetadata",e.LOADSTART="loadstart",e.PAUSE="pause",e.PLAY="play",e.PLAYING="playing",e.RATE_CHANGE="ratechange",e.SEEKED="seeked",e.SEEKING="seeking",e.TIME_UPDATE="timeupdate",e.VOLUME_CHANGE="volumechange",e.WAITING="waiting",e}({}),d=function(e){return e[e.HAVE_NOTHING=0]="HAVE_NOTHING",e[e.HAVE_METADATA=1]="HAVE_METADATA",e[e.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",e[e.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",e[e.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA",e}(d||{}),l=((r={})[s.p.IDLE]=1,r[s.p.READY]=1,r[s.p.BUFFERING]=2,r[s.p.PLAYING]=2,r[s.p.ENDED]=1,r),f="AmazonIVS";function h(e,t){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, AmazonIVS tech not registered",code:1};if(!u.i$)throw{message:"WebAssembly support is required for AmazonIVS tech",code:2};if(!e.getTech(f)){var n,r={featuresProgressEvents:!0,featuresTimeupdateEvents:!0,featuresPlaybackRate:!0,featuresFullscreenResize:!0,featuresVolumeControl:!0,featuresMuteControl:!0,featuresNativeTextTracks:!1,privateContructor:function(n,r,i){this._readyState=d.HAVE_NOTHING,this._defaultPlaybackRate=1,this._seeking=!1,t.playerFramework={name:"videojs",version:e.VERSION},this._mediaPlayer=(0,u.vt)(t),this._mediaPlayer.setAutoplay(!0===n.autoplay),this._attachVideojsListeners(),this._mediaPlayer.addEventListener(a.a.METADATA,this._onCaptionEvent.bind(this));var o=this._createEl(n);n.el=o,i(this,n,r),window.vttjs&&window.vttjs.restore(),this.triggerReady(),setTimeout(function(){var e=this.options(),t=e.loop,n=e.muted;t&&this._mediaPlayer.setLooping(!0),n&&this._mediaPlayer.setMuted(!0)}.bind(this),0)},dispose:function(){this._mediaPlayer.delete()},setPreload:function(){},autoplay:function(e){if("boolean"!=typeof e)return this._mediaPlayer.autoplay;this.setAutoplay(e)},setAutoplay:function(e){this._mediaPlayer.setAutoplay(e)},preload:function(){},load:function(){},readyState:function(){return this._readyState},seeking:function(){return this._seeking},networkState:function(){if(!this._mediaPlayer)return 0;var e=this._mediaPlayer.getHTMLVideoElement();if(!e.src&&!e.srcObject)return 3;var t=this._mediaPlayer.getState();return l[t]},ended:function(){return this._mediaPlayer.getState()===s.p.ENDED},seekable:function(){return e.createTimeRange(0,this._mediaPlayer.getDuration())},play:function(){this._mediaPlayer.play(),this.trigger(c.PLAY)},pause:function(){this._mediaPlayer.pause()},setCurrentTime:function(e){var t=this._mediaPlayer.getHTMLVideoElement();(t.src||t.srcObject)&&(this._mediaPlayer.seekTo(e),this._seeking=!0,this.trigger(c.SEEKING))},controls:function(){return!1},setControls:function(){return!1},muted:function(){return this._mediaPlayer.isMuted()},setMuted:function(e){this._mediaPlayer.setMuted(e)},volume:function(){return this._mediaPlayer.getVolume()},setVolume:function(e){this._mediaPlayer.setVolume(e)},defaultPlaybackRate:function(e){if(!e)return this._defaultPlaybackRate;this._defaultPlaybackRate=e},playbackRate:function(){return this._mediaPlayer.getPlaybackRate()},setPlaybackRate:function(e){this._mediaPlayer.setPlaybackRate(e)},paused:function(){return this._mediaPlayer.isPaused()},duration:function(){return this._mediaPlayer.getDuration()},currentTime:function(){return this._mediaPlayer.getPosition()},_createEl:function(e){var t=this._mediaPlayer.getHTMLVideoElement();t.setAttribute("class","vjs-tech"),void 0!==e.disablePictureInPicture&&(t.disablePictureInPicture=e.disablePictureInPicture),["preload","poster"].forEach(function(n){e[n]&&t.setAttribute(n,e[n])}.bind(this)),e.playsinline&&(t.setAttribute("webkit-playsinline",""),t.setAttribute("playsinline",""));var n=document.createElement("div");return n.appendChild(t),n},src:function(e){this.trigger(c.LOADSTART),this._seeking=!1,this._captionTrack&&(this.textTracks().removeTrack(this._captionTrack),this._captionTrack=null),e&&this._mediaPlayer.load(e)},addEventListener:function(e,t){this._mediaPlayer.addEventListener(e,t)},removeEventListener:function(e,t){this._mediaPlayer.removeEventListener(e,t)},getMediaPlayerAPI:function(){return this._mediaPlayer},supportsFullScreen:function(){return!0},enterFullScreen:function(){var e=this._mediaPlayer.getHTMLVideoElement();(e.requestFullscreen||e.webkitRequestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitEnterFullscreen||function(){console.error("Fullscreen API is not available")}).call(e)},exitFullScreen:function(){(document.exitFullScreen||document.webkitExitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||function(){console.error("Exitscreen API is not available")}).call(document)},requestPictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().requestPictureInPicture()},setDisablePictureInPicture:function(e){this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture=e},disablePictureInPicture:function(){return this._mediaPlayer.getHTMLVideoElement().disablePictureInPicture},_onCaptionEvent:function(e){if("text/json"===e.type){var t=JSON.parse(e.data);if(t.caption){var n=t.caption;this._captionTrack||(this._captionTrack=this.addTextTrack("captions",n.format),this._currentCue=null),this._currentCue&&this._captionTrack.removeCue(this._currentCue);var r=this._mediaPlayer.getHTMLVideoElement(),i=window.VTTCue||window.vttjs.VTTCue;i?(this._currentCue=new i(r.currentTime,r.currentTime+2,n.text),this._captionTrack.addCue(this._currentCue)):console.warn("No VTTCue implementation available, caption may not be available")}}},_attachVideojsListeners:function(){this._mediaPlayer.addEventListener(s.p.READY,function(){this._readyState=d.HAVE_METADATA,this.trigger(c.LOADED_METADATA)}.bind(this)),this._mediaPlayer.addEventListener(s.p.IDLE,function(){this._readyState=d.HAVE_NOTHING,this.trigger(c.PAUSE)}.bind(this)),this._mediaPlayer.addEventListener(s.p.PLAYING,function(){this._readyState<=d.HAVE_CURRENT_DATA&&(this._readyState=d.HAVE_FUTURE_DATA),this.trigger(c.PLAY),this.trigger(c.PLAYING)}.bind(this)),this._mediaPlayer.addEventListener(s.p.ENDED,function(){this._readyState=d.HAVE_NOTHING,this.trigger(c.ENDED)}.bind(this)),this._mediaPlayer.addEventListener(s.p.BUFFERING,function(){this._readyState=d.HAVE_CURRENT_DATA}.bind(this)),this._mediaPlayer.addEventListener(a.a.REBUFFERING,function(){this._readyState=d.HAVE_CURRENT_DATA,this.trigger(c.WAITING)}.bind(this)),this._mediaPlayer.addEventListener(a.a.TIME_UPDATE,function(){this.trigger(c.TIME_UPDATE)}.bind(this)),this._mediaPlayer.addEventListener(a.a.VOLUME_CHANGED,function(){this.trigger(c.VOLUME_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(a.a.MUTED_CHANGED,function(){this.trigger(c.VOLUME_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(a.a.ERROR,function(){this.trigger(c.ERROR)}.bind(this)),this._mediaPlayer.addEventListener(a.a.DURATION_CHANGED,function(){this.trigger(c.DURATION_CHANGE)}.bind(this)),this._mediaPlayer.addEventListener(a.a.SEEK_COMPLETED,function(){this._seeking=!1,this.trigger(c.SEEKED)}.bind(this)),this._mediaPlayer.addEventListener(a.a.PLAYBACK_RATE_CHANGED,function(){this.trigger(c.RATE_CHANGE)}.bind(this))}},h=e.getTech("Tech");"function"==typeof e.extend?(r.constructor=function(e,t){this.privateContructor(e,t,(function(e,t,n){h.call(e,t,n)}))},n=e.extend(h,r,f)):((n=function(e,t){this.privateContructor(e,t,(function(e,t,n){var r=h.prototype,i=r.featuresProgressEvents,o=r.featuresTimeupdateEvents,a=r.featuresPlaybackRate,s=r.featuresFullscreenResize,u=r.featuresVolumeControl,d=r.featuresMuteControl,l=r.featuresNativeTextTracks;r.featuresProgressEvents=!0,r.featuresTimeupdateEvents=!0,r.featuresPlaybackRate=!0,r.featuresFullscreenResize=!0,r.featuresVolumeControl=!0,r.featuresMuteControl=!0,r.featuresNativeTextTracks=!1,Object.assign(e,new h(t,n)),e.on(c.PLAYING,(function(){e.hasStarted_=!0})),e.on(c.LOADSTART,(function(){e.hasStarted_=!1})),r.featuresProgressEvents=i,r.featuresTimeupdateEvents=o,r.featuresPlaybackRate=a,r.featuresFullscreenResize=s,r.featuresVolumeControl=u,r.featuresMuteControl=d,r.featuresNativeTextTracks=l}))}).prototype=Object.create(h.prototype),Object.assign(n.prototype,r)),n.supportsFullScreen=function(){return!0},n.isSupported=function(){return-1===(navigator.appVersion||"").toLowerCase().indexOf("rv:11")},n.canPlayType=function(e){return"string"==typeof e&&e.length>0&&(e.indexOf("application/x-mpegURL")>-1?"undefined"!=typeof MediaSource&&MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'):""!==document.createElement("video").canPlayType(e))},n.canPlaySource=function(){return!0},e.registerTech("AmazonIVS",n);var p=e.registerPlugin||e.plugin;p("getIVSEvents",(function(){return{PlayerEventType:a.a,MetadataEventType:o.C,PlayerState:s.p,ErrorType:i.B}})),p("getIVSPlayer",(function(){return this.tech(!0).getMediaPlayerAPI()}))}}},405:function(e,t,n){"use strict";n.d(t,{U:function(){return a}});var r=n(184),i=n(376),o="enableIVSQualityPlugin";function a(e){if(void 0===e||"function"!=typeof e.getTech)throw{message:"videojs not available, Amazon IVS Quality Plugin not registered",code:1};if(!e.getPlugin(o)){var t,n=e.getComponent("MenuButton"),a=e.getComponent("MenuItem"),s={privateConstructor:function(e,t,n){n(this,e,t),this.controlText("Quality")},createItems:function(){var e=this.player(),t=e.getIVSPlayer(),n=[],i=new a(e,{selectable:!0,label:"Auto",qualityGroup:"auto"});i.selected(t.isAutoQualityMode()),i.on(["click","tap"],(function(){t.setAutoQualityMode(!0)})),i.on(["click","tap"],this._clickHandler.bind(this,i)),n.push(i);var o=t.getQuality(),s=t.getQualities();return s&&s.length>0&&s.forEach(function(r){var i=new a(e,{selectable:!0,label:r.name,qualityGroup:r.group}),s=function(e){t.setQuality(e)}.bind(null,r);i.on(["click","tap"],s),i.on(["click","tap"],this._clickHandler.bind(this,i)),t.isAutoQualityMode()||i.selected(o.group===r.group),n.push(i)}.bind(this)),t.addEventListener(r.a.QUALITY_CHANGED,(function(n){var r;if(!t.isAutoQualityMode()){var i=null==(r=e.controlBar)?void 0:r.getChild("QualityMenuButton");null==i||i.items.forEach((function(e){var t=e.options().qualityGroup;n&&t&&e.selected(n.group===t)}))}})),this.qualityItems=n,n},buildCSSClass:function(){return"vjs-icon-hd vjs-icon-placeholder "+n.prototype.buildCSSClass.call(this)},_clickHandler:function(e){this.items.forEach((function(t){t!==e&&t.selected(!1)}))}};"function"==typeof e.extend?(s.constructor=function(e,t){this.privateConstructor(e,t,(function(e,t,r){n.call(e,t,r)}))},t=e.extend(n,s)):((t=function(e,t){this.privateConstructor(e,t,(function(e,t,r){var i="quality-control";r.name=i;var o=new n(t,r);o.getChild(i).addClass("vjs-icon-hd vjs-icon-placeholder"),Object.assign(e,o),e.items=e.createItems(),e.items.forEach((function(t){e.menu.addItem(t)}))}))}).prototype=Object.create(n.prototype),Object.assign(t.prototype,s)),e.registerComponent("QualityMenuButton",t),(e.registerPlugin||e.plugin)(o,(function(){var e=this;e.getIVSPlayer().addEventListener(i.p.READY,(function(){var t,n,r=null==(t=e.controlBar)?void 0:t.getChild("QualityMenuButton");r&&(r.dispose(),e.controlBar.removeChild(r)),null==(n=e.controlBar)||n.addChild("QualityMenuButton")}))}))}}},898:function(e){"use strict";e.exports=require("@babel/runtime/helpers/createClass")}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};!function(){"use strict";n.r(r),n.d(r,{AuthorizationError:function(){return i.y},CaptureEventType:function(){return s.P},ErrorSource:function(){return t.g},ErrorType:function(){return i.B},LogLevel:function(){return p.$},MediaPlayer:function(){return e.KJ},MetadataEventType:function(){return o.C},MetadataID3Type:function(){return o._},PlayerEventType:function(){return a.a},PlayerState:function(){return u.p},RemotePlayerEvent:function(){return y.G},create:function(){return e.vt},createWorker:function(){return e.Zx},getVersion:function(){return e.HF},isPlayerSupported:function(){return e.i$},isVP9Supported:function(){return g.YJ},isWasmSupported:function(){return e.TH},registerIVSQualityPlugin:function(){return m.U},registerIVSTech:function(){return v.G}});var e=n(120),t=n(554),i=n(911),o=n(0),a=n(184),s=n(695),u=n(376),c=n(847),d={};for(var l in c)["default","LogLevel","registerIVSTech","registerIVSQualityPlugin","isVP9Supported","MediaPlayer","create","createWorker","getVersion","isPlayerSupported","isWasmSupported","ErrorSource","AuthorizationError","ErrorType","MetadataEventType","MetadataID3Type","PlayerEventType","CaptureEventType","PlayerState"].indexOf(l)<0&&(d[l]=function(e){return c[e]}.bind(0,l));n.d(r,d);var f=n(993);for(var l in d={},f)["default","LogLevel","registerIVSTech","registerIVSQualityPlugin","isVP9Supported","MediaPlayer","create","createWorker","getVersion","isPlayerSupported","isWasmSupported","ErrorSource","AuthorizationError","ErrorType","MetadataEventType","MetadataID3Type","PlayerEventType","CaptureEventType","PlayerState"].indexOf(l)<0&&(d[l]=function(e){return f[e]}.bind(0,l));n.d(r,d);var h=n(272);for(var l in d={},h)["default","LogLevel","registerIVSTech","registerIVSQualityPlugin","isVP9Supported","MediaPlayer","create","createWorker","getVersion","isPlayerSupported","isWasmSupported","ErrorSource","AuthorizationError","ErrorType","MetadataEventType","MetadataID3Type","PlayerEventType","CaptureEventType","PlayerState"].indexOf(l)<0&&(d[l]=function(e){return h[e]}.bind(0,l));n.d(r,d);var p=n(139),v=n(579),m=n(405),g=n(530),y=n(355)}(),module.exports=r}();